(function(){"use strict";var nr=Object.defineProperty,yo=Object.getOwnPropertyDescriptor,mo=Object.getOwnPropertyNames,go=Object.prototype.hasOwnProperty,wo=(r=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(r,{get:(a,l)=>(typeof require<"u"?require:a)[l]}):r)(function(r){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+r+'" is not supported')}),k=(r,a)=>()=>(r&&(a=r(r=0)),a),mt=(r,a)=>{for(var l in a)nr(r,l,{get:a[l],enumerable:!0})},bo=(r,a,l,i)=>{if(a&&typeof a=="object"||typeof a=="function")for(let u of mo(a))!go.call(r,u)&&u!==l&&nr(r,u,{get:()=>a[u],enumerable:!(i=yo(a,u))||i.enumerable});return r},Rt=r=>bo(nr({},"__esModule",{value:!0}),r),gt,De,Ze,Tn,_n,En=k(()=>{gt=new Map,De=[],Ze=(r,a,l)=>{if(a&&typeof a.init=="function"&&typeof a.createInferenceSessionHandler=="function"){let i=gt.get(r);if(i===void 0)gt.set(r,{backend:a,priority:l});else{if(i.priority>l)return;if(i.priority===l&&i.backend!==a)throw new Error(`cannot register backend "${r}" using priority ${l}`)}if(l>=0){let u=De.indexOf(r);u!==-1&&De.splice(u,1);for(let p=0;p<De.length;p++)if(gt.get(De[p]).priority<=l){De.splice(p,0,r);return}De.push(r)}return}throw new TypeError("not a valid backend")},Tn=async r=>{let a=gt.get(r);if(!a)return"backend not found.";if(a.initialized)return a.backend;if(a.aborted)return a.error;{let l=!!a.initPromise;try{return l||(a.initPromise=a.backend.init(r)),await a.initPromise,a.initialized=!0,a.backend}catch(i){return l||(a.error=`${i}`,a.aborted=!0),a.error}finally{delete a.initPromise}}},_n=async r=>{let a=r.executionProviders||[],l=a.map(y=>typeof y=="string"?y:y.name),i=l.length===0?De:l,u,p=[],c=new Set;for(let y of i){let w=await Tn(y);typeof w=="string"?p.push({name:y,err:w}):(u||(u=w),u===w&&c.add(y))}if(!u)throw new Error(`no available backend found. ERR: ${p.map(y=>`[${y.name}] ${y.err}`).join(", ")}`);for(let{name:y,err:w}of p)l.includes(y)&&console.warn(`removing requested execution provider "${y}" from session options because it is not available: ${w}`);let d=a.filter(y=>c.has(typeof y=="string"?y:y.name));return[u,new Proxy(r,{get:(y,w)=>w==="executionProviders"?d:Reflect.get(y,w)})]}}),vo=k(()=>{En()}),An,Co=k(()=>{An="1.23.2"}),ir,ne,xn=k(()=>{Co(),ir="warning",ne={wasm:{},webgl:{},webgpu:{},versions:{common:An},set logLevel(r){if(r!==void 0){if(typeof r!="string"||["verbose","info","warning","error","fatal"].indexOf(r)===-1)throw new Error(`Unsupported logging level: ${r}`);ir=r}},get logLevel(){return ir}},Object.defineProperty(ne,"logLevel",{enumerable:!0})}),Z,To=k(()=>{xn(),Z=ne}),On,Sn,_o=k(()=>{On=(r,a)=>{let l=typeof document<"u"?document.createElement("canvas"):new OffscreenCanvas(1,1);l.width=r.dims[3],l.height=r.dims[2];let i=l.getContext("2d");if(i!=null){let u,p;a?.tensorLayout!==void 0&&a.tensorLayout==="NHWC"?(u=r.dims[2],p=r.dims[3]):(u=r.dims[3],p=r.dims[2]);let c=a?.format!==void 0?a.format:"RGB",d=a?.norm,y,w;d===void 0||d.mean===void 0?y=[255,255,255,255]:typeof d.mean=="number"?y=[d.mean,d.mean,d.mean,d.mean]:(y=[d.mean[0],d.mean[1],d.mean[2],0],d.mean[3]!==void 0&&(y[3]=d.mean[3])),d===void 0||d.bias===void 0?w=[0,0,0,0]:typeof d.bias=="number"?w=[d.bias,d.bias,d.bias,d.bias]:(w=[d.bias[0],d.bias[1],d.bias[2],0],d.bias[3]!==void 0&&(w[3]=d.bias[3]));let v=p*u,C=0,_=v,O=v*2,R=-1;c==="RGBA"?(C=0,_=v,O=v*2,R=v*3):c==="RGB"?(C=0,_=v,O=v*2):c==="RBG"&&(C=0,O=v,_=v*2);for(let j=0;j<p;j++)for(let L=0;L<u;L++){let P=(r.data[C++]-w[0])*y[0],M=(r.data[_++]-w[1])*y[1],D=(r.data[O++]-w[2])*y[2],U=R===-1?255:(r.data[R++]-w[3])*y[3];i.fillStyle="rgba("+P+","+M+","+D+","+U+")",i.fillRect(L,j,1,1)}if("toDataURL"in l)return l.toDataURL();throw new Error("toDataURL is not supported")}else throw new Error("Can not access image data")},Sn=(r,a)=>{let l=typeof document<"u"?document.createElement("canvas").getContext("2d"):new OffscreenCanvas(1,1).getContext("2d"),i;if(l!=null){let u,p,c;a?.tensorLayout!==void 0&&a.tensorLayout==="NHWC"?(u=r.dims[2],p=r.dims[1],c=r.dims[3]):(u=r.dims[3],p=r.dims[2],c=r.dims[1]);let d=a!==void 0&&a.format!==void 0?a.format:"RGB",y=a?.norm,w,v;y===void 0||y.mean===void 0?w=[255,255,255,255]:typeof y.mean=="number"?w=[y.mean,y.mean,y.mean,y.mean]:(w=[y.mean[0],y.mean[1],y.mean[2],255],y.mean[3]!==void 0&&(w[3]=y.mean[3])),y===void 0||y.bias===void 0?v=[0,0,0,0]:typeof y.bias=="number"?v=[y.bias,y.bias,y.bias,y.bias]:(v=[y.bias[0],y.bias[1],y.bias[2],0],y.bias[3]!==void 0&&(v[3]=y.bias[3]));let C=p*u;if(a!==void 0&&(a.format!==void 0&&c===4&&a.format!=="RGBA"||c===3&&a.format!=="RGB"&&a.format!=="BGR"))throw new Error("Tensor format doesn't match input tensor dims");let _=4,O=0,R=1,j=2,L=3,P=0,M=C,D=C*2,U=-1;d==="RGBA"?(P=0,M=C,D=C*2,U=C*3):d==="RGB"?(P=0,M=C,D=C*2):d==="RBG"&&(P=0,D=C,M=C*2),i=l.createImageData(u,p);for(let F=0;F<p*u;O+=_,R+=_,j+=_,L+=_,F++)i.data[O]=(r.data[P++]-v[0])*w[0],i.data[R]=(r.data[M++]-v[1])*w[1],i.data[j]=(r.data[D++]-v[2])*w[2],i.data[L]=U===-1?255:(r.data[U++]-v[3])*w[3]}else throw new Error("Can not access image data");return i}}),Pt,In,Mn,Bn,Rn,Pn,Eo=k(()=>{or(),Pt=(r,a)=>{if(r===void 0)throw new Error("Image buffer must be defined");if(a.height===void 0||a.width===void 0)throw new Error("Image height and width must be defined");if(a.tensorLayout==="NHWC")throw new Error("NHWC Tensor layout is not supported yet");let{height:l,width:i}=a,u=a.norm??{mean:255,bias:0},p,c;typeof u.mean=="number"?p=[u.mean,u.mean,u.mean,u.mean]:p=[u.mean[0],u.mean[1],u.mean[2],u.mean[3]??255],typeof u.bias=="number"?c=[u.bias,u.bias,u.bias,u.bias]:c=[u.bias[0],u.bias[1],u.bias[2],u.bias[3]??0];let d=a.format!==void 0?a.format:"RGBA",y=a.tensorFormat!==void 0&&a.tensorFormat!==void 0?a.tensorFormat:"RGB",w=l*i,v=y==="RGBA"?new Float32Array(w*4):new Float32Array(w*3),C=4,_=0,O=1,R=2,j=3,L=0,P=w,M=w*2,D=-1;d==="RGB"&&(C=3,_=0,O=1,R=2,j=-1),y==="RGBA"?D=w*3:y==="RBG"?(L=0,M=w,P=w*2):y==="BGR"&&(M=0,P=w,L=w*2);for(let U=0;U<w;U++,_+=C,R+=C,O+=C,j+=C)v[L++]=(r[_]+c[0])/p[0],v[P++]=(r[O]+c[1])/p[1],v[M++]=(r[R]+c[2])/p[2],D!==-1&&j!==-1&&(v[D++]=(r[j]+c[3])/p[3]);return y==="RGBA"?new ce("float32",v,[1,4,l,i]):new ce("float32",v,[1,3,l,i])},In=async(r,a)=>{let l=typeof HTMLImageElement<"u"&&r instanceof HTMLImageElement,i=typeof ImageData<"u"&&r instanceof ImageData,u=typeof ImageBitmap<"u"&&r instanceof ImageBitmap,p=typeof r=="string",c,d=a??{},y=()=>{if(typeof document<"u")return document.createElement("canvas");if(typeof OffscreenCanvas<"u")return new OffscreenCanvas(1,1);throw new Error("Canvas is not supported")},w=v=>typeof HTMLCanvasElement<"u"&&v instanceof HTMLCanvasElement||v instanceof OffscreenCanvas?v.getContext("2d"):null;if(l){let v=y();v.width=r.width,v.height=r.height;let C=w(v);if(C!=null){let _=r.height,O=r.width;if(a!==void 0&&a.resizedHeight!==void 0&&a.resizedWidth!==void 0&&(_=a.resizedHeight,O=a.resizedWidth),a!==void 0){if(d=a,a.tensorFormat!==void 0)throw new Error("Image input config format must be RGBA for HTMLImageElement");d.tensorFormat="RGBA",d.height=_,d.width=O}else d.tensorFormat="RGBA",d.height=_,d.width=O;C.drawImage(r,0,0),c=C.getImageData(0,0,O,_).data}else throw new Error("Can not access image data")}else if(i){let v,C;if(a!==void 0&&a.resizedWidth!==void 0&&a.resizedHeight!==void 0?(v=a.resizedHeight,C=a.resizedWidth):(v=r.height,C=r.width),a!==void 0&&(d=a),d.format="RGBA",d.height=v,d.width=C,a!==void 0){let _=y();_.width=C,_.height=v;let O=w(_);if(O!=null)O.putImageData(r,0,0),c=O.getImageData(0,0,C,v).data;else throw new Error("Can not access image data")}else c=r.data}else if(u){if(a===void 0)throw new Error("Please provide image config with format for Imagebitmap");let v=y();v.width=r.width,v.height=r.height;let C=w(v);if(C!=null){let _=r.height,O=r.width;return C.drawImage(r,0,0,O,_),c=C.getImageData(0,0,O,_).data,d.height=_,d.width=O,Pt(c,d)}else throw new Error("Can not access image data")}else{if(p)return new Promise((v,C)=>{let _=y(),O=w(_);if(!r||!O)return C();let R=new Image;R.crossOrigin="Anonymous",R.src=r,R.onload=()=>{_.width=R.width,_.height=R.height,O.drawImage(R,0,0,_.width,_.height);let j=O.getImageData(0,0,_.width,_.height);d.height=_.height,d.width=_.width,v(Pt(j.data,d))}});throw new Error("Input data provided is not supported - aborted tensor creation")}if(c!==void 0)return Pt(c,d);throw new Error("Input data provided is not supported - aborted tensor creation")},Mn=(r,a)=>{let{width:l,height:i,download:u,dispose:p}=a,c=[1,i,l,4];return new ce({location:"texture",type:"float32",texture:r,dims:c,download:u,dispose:p})},Bn=(r,a)=>{let{dataType:l,dims:i,download:u,dispose:p}=a;return new ce({location:"gpu-buffer",type:l??"float32",gpuBuffer:r,dims:i,download:u,dispose:p})},Rn=(r,a)=>{let{dataType:l,dims:i,download:u,dispose:p}=a;return new ce({location:"ml-tensor",type:l??"float32",mlTensor:r,dims:i,download:u,dispose:p})},Pn=(r,a,l)=>new ce({location:"cpu-pinned",type:r,data:a,dims:l??[a.length]})}),Xe,wt,ar,Un,Ao=k(()=>{Xe=new Map([["float32",Float32Array],["uint8",Uint8Array],["int8",Int8Array],["uint16",Uint16Array],["int16",Int16Array],["int32",Int32Array],["bool",Uint8Array],["float64",Float64Array],["uint32",Uint32Array],["int4",Uint8Array],["uint4",Uint8Array]]),wt=new Map([[Float32Array,"float32"],[Uint8Array,"uint8"],[Int8Array,"int8"],[Uint16Array,"uint16"],[Int16Array,"int16"],[Int32Array,"int32"],[Float64Array,"float64"],[Uint32Array,"uint32"]]),ar=!1,Un=()=>{if(!ar){ar=!0;let r=typeof BigInt64Array<"u"&&BigInt64Array.from,a=typeof BigUint64Array<"u"&&BigUint64Array.from,l=globalThis.Float16Array,i=typeof l<"u"&&l.from;r&&(Xe.set("int64",BigInt64Array),wt.set(BigInt64Array,"int64")),a&&(Xe.set("uint64",BigUint64Array),wt.set(BigUint64Array,"uint64")),i?(Xe.set("float16",l),wt.set(l,"float16")):Xe.set("float16",Uint16Array)}}}),Ln,jn,xo=k(()=>{or(),Ln=r=>{let a=1;for(let l=0;l<r.length;l++){let i=r[l];if(typeof i!="number"||!Number.isSafeInteger(i))throw new TypeError(`dims[${l}] must be an integer, got: ${i}`);if(i<0)throw new RangeError(`dims[${l}] must be a non-negative integer, got: ${i}`);a*=i}return a},jn=(r,a)=>{switch(r.location){case"cpu":return new ce(r.type,r.data,a);case"cpu-pinned":return new ce({location:"cpu-pinned",data:r.data,type:r.type,dims:a});case"texture":return new ce({location:"texture",texture:r.texture,type:r.type,dims:a});case"gpu-buffer":return new ce({location:"gpu-buffer",gpuBuffer:r.gpuBuffer,type:r.type,dims:a});case"ml-tensor":return new ce({location:"ml-tensor",mlTensor:r.mlTensor,type:r.type,dims:a});default:throw new Error(`tensorReshape: tensor location ${r.location} is not supported`)}}}),ce,or=k(()=>{_o(),Eo(),Ao(),xo(),ce=class{constructor(r,a,l){Un();let i,u;if(typeof r=="object"&&"location"in r)switch(this.dataLocation=r.location,i=r.type,u=r.dims,r.location){case"cpu-pinned":{let c=Xe.get(i);if(!c)throw new TypeError(`unsupported type "${i}" to create tensor from pinned buffer`);if(!(r.data instanceof c))throw new TypeError(`buffer should be of type ${c.name}`);this.cpuData=r.data;break}case"texture":{if(i!=="float32")throw new TypeError(`unsupported type "${i}" to create tensor from texture`);this.gpuTextureData=r.texture,this.downloader=r.download,this.disposer=r.dispose;break}case"gpu-buffer":{if(i!=="float32"&&i!=="float16"&&i!=="int32"&&i!=="int64"&&i!=="uint32"&&i!=="uint8"&&i!=="bool"&&i!=="uint4"&&i!=="int4")throw new TypeError(`unsupported type "${i}" to create tensor from gpu buffer`);this.gpuBufferData=r.gpuBuffer,this.downloader=r.download,this.disposer=r.dispose;break}case"ml-tensor":{if(i!=="float32"&&i!=="float16"&&i!=="int32"&&i!=="int64"&&i!=="uint32"&&i!=="uint64"&&i!=="int8"&&i!=="uint8"&&i!=="bool"&&i!=="uint4"&&i!=="int4")throw new TypeError(`unsupported type "${i}" to create tensor from MLTensor`);this.mlTensorData=r.mlTensor,this.downloader=r.download,this.disposer=r.dispose;break}default:throw new Error(`Tensor constructor: unsupported location '${this.dataLocation}'`)}else{let c,d;if(typeof r=="string")if(i=r,d=l,r==="string"){if(!Array.isArray(a))throw new TypeError("A string tensor's data must be a string array.");c=a}else{let y=Xe.get(r);if(y===void 0)throw new TypeError(`Unsupported tensor type: ${r}.`);if(Array.isArray(a)){if(r==="float16"&&y===Uint16Array||r==="uint4"||r==="int4")throw new TypeError(`Creating a ${r} tensor from number array is not supported. Please use ${y.name} as data.`);r==="uint64"||r==="int64"?c=y.from(a,BigInt):c=y.from(a)}else if(a instanceof y)c=a;else if(a instanceof Uint8ClampedArray)if(r==="uint8")c=Uint8Array.from(a);else throw new TypeError("A Uint8ClampedArray tensor's data must be type of uint8");else if(r==="float16"&&a instanceof Uint16Array&&y!==Uint16Array)c=new globalThis.Float16Array(a.buffer,a.byteOffset,a.length);else throw new TypeError(`A ${i} tensor's data must be type of ${y}`)}else if(d=a,Array.isArray(r)){if(r.length===0)throw new TypeError("Tensor type cannot be inferred from an empty array.");let y=typeof r[0];if(y==="string")i="string",c=r;else if(y==="boolean")i="bool",c=Uint8Array.from(r);else throw new TypeError(`Invalid element type of data array: ${y}.`)}else if(r instanceof Uint8ClampedArray)i="uint8",c=Uint8Array.from(r);else{let y=wt.get(r.constructor);if(y===void 0)throw new TypeError(`Unsupported type for tensor data: ${r.constructor}.`);i=y,c=r}if(d===void 0)d=[c.length];else if(!Array.isArray(d))throw new TypeError("A tensor's dims must be a number array");u=d,this.cpuData=c,this.dataLocation="cpu"}let p=Ln(u);if(this.cpuData&&p!==this.cpuData.length&&!((i==="uint4"||i==="int4")&&Math.ceil(p/2)===this.cpuData.length))throw new Error(`Tensor's size(${p}) does not match data length(${this.cpuData.length}).`);this.type=i,this.dims=u,this.size=p}static async fromImage(r,a){return In(r,a)}static fromTexture(r,a){return Mn(r,a)}static fromGpuBuffer(r,a){return Bn(r,a)}static fromMLTensor(r,a){return Rn(r,a)}static fromPinnedBuffer(r,a,l){return Pn(r,a,l)}toDataURL(r){return On(this,r)}toImageData(r){return Sn(this,r)}get data(){if(this.ensureValid(),!this.cpuData)throw new Error("The data is not on CPU. Use `getData()` to download GPU data to CPU, or use `texture` or `gpuBuffer` property to access the GPU data directly.");return this.cpuData}get location(){return this.dataLocation}get texture(){if(this.ensureValid(),!this.gpuTextureData)throw new Error("The data is not stored as a WebGL texture.");return this.gpuTextureData}get gpuBuffer(){if(this.ensureValid(),!this.gpuBufferData)throw new Error("The data is not stored as a WebGPU buffer.");return this.gpuBufferData}get mlTensor(){if(this.ensureValid(),!this.mlTensorData)throw new Error("The data is not stored as a WebNN MLTensor.");return this.mlTensorData}async getData(r){switch(this.ensureValid(),this.dataLocation){case"cpu":case"cpu-pinned":return this.data;case"texture":case"gpu-buffer":case"ml-tensor":{if(!this.downloader)throw new Error("The current tensor is not created with a specified data downloader.");if(this.isDownloading)throw new Error("The current tensor is being downloaded.");try{this.isDownloading=!0;let a=await this.downloader();return this.downloader=void 0,this.dataLocation="cpu",this.cpuData=a,r&&this.disposer&&(this.disposer(),this.disposer=void 0),a}finally{this.isDownloading=!1}}default:throw new Error(`cannot get data from location: ${this.dataLocation}`)}}dispose(){if(this.isDownloading)throw new Error("The current tensor is being downloaded.");this.disposer&&(this.disposer(),this.disposer=void 0),this.cpuData=void 0,this.gpuTextureData=void 0,this.gpuBufferData=void 0,this.mlTensorData=void 0,this.downloader=void 0,this.isDownloading=void 0,this.dataLocation="none"}ensureValid(){if(this.dataLocation==="none")throw new Error("The tensor is disposed.")}reshape(r){if(this.ensureValid(),this.downloader||this.disposer)throw new Error("Cannot reshape a tensor that owns GPU resource.");return jn(this,r)}}}),Ae,$n=k(()=>{or(),Ae=ce}),Ut,sr,Ye,Je,We,Ge,kn=k(()=>{xn(),Ut=(r,a)=>{(typeof ne.trace>"u"?!ne.wasm.trace:!ne.trace)||console.timeStamp(`${r}::ORT::${a}`)},sr=(r,a)=>{let l=new Error().stack?.split(/\r\n|\r|\n/g)||[],i=!1;for(let u=0;u<l.length;u++){if(i&&!l[u].includes("TRACE_FUNC")){let p=`FUNC_${r}::${l[u].trim().split(" ")[1]}`;a&&(p+=`::${a}`),Ut("CPU",p);return}l[u].includes("TRACE_FUNC")&&(i=!0)}},Ye=r=>{(typeof ne.trace>"u"?!ne.wasm.trace:!ne.trace)||sr("BEGIN",r)},Je=r=>{(typeof ne.trace>"u"?!ne.wasm.trace:!ne.trace)||sr("END",r)},We=r=>{(typeof ne.trace>"u"?!ne.wasm.trace:!ne.trace)||console.time(`ORT::${r}`)},Ge=r=>{(typeof ne.trace>"u"?!ne.wasm.trace:!ne.trace)||console.timeEnd(`ORT::${r}`)}}),Nn,Oo=k(()=>{En(),$n(),kn(),Nn=class ho{constructor(a){this.handler=a}async run(a,l,i){Ye(),We("InferenceSession.run");let u={},p={};if(typeof a!="object"||a===null||a instanceof Ae||Array.isArray(a))throw new TypeError("'feeds' must be an object that use input names as keys and OnnxValue as corresponding values.");let c=!0;if(typeof l=="object"){if(l===null)throw new TypeError("Unexpected argument[1]: cannot be null.");if(l instanceof Ae)throw new TypeError("'fetches' cannot be a Tensor");if(Array.isArray(l)){if(l.length===0)throw new TypeError("'fetches' cannot be an empty array.");c=!1;for(let w of l){if(typeof w!="string")throw new TypeError("'fetches' must be a string array or an object.");if(this.outputNames.indexOf(w)===-1)throw new RangeError(`'fetches' contains invalid output name: ${w}.`);u[w]=null}if(typeof i=="object"&&i!==null)p=i;else if(typeof i<"u")throw new TypeError("'options' must be an object.")}else{let w=!1,v=Object.getOwnPropertyNames(l);for(let C of this.outputNames)if(v.indexOf(C)!==-1){let _=l[C];(_===null||_ instanceof Ae)&&(w=!0,c=!1,u[C]=_)}if(w){if(typeof i=="object"&&i!==null)p=i;else if(typeof i<"u")throw new TypeError("'options' must be an object.")}else p=l}}else if(typeof l<"u")throw new TypeError("Unexpected argument[1]: must be 'fetches' or 'options'.");for(let w of this.inputNames)if(typeof a[w]>"u")throw new Error(`input '${w}' is missing in 'feeds'.`);if(c)for(let w of this.outputNames)u[w]=null;let d=await this.handler.run(a,u,p),y={};for(let w in d)if(Object.hasOwnProperty.call(d,w)){let v=d[w];v instanceof Ae?y[w]=v:y[w]=new Ae(v.type,v.data,v.dims)}return Ge("InferenceSession.run"),Je(),y}async release(){return this.handler.dispose()}static async create(a,l,i,u){Ye(),We("InferenceSession.create");let p,c={};if(typeof a=="string"){if(p=a,typeof l=="object"&&l!==null)c=l;else if(typeof l<"u")throw new TypeError("'options' must be an object.")}else if(a instanceof Uint8Array){if(p=a,typeof l=="object"&&l!==null)c=l;else if(typeof l<"u")throw new TypeError("'options' must be an object.")}else if(a instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&a instanceof SharedArrayBuffer){let v=a,C=0,_=a.byteLength;if(typeof l=="object"&&l!==null)c=l;else if(typeof l=="number"){if(C=l,!Number.isSafeInteger(C))throw new RangeError("'byteOffset' must be an integer.");if(C<0||C>=v.byteLength)throw new RangeError(`'byteOffset' is out of range [0, ${v.byteLength}).`);if(_=a.byteLength-C,typeof i=="number"){if(_=i,!Number.isSafeInteger(_))throw new RangeError("'byteLength' must be an integer.");if(_<=0||C+_>v.byteLength)throw new RangeError(`'byteLength' is out of range (0, ${v.byteLength-C}].`);if(typeof u=="object"&&u!==null)c=u;else if(typeof u<"u")throw new TypeError("'options' must be an object.")}else if(typeof i<"u")throw new TypeError("'byteLength' must be a number.")}else if(typeof l<"u")throw new TypeError("'options' must be an object.");p=new Uint8Array(v,C,_)}else throw new TypeError("Unexpected argument[0]: must be 'path' or 'buffer'.");let[d,y]=await _n(c),w=await d.createInferenceSessionHandler(p,y);return Ge("InferenceSession.create"),Je(),new ho(w)}startProfiling(){this.handler.startProfiling()}endProfiling(){this.handler.endProfiling()}get inputNames(){return this.handler.inputNames}get outputNames(){return this.handler.outputNames}get inputMetadata(){return this.handler.inputMetadata}get outputMetadata(){return this.handler.outputMetadata}}}),Lt,So=k(()=>{Oo(),Lt=Nn}),Io=k(()=>{}),Mo=k(()=>{}),Bo=k(()=>{}),Ro=k(()=>{}),Dn={};mt(Dn,{InferenceSession:()=>Lt,TRACE:()=>Ut,TRACE_EVENT_BEGIN:()=>We,TRACE_EVENT_END:()=>Ge,TRACE_FUNC_BEGIN:()=>Ye,TRACE_FUNC_END:()=>Je,Tensor:()=>Ae,env:()=>Z,registerBackend:()=>Ze});var Qe=k(()=>{vo(),To(),So(),$n(),Io(),Mo(),kn(),Bo(),Ro()}),lr=k(()=>{}),Wn={};mt(Wn,{default:()=>Gn});var ur,fr,Gn,Po=k(()=>{xi(),Ke(),gr(),ur="ort-wasm-proxy-worker",fr=globalThis.self?.name===ur,fr&&(self.onmessage=r=>{let{type:a,in:l}=r.data;try{switch(a){case"init-wasm":vr(l.wasm).then(()=>{Pr(l).then(()=>{postMessage({type:a})},i=>{postMessage({type:a,err:i})})},i=>{postMessage({type:a,err:i})});break;case"init-ep":{let{epName:i,env:u}=l;Ur(u,i).then(()=>{postMessage({type:a})},p=>{postMessage({type:a,err:p})});break}case"copy-from":{let{buffer:i}=l,u=Ft(i);postMessage({type:a,out:u});break}case"create":{let{model:i,options:u}=l;jr(i,u).then(p=>{postMessage({type:a,out:p})},p=>{postMessage({type:a,err:p})});break}case"release":$r(l),postMessage({type:a});break;case"run":{let{sessionId:i,inputIndices:u,inputs:p,outputIndices:c,options:d}=l;Nr(i,u,p,c,new Array(c.length).fill(null),d).then(y=>{y.some(w=>w[3]!=="cpu")?postMessage({type:a,err:"Proxy does not support non-cpu tensor location."}):postMessage({type:a,out:y},Wr([...p,...y]))},y=>{postMessage({type:a,err:y})});break}case"end-profiling":Dr(l),postMessage({type:a});break;default:}}catch(i){postMessage({type:a,err:i})}}),Gn=fr?null:r=>new Worker(r??pe,{type:"module",name:ur})}),Fn={};mt(Fn,{default:()=>Vn});var dr,Vn,zn,Uo=k(()=>{dr=async function(r={}){var a,l,i=r,u=new Promise((e,t)=>{a=e,l=t}),p=typeof window=="object",c=typeof WorkerGlobalScope<"u",d=c&&self.name?.startsWith("em-pthread");i.mountExternalData=(e,t)=>{e.startsWith("./")&&(e=e.substring(2)),(i.fc||(i.fc=new Map)).set(e,t)},i.unmountExternalData=()=>{delete i.fc};var y=globalThis.SharedArrayBuffer??new WebAssembly.Memory({initial:0,maximum:0,ld:!0}).buffer.constructor;let w=()=>{let e=(t,n,o)=>(...s)=>{let f=Me,h=n?.();s=t(...s);let m=n?.();return h!==m&&(t=m,o(h),n=o=null),Me!=f?new Promise((b,T)=>{an={resolve:b,reject:T}}):s};(()=>{for(let t of["_OrtAppendExecutionProvider","_OrtCreateSession","_OrtRun","_OrtRunWithBinding","_OrtBindInput"])i[t]=e(i[t],()=>i[t],n=>i[t]=n)})(),typeof jsepRunAsync<"u"&&(i._OrtRun=jsepRunAsync(i._OrtRun),i._OrtRunWithBinding=jsepRunAsync(i._OrtRunWithBinding)),w=void 0};i.asyncInit=()=>{w?.()};var v,C,_=(e,t)=>{throw t},O=self.location.href,R="";if(p||c){try{R=new URL(".",O).href}catch{}c&&(C=e=>{var t=new XMLHttpRequest;return t.open("GET",e,!1),t.responseType="arraybuffer",t.send(null),new Uint8Array(t.response)}),v=async e=>{if(K(e))return new Promise((n,o)=>{var s=new XMLHttpRequest;s.open("GET",e,!0),s.responseType="arraybuffer",s.onload=()=>{s.status==200||s.status==0&&s.response?n(s.response):o(s.status)},s.onerror=o,s.send(null)});var t=await fetch(e,{credentials:"same-origin"});if(t.ok)return t.arrayBuffer();throw Error(t.status+" : "+t.url)}}var j,L,P,M,D,U,F,ie,se,ee,te,ae,X,we,Et,$=console.log.bind(console),be=console.error.bind(console),ft=$,N=be,oe=!1,K=e=>e.startsWith("file://");function re(){return L.buffer!=D.buffer&&W(),D}function Y(){return L.buffer!=D.buffer&&W(),U}function xe(){return L.buffer!=D.buffer&&W(),F}function dt(){return L.buffer!=D.buffer&&W(),ie}function S(){return L.buffer!=D.buffer&&W(),se}function A(){return L.buffer!=D.buffer&&W(),ee}function ve(){return L.buffer!=D.buffer&&W(),te}function ye(){return L.buffer!=D.buffer&&W(),we}if(d){let e=function(t){try{var n=t.data,o=n.dc;if(o==="load"){let s=[];self.onmessage=f=>s.push(f),self.startWorker=()=>{postMessage({dc:"loaded"});for(let f of s)e(f);self.onmessage=e};for(let f of n.Uc)i[f]&&!i[f].proxy||(i[f]=(...h)=>{postMessage({dc:"callHandler",Tc:f,args:h})},f=="print"&&(ft=i[f]),f=="printErr"&&(N=i[f]));L=n.bd,W(),Et(n.cd)}else if(o==="run"){Qo(n.ac),wn(n.ac,0,0,1,0,0),Zi(),rn(n.ac),J||(Ga(),J=!0);try{Ko(n.Zc,n.jc)}catch(s){if(s!="unwind")throw s}}else n.target!=="setimmediate"&&(o==="checkMailbox"?J&&Ht():o&&(N(`worker: received unknown command ${o}`),N(n)))}catch(s){throw ro(),s}};var J=!1;self.onunhandledrejection=t=>{throw t.reason||t},self.onmessage=e}function W(){var e=L.buffer;i.HEAP8=D=new Int8Array(e),F=new Int16Array(e),i.HEAPU8=U=new Uint8Array(e),ie=new Uint16Array(e),i.HEAP32=se=new Int32Array(e),i.HEAPU32=ee=new Uint32Array(e),te=new Float32Array(e),we=new Float64Array(e),ae=new BigInt64Array(e),X=new BigUint64Array(e)}function Ce(){d?startWorker(i):g.nb()}var nt,Re=0,At=null;function Wi(){if(--Re==0&&At){var e=At;At=null,e()}}function Pe(e){throw N(e="Aborted("+e+")"),oe=!0,e=new WebAssembly.RuntimeError(e+". Build with -sASSERTIONS for more info."),l(e),e}function Gi(){return{a:{R:ou,b:ts,ba:Qi,I:ta,ra,jb:na,lb:ia,sa:aa,pa:oa,ia:sa,oa:la,P:ua,kb:fa,hb:da,qa:ca,ib:pa,xa:rs,Z:ns,cb:is,ab:os,Y:ls,w:us,t:fs,bb:ds,L:ws,db:bs,la:vs,fb:Cs,ca:Ts,_a:_s,$:Es,ka:rn,ua:As,s:xs,Na:Os,A:Ms,o:Bs,m:Ps,c:Kr,Ma:Us,n:Ls,i:ks,v:Ns,p:Ds,f:Ws,u:Gs,k:Fs,e:Vs,j:zs,h:Hs,g:qs,d:Zs,fa:Xs,ga:Ys,ha:Js,da:xa,ea:Oa,$a:Sa,za:Ks,wa:tl,E:rl,La:nl,M:il,va:el,C:al,ta:ol,gb:sl,r:Qs,Ia:ll,F:ul,Q:fl,eb:dl,Ba:cl,Aa:pl,Ha:vl,q:Cl,U:Tl,T:_l,Ka:El,D:Al,l:xl,Ga:Ol,Fa:Sl,Ja:Il,Ea:Ml,Da:Bl,Ca:Rl,ma:Ua,na:La,aa:Xr,J:ja,O:$a,ja:ka,N:Na,a:L,ya:Zr,Xa:Ul,K:Ll,x:jl,S:$l,Ya:kl,y:Nl,Ta:Dl,Va:Wl,V:Gl,z:Fl,_:Vl,W:zl,G:Hl,Ra:ql,mb:Zl,B:Xl,Ua:Yl,Wa:Jl,Oa:Ql,Pa:Kl,Qa:eu,H:tu,X:ru,Sa:nu,Za:iu}}}class Hr{name="ExitStatus";constructor(t){this.message=`Program terminated with exit(${t})`,this.status=t}}var Fi=e=>{e.terminate(),e.onmessage=()=>{}},qr=[],Vi=e=>{ze.length==0&&(Yi(),Xi(ze[0]));var t=ze.pop();if(!t)return 6;xt.push(t),it[e.ac]=t,t.ac=e.ac;var n={dc:"run",Zc:e.Yc,jc:e.jc,ac:e.ac};return t.postMessage(n,e.Oc),0},Q=0,q=(e,t,...n)=>{for(var o=2*n.length,s=Ee(),f=rr(8*o),h=f>>>3,m=0;m<n.length;m++){var b=n[m];typeof b=="bigint"?(ae[h+2*m]=1n,ae[h+2*m+1]=b):(ae[h+2*m]=0n,ye()[h+2*m+1>>>0]=b)}return e=no(e,0,o,f,t),_e(s),e};function Zr(e){if(d)return q(0,1,e);if(M=e,!(0<Q)){for(var t of xt)Fi(t);for(t of ze)Fi(t);ze=[],xt=[],it={},oe=!0}_(0,new Hr(e))}function zi(e){if(d)return q(1,0,e);Xr(e)}var Xr=e=>{if(M=e,d)throw zi(e),"unwind";Zr(e)},ze=[],xt=[],Hi=[],it={},qi=e=>{var t=e.ac;delete it[t],ze.push(e),xt.splice(xt.indexOf(e),1),e.ac=0,io(t)};function Zi(){Hi.forEach(e=>e())}var Xi=e=>new Promise(t=>{e.onmessage=s=>{var f=(s=s.data).dc;if(s.hc&&s.hc!=pn()){var h=it[s.hc];h?h.postMessage(s,s.Oc):N(`Internal error! Worker sent a message "${f}" to target pthread ${s.hc}, but that thread no longer exists!`)}else f==="checkMailbox"?Ht():f==="spawnThread"?Vi(s):f==="cleanupThread"?qi(it[s.$c]):f==="loaded"?(e.loaded=!0,t(e)):s.target==="setimmediate"?e.postMessage(s):f==="callHandler"?i[s.Tc](...s.args):f&&N(`worker sent an unknown command ${f}`)},e.onerror=s=>{throw N(`worker sent an error! ${s.filename}:${s.lineno}: ${s.message}`),s};var n,o=[];for(n of[])i.propertyIsEnumerable(n)&&o.push(n);e.postMessage({dc:"load",Uc:o,bd:L,cd:P})});function Yi(){var e=new Worker((()=>{let t=URL;return self.location.href>"file:"&&self.location.href<"file;"?new t("ort.webgpu.bundle.min.mjs",self.location.href):new URL(self.location.href)})(),{type:"module",workerData:"em-pthread",name:"em-pthread"});ze.push(e)}var Qo=e=>{W();var t=A()[e+52>>>2>>>0];e=A()[e+56>>>2>>>0],so(t,t-e),_e(t)},Ko=(e,t)=>{Q=0,e=lo(e,t),0<Q?M=e:bn(e)};class es{constructor(t){this.ic=t-24}}var me=e=>-9007199254740992>e||9007199254740992<e?NaN:Number(e);function ts(e,t,n){var o=new es(e>>>=0);throw t>>>=0,n>>>=0,A()[o.ic+16>>>2>>>0]=0,A()[o.ic+4>>>2>>>0]=t,A()[o.ic+8>>>2>>>0]=n,e}function Ji(e,t,n,o){return d?q(2,1,e,t,n,o):Qi(e,t,n,o)}function Qi(e,t,n,o){if(e>>>=0,n>>>=0,o>>>=0,y===void 0)return 6;var s=[];return d&&s.length===0?Ji(e,t>>>=0,n,o):(e={Yc:n,ac:e,jc:o,Oc:s},d?(e.dc="spawnThread",postMessage(e,s),0):Vi(e))}var Ki=typeof TextDecoder<"u"?new TextDecoder:void 0,ea=(e,t=0,n=NaN)=>{var o=(t>>>=0)+n;for(n=t;e[n]&&!(n>=o);)++n;if(16<n-t&&e.buffer&&Ki)return Ki.decode(e.buffer instanceof ArrayBuffer?e.subarray(t,n):e.slice(t,n));for(o="";t<n;){var s=e[t++];if(128&s){var f=63&e[t++];if((224&s)==192)o+=String.fromCharCode((31&s)<<6|f);else{var h=63&e[t++];65536>(s=(240&s)==224?(15&s)<<12|f<<6|h:(7&s)<<18|f<<12|h<<6|63&e[t++])?o+=String.fromCharCode(s):(s-=65536,o+=String.fromCharCode(55296|s>>10,56320|1023&s))}}else o+=String.fromCharCode(s)}return o},ct=(e,t)=>(e>>>=0)?ea(Y(),e,t):"";function ta(e,t,n){return d?q(3,1,e,t,n):0}function ra(e,t){if(d)return q(4,1,e,t)}function na(e,t){if(d)return q(5,1,e,t)}function ia(e,t,n){if(d)return q(6,1,e,t,n)}function aa(e,t,n){return d?q(7,1,e,t,n):0}function oa(e,t){if(d)return q(8,1,e,t)}function sa(e,t,n){if(d)return q(9,1,e,t,n)}function la(e,t,n,o){if(d)return q(10,1,e,t,n,o)}function ua(e,t,n,o){if(d)return q(11,1,e,t,n,o)}function fa(e,t,n,o){if(d)return q(12,1,e,t,n,o)}function da(e){if(d)return q(13,1,e)}function ca(e,t){if(d)return q(14,1,e,t)}function pa(e,t,n){if(d)return q(15,1,e,t,n)}var ha,rs=()=>Pe(""),Ie=e=>{for(var t="";Y()[e>>>0];)t+=ha[Y()[e++>>>0]];return t},Yr={},Jr={},pt=i.BindingError=class extends Error{constructor(e){super(e),this.name="BindingError"}};function Ue(e,t,n={}){return(function(o,s,f={}){var h=s.name;if(!o)throw new pt(`type "${h}" must have a positive integer typeid pointer`);if(Jr.hasOwnProperty(o)){if(f.Vc)return;throw new pt(`Cannot register type '${h}' twice`)}Jr[o]=s,Yr.hasOwnProperty(o)&&(s=Yr[o],delete Yr[o],s.forEach(m=>m()))})(e,t,n)}var ya=(e,t,n)=>{switch(t){case 1:return n?o=>re()[o>>>0]:o=>Y()[o>>>0];case 2:return n?o=>xe()[o>>>1>>>0]:o=>dt()[o>>>1>>>0];case 4:return n?o=>S()[o>>>2>>>0]:o=>A()[o>>>2>>>0];case 8:return n?o=>ae[o>>>3]:o=>X[o>>>3];default:throw new TypeError(`invalid integer width (${t}): ${e}`)}};function ns(e,t,n){n>>>=0,Ue(e>>>=0,{name:t=Ie(t>>>0),fromWireType:o=>o,toWireType:function(o,s){if(typeof s!="bigint"&&typeof s!="number")throw s=s===null?"null":(o=typeof s)=="object"||o==="array"||o==="function"?s.toString():""+s,new TypeError(`Cannot convert "${s}" to ${this.name}`);return typeof s=="number"&&(s=BigInt(s)),s},cc:He,readValueFromPointer:ya(t,n,t.indexOf("u")==-1),ec:null})}var He=8;function is(e,t,n,o){Ue(e>>>=0,{name:t=Ie(t>>>0),fromWireType:function(s){return!!s},toWireType:function(s,f){return f?n:o},cc:He,readValueFromPointer:function(s){return this.fromWireType(Y()[s>>>0])},ec:null})}var Qr=[],Le=[];function Kr(e){9<(e>>>=0)&&--Le[e+1]==0&&(Le[e]=void 0,Qr.push(e))}var ue=e=>{if(!e)throw new pt(`Cannot use deleted val. handle = ${e}`);return Le[e]},Te=e=>{switch(e){case void 0:return 2;case null:return 4;case!0:return 6;case!1:return 8;default:let t=Qr.pop()||Le.length;return Le[t]=e,Le[t+1]=1,t}};function en(e){return this.fromWireType(A()[e>>>2>>>0])}var as={name:"emscripten::val",fromWireType:e=>{var t=ue(e);return Kr(e),t},toWireType:(e,t)=>Te(t),cc:He,readValueFromPointer:en,ec:null};function os(e){return Ue(e>>>0,as)}var ss=(e,t)=>{switch(t){case 4:return function(n){return this.fromWireType(ve()[n>>>2>>>0])};case 8:return function(n){return this.fromWireType(ye()[n>>>3>>>0])};default:throw new TypeError(`invalid float width (${t}): ${e}`)}};function ls(e,t,n){n>>>=0,Ue(e>>>=0,{name:t=Ie(t>>>0),fromWireType:o=>o,toWireType:(o,s)=>s,cc:He,readValueFromPointer:ss(t,n),ec:null})}function us(e,t,n,o,s){if(e>>>=0,n>>>=0,t=Ie(t>>>0),s===-1&&(s=4294967295),s=m=>m,o===0){var f=32-8*n;s=m=>m<<f>>>f}var h=t.includes("unsigned")?function(m,b){return b>>>0}:function(m,b){return b};Ue(e,{name:t,fromWireType:s,toWireType:h,cc:He,readValueFromPointer:ya(t,n,o!==0),ec:null})}function fs(e,t,n){function o(f){var h=A()[f>>>2>>>0];return f=A()[f+4>>>2>>>0],new s(re().buffer,f,h)}var s=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array,BigInt64Array,BigUint64Array][t];Ue(e>>>=0,{name:n=Ie(n>>>0),fromWireType:o,cc:He,readValueFromPointer:o},{Vc:!0})}var je=(e,t,n)=>{var o=Y();if(t>>>=0,0<n){var s=t;n=t+n-1;for(var f=0;f<e.length;++f){var h=e.charCodeAt(f);if(55296<=h&&57343>=h&&(h=65536+((1023&h)<<10)|1023&e.charCodeAt(++f)),127>=h){if(t>=n)break;o[t++>>>0]=h}else{if(2047>=h){if(t+1>=n)break;o[t++>>>0]=192|h>>6}else{if(65535>=h){if(t+2>=n)break;o[t++>>>0]=224|h>>12}else{if(t+3>=n)break;o[t++>>>0]=240|h>>18,o[t++>>>0]=128|h>>12&63}o[t++>>>0]=128|h>>6&63}o[t++>>>0]=128|63&h}}o[t>>>0]=0,e=t-s}else e=0;return e},$e=e=>{for(var t=0,n=0;n<e.length;++n){var o=e.charCodeAt(n);127>=o?t++:2047>=o?t+=2:55296<=o&&57343>=o?(t+=4,++n):t+=3}return t};function ds(e,t){Ue(e>>>=0,{name:t=Ie(t>>>0),fromWireType:function(n){for(var o,s=A()[n>>>2>>>0],f=n+4,h=f,m=0;m<=s;++m){var b=f+m;m!=s&&Y()[b>>>0]!=0||(h=ct(h,b-h),o===void 0?o=h:(o+="\0",o+=h),h=b+1)}return Oe(n),o},toWireType:function(n,o){o instanceof ArrayBuffer&&(o=new Uint8Array(o));var s=typeof o=="string";if(!(s||ArrayBuffer.isView(o)&&o.BYTES_PER_ELEMENT==1))throw new pt("Cannot pass non-string to std::string");var f=s?$e(o):o.length,h=yt(4+f+1),m=h+4;return A()[h>>>2>>>0]=f,s?je(o,m,f+1):Y().set(o,m>>>0),n!==null&&n.push(Oe,h),h},cc:He,readValueFromPointer:en,ec(n){Oe(n)}})}var ma=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0,cs=(e,t)=>{for(var n=e>>1,o=n+t/2;!(n>=o)&&dt()[n>>>0];)++n;if(32<(n<<=1)-e&&ma)return ma.decode(Y().slice(e,n));for(n="",o=0;!(o>=t/2);++o){var s=xe()[e+2*o>>>1>>>0];if(s==0)break;n+=String.fromCharCode(s)}return n},ps=(e,t,n)=>{if(n??=2147483647,2>n)return 0;var o=t;n=(n-=2)<2*e.length?n/2:e.length;for(var s=0;s<n;++s){var f=e.charCodeAt(s);xe()[t>>>1>>>0]=f,t+=2}return xe()[t>>>1>>>0]=0,t-o},hs=e=>2*e.length,ys=(e,t)=>{for(var n=0,o="";!(n>=t/4);){var s=S()[e+4*n>>>2>>>0];if(s==0)break;++n,65536<=s?(s-=65536,o+=String.fromCharCode(55296|s>>10,56320|1023&s)):o+=String.fromCharCode(s)}return o},ms=(e,t,n)=>{if(t>>>=0,n??=2147483647,4>n)return 0;var o=t;n=o+n-4;for(var s=0;s<e.length;++s){var f=e.charCodeAt(s);if(55296<=f&&57343>=f&&(f=65536+((1023&f)<<10)|1023&e.charCodeAt(++s)),S()[t>>>2>>>0]=f,(t+=4)+4>n)break}return S()[t>>>2>>>0]=0,t-o},gs=e=>{for(var t=0,n=0;n<e.length;++n){var o=e.charCodeAt(n);55296<=o&&57343>=o&&++n,t+=4}return t};function ws(e,t,n){if(e>>>=0,t>>>=0,n=Ie(n>>>=0),t===2)var o=cs,s=ps,f=hs,h=m=>dt()[m>>>1>>>0];else t===4&&(o=ys,s=ms,f=gs,h=m=>A()[m>>>2>>>0]);Ue(e,{name:n,fromWireType:m=>{for(var b,T=A()[m>>>2>>>0],x=m+4,E=0;E<=T;++E){var B=m+4+E*t;E!=T&&h(B)!=0||(x=o(x,B-x),b===void 0?b=x:(b+="\0",b+=x),x=B+t)}return Oe(m),b},toWireType:(m,b)=>{if(typeof b!="string")throw new pt(`Cannot pass non-string to C++ string type ${n}`);var T=f(b),x=yt(4+T+t);return A()[x>>>2>>>0]=T/t,s(b,x+4,T+t),m!==null&&m.push(Oe,x),x},cc:He,readValueFromPointer:en,ec(m){Oe(m)}})}function bs(e,t){Ue(e>>>=0,{Wc:!0,name:t=Ie(t>>>0),cc:0,fromWireType:()=>{},toWireType:()=>{}})}function vs(e){wn(e>>>0,!c,1,!p,131072,!1),Zi()}var tn=e=>{if(!oe)try{if(e(),!(0<Q))try{d?bn(M):Xr(M)}catch(t){t instanceof Hr||t=="unwind"||_(0,t)}}catch(t){t instanceof Hr||t=="unwind"||_(0,t)}};function rn(e){e>>>=0,typeof Atomics.ad=="function"&&(Atomics.ad(S(),e>>>2,e).value.then(Ht),e+=128,Atomics.store(S(),e>>>2,1))}var Ht=()=>{var e=pn();e&&(rn(e),tn(oo))};function Cs(e,t){(e>>>=0)==t>>>0?setTimeout(Ht):d?postMessage({hc:e,dc:"checkMailbox"}):(e=it[e])&&e.postMessage({dc:"checkMailbox"})}var nn=[];function Ts(e,t,n,o,s){for(t>>>=0,o/=2,nn.length=o,n=s>>>0>>>3,s=0;s<o;s++)nn[s]=ae[n+2*s]?ae[n+2*s+1]:ye()[n+2*s+1>>>0];return(t?dn[t]:au[e])(...nn)}var _s=()=>{Q=0};function Es(e){e>>>=0,d?postMessage({dc:"cleanupThread",$c:e}):qi(it[e])}function As(e){}var qt=(e,t)=>{var n=Jr[e];if(n===void 0)throw e=Wa(e),n=Ie(e),Oe(e),new pt(`${t} has unknown type ${n}`);return n},ga=(e,t,n)=>{var o=[];return e=e.toWireType(o,n),o.length&&(A()[t>>>2>>>0]=Te(o)),e};function xs(e,t,n){return t>>>=0,n>>>=0,e=ue(e>>>0),t=qt(t,"emval::as"),ga(t,n,e)}function Os(e,t){return t>>>=0,e=ue(e>>>0),(t=qt(t,"emval::as")).toWireType(null,e)}var Zt=e=>{try{e()}catch(t){Pe(t)}},qe=0,Me=null,wa=0,Xt=[],ba={},va={},Ss=0,an=null,Is=[];function Ca(e){return(function(t){if(!oe){if(qe===0){var n=!1,o=!1;t((s=0)=>{if(!oe&&(wa=s,n=!0,o)){qe=2,Zt(()=>co(Me)),typeof MainLoop<"u"&&MainLoop.Sc&&MainLoop.resume(),s=!1;try{var f=(function(){var b=S()[Me+8>>>2>>>0];return b=g[va[b]],--Q,b()})()}catch(b){f=b,s=!0}var h=!1;if(!Me){var m=an;m&&(an=null,(s?m.reject:m.resolve)(f),h=!0)}if(s&&!h)throw f}}),o=!0,n||(qe=1,Me=(function(){var s=yt(65548),f=s+12;A()[s>>>2>>>0]=f,A()[s+4>>>2>>>0]=f+65536,f=Xt[0];var h=ba[f];return h===void 0&&(h=Ss++,ba[f]=h,va[h]=f),f=h,S()[s+8>>>2>>>0]=f,s})(),typeof MainLoop<"u"&&MainLoop.Sc&&MainLoop.pause(),Zt(()=>uo(Me)))}else qe===2?(qe=0,Zt(po),Oe(Me),Me=null,Is.forEach(tn)):Pe(`invalid state: ${qe}`);return wa}})(t=>{e().then(t)})}function Ms(e){return e>>>=0,Ca(async()=>{var t=await ue(e);return Te(t)})}var Yt=[];function Bs(e,t,n,o){return n>>>=0,o>>>=0,(e=Yt[e>>>0])(null,t=ue(t>>>0),n,o)}var Rs={},Jt=e=>{var t=Rs[e];return t===void 0?Ie(e):t};function Ps(e,t,n,o,s){return n>>>=0,o>>>=0,s>>>=0,(e=Yt[e>>>0])(t=ue(t>>>0),t[n=Jt(n)],o,s)}function Us(e,t){return t>>>=0,(e=ue(e>>>0))==ue(t)}var Ta=()=>typeof globalThis=="object"?globalThis:Function("return this")();function Ls(e){return(e>>>=0)==0?Te(Ta()):(e=Jt(e),Te(Ta()[e]))}var js=e=>{var t=Yt.length;return Yt.push(e),t},$s=(e,t)=>{for(var n=Array(e),o=0;o<e;++o)n[o]=qt(A()[t+4*o>>>2>>>0],`parameter ${o}`);return n};function ks(e,t,n){var o=(t=$s(e,t>>>0)).shift();e--;var s=`return function (obj, func, destructorsRef, args) {
`,f=0,h=[];n===0&&h.push("obj");for(var m=["retType"],b=[o],T=0;T<e;++T)h.push(`arg${T}`),m.push(`argType${T}`),b.push(t[T]),s+=`  var arg${T} = argType${T}.readValueFromPointer(args${f?"+"+f:""});
`,f+=t[T].cc;return s+=`  var rv = ${n===1?"new func":"func.call"}(${h.join(", ")});
`,o.Wc||(m.push("emval_returnValue"),b.push(ga),s+=`  return emval_returnValue(retType, destructorsRef, rv);
`),e=new Function(...m,s+`};
`)(...b),n=`methodCaller<(${t.map(x=>x.name).join(", ")}) => ${o.name}>`,js(Object.defineProperty(e,"name",{value:n}))}function Ns(e){return e=Jt(e>>>0),Te(i[e])}function Ds(e,t){return t>>>=0,e=ue(e>>>0),t=ue(t),Te(e[t])}function Ws(e){9<(e>>>=0)&&(Le[e+1]+=1)}function Gs(){return Te([])}function Fs(e){e=ue(e>>>0);for(var t=Array(e.length),n=0;n<e.length;n++)t[n]=e[n];return Te(t)}function Vs(e){return Te(Jt(e>>>0))}function zs(){return Te({})}function Hs(e){for(var t=ue(e>>>=0);t.length;){var n=t.pop();t.pop()(n)}Kr(e)}function qs(e,t,n){t>>>=0,n>>>=0,e=ue(e>>>0),t=ue(t),n=ue(n),e[t]=n}function Zs(e,t){return t>>>=0,e=(e=qt(e>>>0,"_emval_take_value")).readValueFromPointer(t),Te(e)}function Xs(e,t){e=me(e),t>>>=0,e=new Date(1e3*e),S()[t>>>2>>>0]=e.getUTCSeconds(),S()[t+4>>>2>>>0]=e.getUTCMinutes(),S()[t+8>>>2>>>0]=e.getUTCHours(),S()[t+12>>>2>>>0]=e.getUTCDate(),S()[t+16>>>2>>>0]=e.getUTCMonth(),S()[t+20>>>2>>>0]=e.getUTCFullYear()-1900,S()[t+24>>>2>>>0]=e.getUTCDay(),e=(e.getTime()-Date.UTC(e.getUTCFullYear(),0,1,0,0,0,0))/864e5|0,S()[t+28>>>2>>>0]=e}var _a=e=>e%4==0&&(e%100!=0||e%400==0),Ea=[0,31,60,91,121,152,182,213,244,274,305,335],Aa=[0,31,59,90,120,151,181,212,243,273,304,334];function Ys(e,t){e=me(e),t>>>=0,e=new Date(1e3*e),S()[t>>>2>>>0]=e.getSeconds(),S()[t+4>>>2>>>0]=e.getMinutes(),S()[t+8>>>2>>>0]=e.getHours(),S()[t+12>>>2>>>0]=e.getDate(),S()[t+16>>>2>>>0]=e.getMonth(),S()[t+20>>>2>>>0]=e.getFullYear()-1900,S()[t+24>>>2>>>0]=e.getDay();var n=(_a(e.getFullYear())?Ea:Aa)[e.getMonth()]+e.getDate()-1|0;S()[t+28>>>2>>>0]=n,S()[t+36>>>2>>>0]=-60*e.getTimezoneOffset(),n=new Date(e.getFullYear(),6,1).getTimezoneOffset();var o=new Date(e.getFullYear(),0,1).getTimezoneOffset();e=0|(n!=o&&e.getTimezoneOffset()==Math.min(o,n)),S()[t+32>>>2>>>0]=e}function Js(e){e>>>=0;var t=new Date(S()[e+20>>>2>>>0]+1900,S()[e+16>>>2>>>0],S()[e+12>>>2>>>0],S()[e+8>>>2>>>0],S()[e+4>>>2>>>0],S()[e>>>2>>>0],0),n=S()[e+32>>>2>>>0],o=t.getTimezoneOffset(),s=new Date(t.getFullYear(),6,1).getTimezoneOffset(),f=new Date(t.getFullYear(),0,1).getTimezoneOffset(),h=Math.min(f,s);return 0>n?S()[e+32>>>2>>>0]=+(s!=f&&h==o):0<n!=(h==o)&&(s=Math.max(f,s),t.setTime(t.getTime()+6e4*((0<n?h:s)-o))),S()[e+24>>>2>>>0]=t.getDay(),n=(_a(t.getFullYear())?Ea:Aa)[t.getMonth()]+t.getDate()-1|0,S()[e+28>>>2>>>0]=n,S()[e>>>2>>>0]=t.getSeconds(),S()[e+4>>>2>>>0]=t.getMinutes(),S()[e+8>>>2>>>0]=t.getHours(),S()[e+12>>>2>>>0]=t.getDate(),S()[e+16>>>2>>>0]=t.getMonth(),S()[e+20>>>2>>>0]=t.getYear(),e=t.getTime(),BigInt(isNaN(e)?-1:e/1e3)}function xa(e,t,n,o,s,f,h){return d?q(16,1,e,t,n,o,s,f,h):-52}function Oa(e,t,n,o,s,f){if(d)return q(17,1,e,t,n,o,s,f)}var Ot={},Qs=()=>performance.timeOrigin+performance.now();function Sa(e,t){if(d)return q(18,1,e,t);if(Ot[e]&&(clearTimeout(Ot[e].id),delete Ot[e]),!t)return 0;var n=setTimeout(()=>{delete Ot[e],tn(()=>ao(e,performance.timeOrigin+performance.now()))},t);return Ot[e]={id:n,nd:t},0}function Ks(e,t,n,o){e>>>=0,t>>>=0,n>>>=0,o>>>=0;var s=new Date().getFullYear(),f=new Date(s,0,1).getTimezoneOffset();s=new Date(s,6,1).getTimezoneOffset();var h=Math.max(f,s);A()[e>>>2>>>0]=60*h,S()[t>>>2>>>0]=+(f!=s),e=(t=m=>{var b=Math.abs(m);return`UTC${0<=m?"-":"+"}${String(Math.floor(b/60)).padStart(2,"0")}${String(b%60).padStart(2,"0")}`})(f),t=t(s),s<f?(je(e,n,17),je(t,o,17)):(je(e,o,17),je(t,n,17))}var el=()=>Date.now();function tl(e,t,n){return 0<=e&&3>=e?(e===0?e=Date.now():e=performance.timeOrigin+performance.now(),ae[n>>>0>>>3]=BigInt(Math.round(1e6*e)),0):28}var on=[],Ia=(e,t)=>{on.length=0;for(var n;n=Y()[e++>>>0];){var o=n!=105;t+=(o&=n!=112)&&t%8?4:0,on.push(n==112?A()[t>>>2>>>0]:n==106?ae[t>>>3]:n==105?S()[t>>>2>>>0]:ye()[t>>>3>>>0]),t+=o?8:4}return on};function rl(e,t,n){return e>>>=0,t=Ia(t>>>0,n>>>0),dn[e](...t)}function nl(e,t,n){return e>>>=0,t=Ia(t>>>0,n>>>0),dn[e](...t)}var il=()=>{};function al(e,t){return N(ct(e>>>0,t>>>0))}var ol=()=>{throw Q+=1,"unwind"};function sl(){return 4294901760}var ll=()=>1,ul=()=>navigator.hardwareConcurrency;function fl(){return Pe("Cannot use emscripten_pc_get_function without -sUSE_OFFSET_CONVERTER"),0}function dl(e){e>>>=0;var t=Y().length;if(e<=t||4294901760<e)return!1;for(var n=1;4>=n;n*=2){var o=t*(1+.2/n);o=Math.min(o,e+100663296);e:{o=(Math.min(4294901760,65536*Math.ceil(Math.max(e,o)/65536))-L.buffer.byteLength+65535)/65536|0;try{L.grow(o),W();var s=1;break e}catch{}s=void 0}if(s)return!0}return!1}var Qt=()=>(Pe("Cannot use convertFrameToPC (needed by __builtin_return_address) without -sUSE_OFFSET_CONVERTER"),0),St={},Ma=e=>{e.forEach(t=>{Qt()})};function cl(){var e=Error().stack.toString().split(`
`);return e[0]=="Error"&&e.shift(),Ma(e),St.oc=Qt(),St.Xc=e,St.oc}function pl(e,t,n){if(e>>>=0,t>>>=0,St.oc==e)var o=St.Xc;else(o=Error().stack.toString().split(`
`))[0]=="Error"&&o.shift(),Ma(o);for(var s=3;o[s]&&Qt()!=e;)++s;for(e=0;e<n&&o[e+s];++e)S()[t+4*e>>>2>>>0]=Qt();return e}var ke=e=>{var t=$e(e)+1,n=rr(t);return je(e,n,t),n},sn=[],fe=(e,t)=>{sn[e>>>=0]=t},Be=[],Kt=[],It=(e,t)=>{Kt[e]=new Promise(n=>t.finally(()=>n(e)))},I=e=>{if(e)return sn[e>>>0]},er=(e,t,n)=>{A()[e>>>2>>>0]=t,A()[e+4>>>2>>>0]=n},Ba=e=>{var t=A()[e>>>2>>>0];return e=A()[e+4>>>2>>>0],ct(t,e)},Ne=e=>{var t=A()[e>>>2>>>0];return e=A()[e+4>>>2>>>0],t?ct(t,e):e===0?"":void 0},Ra=(e,t)=>{function n(s,f){s=e[s],S()[t+f>>>2>>>0]=s}function o(s,f){ae[t+f>>>3]=BigInt(e[s])}n("maxTextureDimension1D",4),n("maxTextureDimension2D",8),n("maxTextureDimension3D",12),n("maxTextureArrayLayers",16),n("maxBindGroups",20),n("maxBindGroupsPlusVertexBuffers",24),n("maxBindingsPerBindGroup",28),n("maxDynamicUniformBuffersPerPipelineLayout",32),n("maxDynamicStorageBuffersPerPipelineLayout",36),n("maxSampledTexturesPerShaderStage",40),n("maxSamplersPerShaderStage",44),n("maxStorageBuffersPerShaderStage",48),n("maxStorageTexturesPerShaderStage",52),n("maxUniformBuffersPerShaderStage",56),n("minUniformBufferOffsetAlignment",80),n("minStorageBufferOffsetAlignment",84),o("maxUniformBufferBindingSize",64),o("maxStorageBufferBindingSize",72),n("maxVertexBuffers",88),o("maxBufferSize",96),n("maxVertexAttributes",104),n("maxVertexBufferArrayStride",108),n("maxInterStageShaderVariables",112),n("maxColorAttachments",116),n("maxColorAttachmentBytesPerSample",120),n("maxComputeWorkgroupStorageSize",124),n("maxComputeInvocationsPerWorkgroup",128),n("maxComputeWorkgroupSizeX",132),n("maxComputeWorkgroupSizeY",136),n("maxComputeWorkgroupSizeZ",140),n("maxComputeWorkgroupsPerDimension",144),e.kd!==void 0&&n("maxImmediateSize",148)},hl={undefined:1,pd:1,gd:2},yl={1:"validation",2:"out-of-memory",3:"internal"},ml=[,"compatibility","core"],ln={1:"depth-clip-control",2:"depth32float-stencil8",3:"timestamp-query",4:"texture-compression-bc",5:"texture-compression-bc-sliced-3d",6:"texture-compression-etc2",7:"texture-compression-astc",8:"texture-compression-astc-sliced-3d",9:"indirect-first-instance",10:"shader-f16",11:"rg11b10ufloat-renderable",12:"bgra8unorm-storage",13:"float32-filterable",14:"float32-blendable",15:"clip-distances",16:"dual-source-blending",17:"subgroups",18:"core-features-and-limits",327692:"chromium-experimental-unorm16-texture-formats",327693:"chromium-experimental-snorm16-texture-formats",327732:"chromium-experimental-multi-draw-indirect"},gl=[,"low-power","high-performance"],wl={1:"occlusion",2:"timestamp"},bl={"depth-clip-control":"1","depth32float-stencil8":"2","timestamp-query":"3","texture-compression-bc":"4","texture-compression-bc-sliced-3d":"5","texture-compression-etc2":"6","texture-compression-astc":"7","texture-compression-astc-sliced-3d":"8","indirect-first-instance":"9","shader-f16":"10","rg11b10ufloat-renderable":"11","bgra8unorm-storage":"12","float32-filterable":"13","float32-blendable":"14","clip-distances":"15","dual-source-blending":"16",md:"17","core-features-and-limits":"18","chromium-experimental-unorm16-texture-formats":"327692","chromium-experimental-snorm16-texture-formats":"327693","chromium-experimental-multi-draw-indirect":"327732"};function vl(e,t,n,o,s,f){t=me(t),n=me(n),o>>>=0,s>>>=0,f>>>=0,e=I(e>>>0);var h={};if(f){var m=A()[f+12>>>2>>>0];if(m){var b=A()[f+16>>>2>>>0];h.requiredFeatures=Array.from(A().subarray(b>>>2>>>0,b+4*m>>>2>>>0),E=>ln[E])}var T=A()[f+20>>>2>>>0];if(T){let E=function(G,z,de=!1){z=T+z,(z=A()[z>>>2>>>0])==4294967295||de&&z==0||(x[G]=z)},B=function(G,z){z=T+z;var de=A()[z>>>2>>>0],Se=A()[z+4>>>2>>>0];de==4294967295&&Se==4294967295||(x[G]=4294967296*A()[z+4>>>2>>>0]+A()[z>>>2>>>0])};var x={};E("maxTextureDimension1D",4),E("maxTextureDimension2D",8),E("maxTextureDimension3D",12),E("maxTextureArrayLayers",16),E("maxBindGroups",20),E("maxBindGroupsPlusVertexBuffers",24),E("maxDynamicUniformBuffersPerPipelineLayout",32),E("maxDynamicStorageBuffersPerPipelineLayout",36),E("maxSampledTexturesPerShaderStage",40),E("maxSamplersPerShaderStage",44),E("maxStorageBuffersPerShaderStage",48),E("maxStorageTexturesPerShaderStage",52),E("maxUniformBuffersPerShaderStage",56),E("minUniformBufferOffsetAlignment",80),E("minStorageBufferOffsetAlignment",84),B("maxUniformBufferBindingSize",64),B("maxStorageBufferBindingSize",72),E("maxVertexBuffers",88),B("maxBufferSize",96),E("maxVertexAttributes",104),E("maxVertexBufferArrayStride",108),E("maxInterStageShaderVariables",112),E("maxColorAttachments",116),E("maxColorAttachmentBytesPerSample",120),E("maxComputeWorkgroupStorageSize",124),E("maxComputeInvocationsPerWorkgroup",128),E("maxComputeWorkgroupSizeX",132),E("maxComputeWorkgroupSizeY",136),E("maxComputeWorkgroupSizeZ",140),E("maxComputeWorkgroupsPerDimension",144),E("maxImmediateSize",148,!0),h.requiredLimits=x}(m=A()[f+24>>>2>>>0])&&(m={label:Ne(m+4)},h.defaultQueue=m),h.label=Ne(f+4)}Q+=1,It(t,e.requestDevice(h).then(E=>{--Q,fe(s,E.queue),fe(o,E),n&&(Q+=1,It(n,E.lost.then(B=>{--Q,E.onuncapturederror=()=>{};var G=Ee(),z=ke(B.message);hn(n,hl[B.reason],z),_e(G)}))),E.onuncapturederror=B=>{var G=5;B.error instanceof GPUValidationError?G=2:B.error instanceof GPUOutOfMemoryError?G=3:B.error instanceof GPUInternalError&&(G=4);var z=Ee();B=ke(B.error.message),to(o,G,B),_e(z)},gn(t,1,o,0)},E=>{--Q;var B=Ee();E=ke(E.message),gn(t,3,o,E),n&&hn(n,4,E),_e(B)}))}function Cl(e){var t=I(e>>>=0),n=Be[e];if(n){for(var o=0;o<n.length;++o)n[o]();delete Be[e]}t.destroy()}var ht=()=>{var e="getMappedRange size=0 no longer means WGPU_WHOLE_MAP_SIZE";ht.kc||(ht.kc={}),ht.kc[e]||(ht.kc[e]=1,N(e))};function Tl(e,t,n){t>>>=0,n>>>=0;var o=I(e>>>=0);n===0&&ht(),n==4294967295&&(n=void 0);try{var s=o.getMappedRange(t,n)}catch{return 0}var f=vn(16,s.byteLength);return Y().set(new Uint8Array(s),f>>>0),Be[e].push(()=>Oe(f)),f}function _l(e,t,n){t>>>=0,n>>>=0;var o=I(e>>>=0);n===0&&ht(),n==4294967295&&(n=void 0);try{var s=o.getMappedRange(t,n)}catch{return 0}var f=vn(16,s.byteLength);return Y().fill(0,f,s.byteLength),Be[e].push(()=>{new Uint8Array(s).set(Y().subarray(f>>>0,f+s.byteLength>>>0)),Oe(f)}),f}function El(e,t,n,o,s){e>>>=0,t=me(t),n=me(n),s>>>=0;var f=I(e);Be[e]=[],s==4294967295&&(s=void 0),Q+=1,It(t,f.mapAsync(n,o>>>0,s).then(()=>{--Q,yn(t,1,0)},h=>{--Q,Ee();var m=ke(h.message);yn(t,h.name==="AbortError"?4:h.name==="OperationError"?3:0,m),delete Be[e]}))}function Al(e){var t=I(e>>>=0),n=Be[e];if(n){for(var o=0;o<n.length;++o)n[o]();delete Be[e],t.unmap()}}function xl(e){delete sn[e>>>0]}function Ol(e,t,n){e>>>=0,t>>>=0,n>>>=0;var o=!!A()[t+32>>>2>>>0];t={label:Ne(t+4),usage:A()[t+16>>>2>>>0],size:4294967296*A()[t+28>>>2>>>0]+A()[t+24>>>2>>>0],mappedAtCreation:o},e=I(e);try{var s=e.createBuffer(t)}catch{return!1}return fe(n,s),o&&(Be[n]=[]),!0}function Sl(e,t,n){e>>>=0,t>>>=0,n>>>=0;var o=A()[t>>>2>>>0],s=A()[o+4>>>2>>>0];t={label:Ne(t+4),code:""},s===2&&(t.code=Ba(o+8)),fe(n,I(e).createShaderModule(t))}var Il=e=>{I(e).destroy()};function Ml(e,t){t=me(t),e=I(e>>>0),Q+=1,It(t,e.popErrorScope().then(n=>{--Q;var o=5;n?n instanceof GPUValidationError?o=2:n instanceof GPUOutOfMemoryError?o=3:n instanceof GPUInternalError&&(o=4):o=1;var s=Ee();n=n?ke(n.message):0,mn(t,1,o,n),_e(s)},n=>{--Q;var o=Ee();n=ke(n.message),mn(t,1,5,n),_e(o)}))}function Bl(e,t,n,o){if(t=me(t),o>>>=0,n>>>=0){var s=A()[n+4>>>2>>>0];s={featureLevel:ml[s],powerPreference:gl[A()[n+8>>>2>>>0]],forceFallbackAdapter:!!A()[n+12>>>2>>>0]},(n=A()[n>>>2>>>0])!==0&&(A(),s.rd=!!A()[n+8>>>2>>>0])}"gpu"in navigator?(Q+=1,It(t,navigator.gpu.requestAdapter(s).then(f=>{if(--Q,f)fe(o,f),Mt(t,1,o,0);else{f=Ee();var h=ke("WebGPU not available on this browser (requestAdapter returned null)");Mt(t,3,o,h),_e(f)}},f=>{--Q;var h=Ee();f=ke(f.message),Mt(t,4,o,f),_e(h)}))):(n=Ee(),s=ke("WebGPU not available on this browser (navigator.gpu is not available)"),Mt(t,3,o,s),_e(n))}function Rl(e,t,n){return e>>>=0,t>>>=0,n>>>=0,Ca(async()=>{var o=[];if(n){var s=S()[n>>>2>>>0];o.length=t+1,o[t]=new Promise(m=>setTimeout(m,s,0))}else o.length=t;for(var f=0;f<t;++f){var h=4294967296*A()[e+8*f+4>>>2>>>0]+A()[e+8*f>>>2>>>0];if(!(h in Kt))return h;o[f]=Kt[h]}return o=await Promise.race(o),delete Kt[o],o})}var un,fn={},Pa=()=>{if(!un){var e,t={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:"./this.program"};for(e in fn)fn[e]===void 0?delete t[e]:t[e]=fn[e];var n=[];for(e in t)n.push(`${e}=${t[e]}`);un=n}return un};function Ua(e,t){if(d)return q(19,1,e,t);e>>>=0,t>>>=0;var n,o=0,s=0;for(n of Pa()){var f=t+o;A()[e+s>>>2>>>0]=f,o+=je(n,f,1/0)+1,s+=4}return 0}function La(e,t){if(d)return q(20,1,e,t);e>>>=0,t>>>=0;var n=Pa();for(var o of(A()[e>>>2>>>0]=n.length,e=0,n))e+=$e(o)+1;return A()[t>>>2>>>0]=e,0}function ja(e){return d?q(21,1,e):52}function $a(e,t,n,o){return d?q(22,1,e,t,n,o):52}function ka(e,t,n,o){return d?q(23,1,e,t,n,o):70}var Pl=[null,[],[]];function Na(e,t,n,o){if(d)return q(24,1,e,t,n,o);t>>>=0,n>>>=0,o>>>=0;for(var s=0,f=0;f<n;f++){var h=A()[t>>>2>>>0],m=A()[t+4>>>2>>>0];t+=8;for(var b=0;b<m;b++){var T=e,x=Y()[h+b>>>0],E=Pl[T];x===0||x===10?((T===1?ft:N)(ea(E)),E.length=0):E.push(x)}s+=m}return A()[o>>>2>>>0]=s,0}function Ul(e,t){return Ra(I(e>>>0).limits,t>>>0),1}function Ll(e,t){return I(e>>>0).features.has(ln[t])}function jl(e){return BigInt(I(e>>>0).size)}function $l(e){return BigInt(I(e>>>0).usage)}function kl(e,t){if(e>>>=0,t>>>=0){var n=Ne(t+4);n={label:n,timestampWrites:t=(t=A()[t+12>>>2>>>0])!==0?{querySet:I(A()[t+4>>>2>>>0]),beginningOfPassWriteIndex:A()[t+8>>>2>>>0],endOfPassWriteIndex:A()[t+12>>>2>>>0]}:void 0}}return e=I(e),t=Xa(0),fe(t,e.beginComputePass(n)),t}function Nl(e,t,n,o,s,f){n=me(n),s=me(s),f=me(f),I(e>>>0).copyBufferToBuffer(I(t>>>0),n,I(o>>>0),s,f)}function Dl(e){e=I(e>>>0);var t=qa(0);return fe(t,e.finish()),t}function Wl(e,t,n,o,s,f){f=me(f),I(e>>>0).resolveQuerySet(I(t>>>0),n,o,I(s>>>0),f)}function Gl(e,t,n,o){I(e>>>0).dispatchWorkgroups(t,n,o)}function Fl(e){I(e>>>0).end()}function Vl(e,t,n,o,s){o>>>=0,s>>>=0,e=I(e>>>0),n=I(n>>>0),o==0?e.setBindGroup(t,n):e.setBindGroup(t,n,A(),s>>>2,o)}function zl(e,t){I(e>>>0).setPipeline(I(t>>>0))}function Hl(e,t,n){I(e>>>0).qd(I(t>>>0),n)}function ql(e,t){e=I(e>>>0);var n=Ha(0);return fe(n,e.getBindGroupLayout(t)),n}function Zl(e,t){e>>>=0;var n=Ne(4+(t>>>=0)),o=I(A()[t+12>>>2>>>0]),s=A()[t+16>>>2>>>0];t=A()[t+20>>>2>>>0];for(var f=[],h=0;h<s;++h){var m=f,b=m.push,T=t+40*h,x=A()[T+8>>>2>>>0],E=A()[T+32>>>2>>>0],B=A()[T+36>>>2>>>0],G=A()[T+4>>>2>>>0];x?(E=T+24,(E=A()[E>>>2>>>0]+4294967296*S()[E+4>>>2>>>0])==-1&&(E=void 0),T={binding:G,resource:{buffer:I(x),offset:4294967296*A()[T+4+16>>>2>>>0]+A()[T+16>>>2>>>0],size:E}}):T=E?{binding:G,resource:I(E)}:{binding:G,resource:I(B)},b.call(m,T)}return n={label:n,layout:o,entries:f},e=I(e),o=za(0),fe(o,e.createBindGroup(n)),o}function Xl(e,t){var n;return e>>>=0,(t>>>=0)&&(n={label:Ne(t+4)}),e=I(e),t=Za(0),fe(t,e.createCommandEncoder(n)),t}function Yl(e,t){e>>>=0;var n=t>>>0;t=Ne(n+4);var o=(o=A()[n+12>>>2>>>0])?I(o):"auto";if(n+=16){var s=I(A()[n+4>>>2>>>0]),f=A()[n+16>>>2>>>0],h=A()[n+20>>>2>>>0];if(f){for(var m={},b=0;b<f;++b){var T=h+24*b;m[Ba(T+4)]=ye()[T+16>>>3>>>0]}f=m}else f=void 0;n={module:s,constants:f,entryPoint:Ne(n+8)}}else n=void 0;return t={label:t,layout:o,compute:n},e=I(e),o=Ya(0),fe(o,e.createComputePipeline(t)),o}function Jl(e,t){e>>>=0,t>>>=0,t={type:wl[A()[t+12>>>2>>>0]],count:A()[t+16>>>2>>>0]},e=I(e);var n=Ja(0);return fe(n,e.createQuerySet(t)),n}function Ql(e,t){e=I(e>>>0).adapterInfo,t>>>=0,S()[t+52>>>2>>>0]=e.subgroupMinSize,S()[t+56>>>2>>>0]=e.subgroupMaxSize;var n=e.vendor+e.architecture+e.device+e.description,o=$e(n)+1,s=yt(o);return s&&je(n,s,o),n=s,o=$e(e.vendor),er(t+4,n,o),n+=o,o=$e(e.architecture),er(t+12,n,o),n+=o,o=$e(e.device),er(t+20,n,o),er(t+28,n+o,$e(e.description)),S()[t+36>>>2>>>0]=2,e=e.isFallbackAdapter?3:4,S()[t+40>>>2>>>0]=e,S()[t+44>>>2>>>0]=0,S()[t+48>>>2>>>0]=0,1}function Kl(e,t){t>>>=0,e=I(e>>>0);var n=yt(4*e.features.size),o=0,s=0;e.features.forEach(f=>{(f=bl[f])!==void 0&&(S()[n+o>>>2>>>0]=f,o+=4,s++)}),A()[t+4>>>2>>>0]=n,A()[t>>>2>>>0]=s}function eu(e,t){return Ra(I(e>>>0).limits,t>>>0),1}function tu(e,t){return I(e>>>0).features.has(ln[t])}function ru(e,t){I(e>>>0).pushErrorScope(yl[t])}function nu(e,t,n){t>>>=0,n>>>=0,e=I(e>>>0),t=Array.from(S().subarray(n>>>2>>>0,n+4*t>>>2>>>0),o=>I(o)),e.submit(t)}function iu(e,t,n,o,s){n=me(n),o>>>=0,s>>>=0,e=I(e>>>0),t=I(t>>>0),o=Y().subarray(o>>>0,o+s>>>0),e.writeBuffer(t,n,o,0,s)}d||(function(){for(var e=i.numThreads-1;e--;)Yi();qr.push(()=>{Re++,(function(t){d?t():Promise.all(ze.map(Xi)).then(t)})(()=>Wi())})})();for(var Da=Array(256),tr=0;256>tr;++tr)Da[tr]=String.fromCharCode(tr);ha=Da,Le.push(0,1,void 0,1,null,1,!0,1,!1,1),i.count_emval_handles=()=>Le.length/2-5-Qr.length,d||(L=new WebAssembly.Memory({initial:256,maximum:65536,shared:!0}),W()),i.wasmBinary&&(j=i.wasmBinary),i.stackSave=()=>Ee(),i.stackRestore=e=>_e(e),i.stackAlloc=e=>rr(e),i.setValue=function(e,t,n="i8"){switch(n.endsWith("*")&&(n="*"),n){case"i1":case"i8":re()[e>>>0]=t;break;case"i16":xe()[e>>>1>>>0]=t;break;case"i32":S()[e>>>2>>>0]=t;break;case"i64":ae[e>>>3]=BigInt(t);break;case"float":ve()[e>>>2>>>0]=t;break;case"double":ye()[e>>>3>>>0]=t;break;case"*":A()[e>>>2>>>0]=t;break;default:Pe(`invalid type for setValue: ${n}`)}},i.getValue=function(e,t="i8"){switch(t.endsWith("*")&&(t="*"),t){case"i1":case"i8":return re()[e>>>0];case"i16":return xe()[e>>>1>>>0];case"i32":return S()[e>>>2>>>0];case"i64":return ae[e>>>3];case"float":return ve()[e>>>2>>>0];case"double":return ye()[e>>>3>>>0];case"*":return A()[e>>>2>>>0];default:Pe(`invalid type for getValue: ${t}`)}},i.UTF8ToString=ct,i.stringToUTF8=je,i.lengthBytesUTF8=$e;var au=[Zr,zi,Ji,ta,ra,na,ia,aa,oa,sa,la,ua,fa,da,ca,pa,xa,Oa,Sa,Ua,La,ja,$a,ka,Na],dn={1048636:(e,t,n,o,s)=>{if(i===void 0||!i.fc)return 1;if((e=ct(Number(e>>>0))).startsWith("./")&&(e=e.substring(2)),!(e=i.fc.get(e)))return 2;if(t=Number(t>>>0),n=Number(n>>>0),o=Number(o>>>0),t+n>e.byteLength)return 3;try{let f=e.subarray(t,t+n);switch(s){case 0:Y().set(f,o>>>0);break;case 1:i.Pc?i.Pc(o,f):i.jd(o,f);break;default:return 4}return 0}catch{return 4}},1049460:(e,t,n)=>{i.Rc(e,Y().subarray(t>>>0,t+n>>>0))},1049524:()=>i.ed(),1049566:e=>{i.Qc(e)},1049603:()=>typeof wasmOffsetConverter<"u"};function ou(){return typeof wasmOffsetConverter<"u"}var g=await(async function(){function e(o,s){return g=o.exports,g=(function(){var f=g,h={};for(let[m,b]of Object.entries(f))h[m]=typeof b=="function"?(...T)=>{Xt.push(m);try{return b(...T)}finally{oe||(Xt.pop(),Me&&qe===1&&Xt.length===0&&(qe=0,Q+=1,Zt(fo),typeof Fibers<"u"&&Fibers.od()))}}:b;return h})(),g=(function(){var f=g,h=b=>T=>b(T)>>>0,m=b=>()=>b()>>>0;return(f=Object.assign({},f)).ob=h(f.ob),f.Rb=m(f.Rb),f.Tb=h(f.Tb),f.Dc=(b=>(T,x)=>b(T,x)>>>0)(f.Dc),f.Gc=h(f.Gc),f.Hc=m(f.Hc),f.__cxa_get_exception_ptr=h(f.__cxa_get_exception_ptr),f})(),Hi.push(g.vc),P=s,Wi(),g}Re++;var t=Gi();if(i.instantiateWasm)return new Promise(o=>{i.instantiateWasm(t,(s,f)=>{o(e(s,f))})});if(d)return new Promise(o=>{Et=s=>{var f=new WebAssembly.Instance(s,Gi());o(e(f,s))}});nt??=i.locateFile?i.locateFile?i.locateFile("ort-wasm-simd-threaded.asyncify.wasm",R):R+"ort-wasm-simd-threaded.asyncify.wasm":new URL("/assets/ort-wasm-simd-threaded.asyncify-BJtBjfiH.wasm",self.location.href).href;try{var n=await(async function(o){var s=nt;if(!j&&typeof WebAssembly.instantiateStreaming=="function"&&!K(s))try{var f=fetch(s,{credentials:"same-origin"});return await WebAssembly.instantiateStreaming(f,o)}catch(h){N(`wasm streaming compile failed: ${h}`),N("falling back to ArrayBuffer instantiation")}return(async function(h,m){try{var b=await(async function(T){if(!j)try{var x=await v(T);return new Uint8Array(x)}catch{}if(T==nt&&j)T=new Uint8Array(j);else{if(!C)throw"both async and sync fetching of the wasm failed";T=C(T)}return T})(h);return await WebAssembly.instantiate(b,m)}catch(T){N(`failed to asynchronously prepare wasm: ${T}`),Pe(T)}})(s,o)})(t);return e(n.instance,n.module)}catch(o){return l(o),Promise.reject(o)}})(),Wa=e=>(Wa=g.ob)(e),Ga=()=>(Ga=g.pb)();i._OrtInit=(e,t)=>(i._OrtInit=g.qb)(e,t),i._OrtGetLastError=(e,t)=>(i._OrtGetLastError=g.rb)(e,t),i._OrtCreateSessionOptions=(e,t,n,o,s,f,h,m,b,T)=>(i._OrtCreateSessionOptions=g.sb)(e,t,n,o,s,f,h,m,b,T),i._OrtAppendExecutionProvider=(e,t,n,o,s)=>(i._OrtAppendExecutionProvider=g.tb)(e,t,n,o,s),i._OrtAddFreeDimensionOverride=(e,t,n)=>(i._OrtAddFreeDimensionOverride=g.ub)(e,t,n),i._OrtAddSessionConfigEntry=(e,t,n)=>(i._OrtAddSessionConfigEntry=g.vb)(e,t,n),i._OrtReleaseSessionOptions=e=>(i._OrtReleaseSessionOptions=g.wb)(e),i._OrtCreateSession=(e,t,n)=>(i._OrtCreateSession=g.xb)(e,t,n),i._OrtReleaseSession=e=>(i._OrtReleaseSession=g.yb)(e),i._OrtGetInputOutputCount=(e,t,n)=>(i._OrtGetInputOutputCount=g.zb)(e,t,n),i._OrtGetInputOutputMetadata=(e,t,n,o)=>(i._OrtGetInputOutputMetadata=g.Ab)(e,t,n,o),i._OrtFree=e=>(i._OrtFree=g.Bb)(e),i._OrtCreateTensor=(e,t,n,o,s,f)=>(i._OrtCreateTensor=g.Cb)(e,t,n,o,s,f),i._OrtGetTensorData=(e,t,n,o,s)=>(i._OrtGetTensorData=g.Db)(e,t,n,o,s),i._OrtReleaseTensor=e=>(i._OrtReleaseTensor=g.Eb)(e),i._OrtCreateRunOptions=(e,t,n,o)=>(i._OrtCreateRunOptions=g.Fb)(e,t,n,o),i._OrtAddRunConfigEntry=(e,t,n)=>(i._OrtAddRunConfigEntry=g.Gb)(e,t,n),i._OrtReleaseRunOptions=e=>(i._OrtReleaseRunOptions=g.Hb)(e),i._OrtCreateBinding=e=>(i._OrtCreateBinding=g.Ib)(e),i._OrtBindInput=(e,t,n)=>(i._OrtBindInput=g.Jb)(e,t,n),i._OrtBindOutput=(e,t,n,o)=>(i._OrtBindOutput=g.Kb)(e,t,n,o),i._OrtClearBoundOutputs=e=>(i._OrtClearBoundOutputs=g.Lb)(e),i._OrtReleaseBinding=e=>(i._OrtReleaseBinding=g.Mb)(e),i._OrtRunWithBinding=(e,t,n,o,s)=>(i._OrtRunWithBinding=g.Nb)(e,t,n,o,s),i._OrtRun=(e,t,n,o,s,f,h,m)=>(i._OrtRun=g.Ob)(e,t,n,o,s,f,h,m),i._OrtEndProfiling=e=>(i._OrtEndProfiling=g.Pb)(e);var cn=i._OrtGetWebGpuDevice=e=>(cn=i._OrtGetWebGpuDevice=g.Qb)(e),pn=()=>(pn=g.Rb)(),Oe=i._free=e=>(Oe=i._free=g.Sb)(e),yt=i._malloc=e=>(yt=i._malloc=g.Tb)(e),Fa=i._wgpuBufferRelease=e=>(Fa=i._wgpuBufferRelease=g.Ub)(e),Va=i._wgpuCreateInstance=e=>(Va=i._wgpuCreateInstance=g.Vb)(e),za=e=>(za=g.Wb)(e),Ha=e=>(Ha=g.Xb)(e),qa=e=>(qa=g.Yb)(e),Za=e=>(Za=g.Zb)(e),Xa=e=>(Xa=g._b)(e),Ya=e=>(Ya=g.$b)(e),Ja=e=>(Ja=g.bc)(e),Qa=(e,t)=>(Qa=g.lc)(e,t),Ka=(e,t)=>(Ka=g.mc)(e,t),eo=e=>(eo=g.nc)(e),hn=(e,t,n)=>(hn=g.pc)(e,t,n),yn=(e,t,n)=>(yn=g.qc)(e,t,n),mn=(e,t,n,o)=>(mn=g.rc)(e,t,n,o),Mt=(e,t,n,o)=>(Mt=g.sc)(e,t,n,o),gn=(e,t,n,o)=>(gn=g.tc)(e,t,n,o),to=(e,t,n)=>(to=g.uc)(e,t,n),wn=(e,t,n,o,s,f)=>(wn=g.wc)(e,t,n,o,s,f),ro=()=>(ro=g.xc)(),no=(e,t,n,o,s)=>(no=g.yc)(e,t,n,o,s),io=e=>(io=g.zc)(e),bn=e=>(bn=g.Ac)(e),ao=(e,t)=>(ao=g.Bc)(e,t),oo=()=>(oo=g.Cc)(),vn=(e,t)=>(vn=g.Dc)(e,t),so=(e,t)=>(so=g.Ec)(e,t),_e=e=>(_e=g.Fc)(e),rr=e=>(rr=g.Gc)(e),Ee=()=>(Ee=g.Hc)(),lo=i.dynCall_ii=(e,t)=>(lo=i.dynCall_ii=g.Ic)(e,t);i.dynCall_viiii=(e,t,n,o,s)=>(i.dynCall_viiii=g.dynCall_viiii)(e,t,n,o,s),i.dynCall_viiiii=(e,t,n,o,s,f)=>(i.dynCall_viiiii=g.dynCall_viiiii)(e,t,n,o,s,f),i.dynCall_viii=(e,t,n,o)=>(i.dynCall_viii=g.Jc)(e,t,n,o),i.dynCall_vi=(e,t)=>(i.dynCall_vi=g.dynCall_vi)(e,t),i.dynCall_viijj=(e,t,n,o,s)=>(i.dynCall_viijj=g.dynCall_viijj)(e,t,n,o,s),i.dynCall_viiiiii=(e,t,n,o,s,f,h)=>(i.dynCall_viiiiii=g.dynCall_viiiiii)(e,t,n,o,s,f,h),i.dynCall_viiiiiiii=(e,t,n,o,s,f,h,m,b)=>(i.dynCall_viiiiiiii=g.dynCall_viiiiiiii)(e,t,n,o,s,f,h,m,b),i.dynCall_i=e=>(i.dynCall_i=g.dynCall_i)(e),i.dynCall_vii=(e,t,n)=>(i.dynCall_vii=g.dynCall_vii)(e,t,n),i.dynCall_fffffff=(e,t,n,o,s,f,h)=>(i.dynCall_fffffff=g.dynCall_fffffff)(e,t,n,o,s,f,h),i.dynCall_iiiii=(e,t,n,o,s)=>(i.dynCall_iiiii=g.dynCall_iiiii)(e,t,n,o,s),i.dynCall_iii=(e,t,n)=>(i.dynCall_iii=g.dynCall_iii)(e,t,n),i.dynCall_iiiiii=(e,t,n,o,s,f)=>(i.dynCall_iiiiii=g.dynCall_iiiiii)(e,t,n,o,s,f),i.dynCall_iiiiiiii=(e,t,n,o,s,f,h,m)=>(i.dynCall_iiiiiiii=g.dynCall_iiiiiiii)(e,t,n,o,s,f,h,m),i.dynCall_iiiiiii=(e,t,n,o,s,f,h)=>(i.dynCall_iiiiiii=g.dynCall_iiiiiii)(e,t,n,o,s,f,h),i.dynCall_iiii=(e,t,n,o)=>(i.dynCall_iiii=g.dynCall_iiii)(e,t,n,o),i.dynCall_vfiii=(e,t,n,o,s)=>(i.dynCall_vfiii=g.dynCall_vfiii)(e,t,n,o,s),i.dynCall_viiiiff=(e,t,n,o,s,f,h)=>(i.dynCall_viiiiff=g.dynCall_viiiiff)(e,t,n,o,s,f,h),i.dynCall_viiiiiff=(e,t,n,o,s,f,h,m)=>(i.dynCall_viiiiiff=g.dynCall_viiiiiff)(e,t,n,o,s,f,h,m),i.dynCall_ffff=(e,t,n,o)=>(i.dynCall_ffff=g.dynCall_ffff)(e,t,n,o),i.dynCall_viiff=(e,t,n,o,s)=>(i.dynCall_viiff=g.dynCall_viiff)(e,t,n,o,s),i.dynCall_jjjjjjj=(e,t,n,o,s,f,h)=>(i.dynCall_jjjjjjj=g.dynCall_jjjjjjj)(e,t,n,o,s,f,h),i.dynCall_jjjjjj=(e,t,n,o,s,f)=>(i.dynCall_jjjjjj=g.dynCall_jjjjjj)(e,t,n,o,s,f),i.dynCall_iijjii=(e,t,n,o,s,f)=>(i.dynCall_iijjii=g.dynCall_iijjii)(e,t,n,o,s,f),i.dynCall_viiiiiiiiiiiii=(e,t,n,o,s,f,h,m,b,T,x,E,B,G)=>(i.dynCall_viiiiiiiiiiiii=g.dynCall_viiiiiiiiiiiii)(e,t,n,o,s,f,h,m,b,T,x,E,B,G),i.dynCall_viiiiiiiiii=(e,t,n,o,s,f,h,m,b,T,x)=>(i.dynCall_viiiiiiiiii=g.dynCall_viiiiiiiiii)(e,t,n,o,s,f,h,m,b,T,x),i.dynCall_viiiiiiiiiii=(e,t,n,o,s,f,h,m,b,T,x,E)=>(i.dynCall_viiiiiiiiiii=g.dynCall_viiiiiiiiiii)(e,t,n,o,s,f,h,m,b,T,x,E),i.dynCall_viiiiiiiiiiii=(e,t,n,o,s,f,h,m,b,T,x,E,B)=>(i.dynCall_viiiiiiiiiiii=g.dynCall_viiiiiiiiiiii)(e,t,n,o,s,f,h,m,b,T,x,E,B),i.dynCall_viiiiiiiiiiiiiiiiii=(e,t,n,o,s,f,h,m,b,T,x,E,B,G,z,de,Se,at,Bt)=>(i.dynCall_viiiiiiiiiiiiiiiiii=g.dynCall_viiiiiiiiiiiiiiiiii)(e,t,n,o,s,f,h,m,b,T,x,E,B,G,z,de,Se,at,Bt),i.dynCall_viiiiiiiii=(e,t,n,o,s,f,h,m,b,T)=>(i.dynCall_viiiiiiiii=g.dynCall_viiiiiiiii)(e,t,n,o,s,f,h,m,b,T),i.dynCall_viiiiiiiiiiiiiiiiiii=(e,t,n,o,s,f,h,m,b,T,x,E,B,G,z,de,Se,at,Bt,Cn)=>(i.dynCall_viiiiiiiiiiiiiiiiiii=g.dynCall_viiiiiiiiiiiiiiiiiii)(e,t,n,o,s,f,h,m,b,T,x,E,B,G,z,de,Se,at,Bt,Cn),i.dynCall_viiiiiii=(e,t,n,o,s,f,h,m)=>(i.dynCall_viiiiiii=g.dynCall_viiiiiii)(e,t,n,o,s,f,h,m),i.dynCall_viiiiiiiiiiiiiii=(e,t,n,o,s,f,h,m,b,T,x,E,B,G,z,de)=>(i.dynCall_viiiiiiiiiiiiiii=g.dynCall_viiiiiiiiiiiiiii)(e,t,n,o,s,f,h,m,b,T,x,E,B,G,z,de),i.dynCall_jiji=(e,t,n,o)=>(i.dynCall_jiji=g.dynCall_jiji)(e,t,n,o),i.dynCall_v=e=>(i.dynCall_v=g.dynCall_v)(e),i.dynCall_iidiiii=(e,t,n,o,s,f,h)=>(i.dynCall_iidiiii=g.dynCall_iidiiii)(e,t,n,o,s,f,h),i.dynCall_ji=(e,t)=>(i.dynCall_ji=g.dynCall_ji)(e,t),i.dynCall_vij=(e,t,n)=>(i.dynCall_vij=g.dynCall_vij)(e,t,n),i.dynCall_viiijii=(e,t,n,o,s,f,h)=>(i.dynCall_viiijii=g.dynCall_viiijii)(e,t,n,o,s,f,h),i.dynCall_viijiiiiiiiiiiiiii=(e,t,n,o,s,f,h,m,b,T,x,E,B,G,z,de,Se,at)=>(i.dynCall_viijiiiiiiiiiiiiii=g.dynCall_viijiiiiiiiiiiiiii)(e,t,n,o,s,f,h,m,b,T,x,E,B,G,z,de,Se,at),i.dynCall_viiiji=(e,t,n,o,s,f)=>(i.dynCall_viiiji=g.dynCall_viiiji)(e,t,n,o,s,f),i.dynCall_jfi=(e,t,n)=>(i.dynCall_jfi=g.dynCall_jfi)(e,t,n),i.dynCall_fif=(e,t,n)=>(i.dynCall_fif=g.dynCall_fif)(e,t,n),i.dynCall_jii=(e,t,n)=>(i.dynCall_jii=g.dynCall_jii)(e,t,n),i.dynCall_viiiijii=(e,t,n,o,s,f,h,m)=>(i.dynCall_viiiijii=g.dynCall_viiiijii)(e,t,n,o,s,f,h,m),i.dynCall_iij=(e,t,n)=>(i.dynCall_iij=g.dynCall_iij)(e,t,n),i.dynCall_viji=(e,t,n,o)=>(i.dynCall_viji=g.dynCall_viji)(e,t,n,o),i.dynCall_iiiiiiiii=(e,t,n,o,s,f,h,m,b)=>(i.dynCall_iiiiiiiii=g.dynCall_iiiiiiiii)(e,t,n,o,s,f,h,m,b),i.dynCall_iiij=(e,t,n,o)=>(i.dynCall_iiij=g.dynCall_iiij)(e,t,n,o),i.dynCall_iiiiiiiiii=(e,t,n,o,s,f,h,m,b,T)=>(i.dynCall_iiiiiiiiii=g.dynCall_iiiiiiiiii)(e,t,n,o,s,f,h,m,b,T),i.dynCall_iiiiiiiiiiiii=(e,t,n,o,s,f,h,m,b,T,x,E,B)=>(i.dynCall_iiiiiiiiiiiii=g.dynCall_iiiiiiiiiiiii)(e,t,n,o,s,f,h,m,b,T,x,E,B),i.dynCall_iiiiiiiiiii=(e,t,n,o,s,f,h,m,b,T,x)=>(i.dynCall_iiiiiiiiiii=g.dynCall_iiiiiiiiiii)(e,t,n,o,s,f,h,m,b,T,x),i.dynCall_iijii=(e,t,n,o,s)=>(i.dynCall_iijii=g.dynCall_iijii)(e,t,n,o,s),i.dynCall_fiii=(e,t,n,o)=>(i.dynCall_fiii=g.dynCall_fiii)(e,t,n,o),i.dynCall_viijii=(e,t,n,o,s,f)=>(i.dynCall_viijii=g.dynCall_viijii)(e,t,n,o,s,f),i.dynCall_viij=(e,t,n,o)=>(i.dynCall_viij=g.dynCall_viij)(e,t,n,o),i.dynCall_jiij=(e,t,n,o)=>(i.dynCall_jiij=g.dynCall_jiij)(e,t,n,o),i.dynCall_fi=(e,t)=>(i.dynCall_fi=g.dynCall_fi)(e,t),i.dynCall_fii=(e,t,n)=>(i.dynCall_fii=g.dynCall_fii)(e,t,n),i.dynCall_dii=(e,t,n)=>(i.dynCall_dii=g.dynCall_dii)(e,t,n),i.dynCall_fiiii=(e,t,n,o,s)=>(i.dynCall_fiiii=g.dynCall_fiiii)(e,t,n,o,s),i.dynCall_viiiiiiiiiiiiii=(e,t,n,o,s,f,h,m,b,T,x,E,B,G,z)=>(i.dynCall_viiiiiiiiiiiiii=g.dynCall_viiiiiiiiiiiiii)(e,t,n,o,s,f,h,m,b,T,x,E,B,G,z),i.dynCall_viiiiiiiiiiiiiiiiiiii=(e,t,n,o,s,f,h,m,b,T,x,E,B,G,z,de,Se,at,Bt,Cn,su)=>(i.dynCall_viiiiiiiiiiiiiiiiiiii=g.dynCall_viiiiiiiiiiiiiiiiiiii)(e,t,n,o,s,f,h,m,b,T,x,E,B,G,z,de,Se,at,Bt,Cn,su),i.dynCall_viiiiiiiiiiiiiiii=(e,t,n,o,s,f,h,m,b,T,x,E,B,G,z,de,Se)=>(i.dynCall_viiiiiiiiiiiiiiii=g.dynCall_viiiiiiiiiiiiiiii)(e,t,n,o,s,f,h,m,b,T,x,E,B,G,z,de,Se),i.dynCall_iif=(e,t,n)=>(i.dynCall_iif=g.dynCall_iif)(e,t,n),i.dynCall_jiiii=(e,t,n,o,s)=>(i.dynCall_jiiii=g.dynCall_jiiii)(e,t,n,o,s),i.dynCall_jiii=(e,t,n,o)=>(i.dynCall_jiii=g.dynCall_jiii)(e,t,n,o),i.dynCall_viif=(e,t,n,o)=>(i.dynCall_viif=g.dynCall_viif)(e,t,n,o),i.dynCall_viiij=(e,t,n,o,s)=>(i.dynCall_viiij=g.dynCall_viiij)(e,t,n,o,s),i.dynCall_iiiiij=(e,t,n,o,s,f)=>(i.dynCall_iiiiij=g.dynCall_iiiiij)(e,t,n,o,s,f),i.dynCall_iiiiid=(e,t,n,o,s,f)=>(i.dynCall_iiiiid=g.dynCall_iiiiid)(e,t,n,o,s,f),i.dynCall_iiiiijj=(e,t,n,o,s,f,h)=>(i.dynCall_iiiiijj=g.dynCall_iiiiijj)(e,t,n,o,s,f,h),i.dynCall_iiiiiijj=(e,t,n,o,s,f,h,m)=>(i.dynCall_iiiiiijj=g.dynCall_iiiiiijj)(e,t,n,o,s,f,h,m);var uo=e=>(uo=g.Kc)(e),fo=()=>(fo=g.Lc)(),co=e=>(co=g.Mc)(e),po=()=>(po=g.Nc)();return(function e(){if(0<Re)At=e;else if(d)a(i),Ce();else{for(;0<qr.length;)qr.shift()(i);0<Re?At=e:(i.calledRun=!0,oe||(Ce(),a(i)))}})(),i.PTR_SIZE=4,i.webgpuInit=e=>{let t=new WeakMap,n,o,s=1;i.webgpuRegisterDevice=m=>{if(o!==void 0)throw Error("another WebGPU EP inference session is being created.");if(m){var b=t.get(m);if(!b){let T=((x,E=0)=>{var B=eo(E);return E=Ka(E,B),fe(B,x.queue),fe(E,x),E})(m,b=Va(0));b=[s++,b,T],t.set(m,b)}return n=m,o=b[0],b}n=void 0,o=0};let f=new Map;i.webgpuOnCreateSession=m=>{if(o!==void 0){var b=o;if(o=void 0,m){let T=cn(b);f.set(m,T),b===0&&e(n??I(T))}n=void 0}},i.webgpuOnReleaseSession=m=>{f.delete(m)};let h=Symbol("gpuBufferMetadata");i.webgpuRegisterBuffer=(m,b,T)=>{if(T)return m[h]=[T,NaN],T;if(T=m[h])return T[1]++,T[0];if((b=f.get(b))===void 0)throw Error("Invalid session handle passed to webgpuRegisterBuffer");return b=((x,E=0)=>(x.mapState!="pending"||Pe(),E=Qa(E,x.mapState=="mapped"?3:1),fe(E,x),x.mapState=="mapped"&&(Be[E]=[]),E))(m,b),m[h]=[b,1],b},i.webgpuUnregisterBuffer=m=>{let b=m[h];if(!b)throw Error("Buffer is not registered");b[1]--,b[1]===0&&(Fa(b[0]),delete m[h])},i.webgpuGetBuffer=m=>I(m),i.webgpuCreateDownloader=(m,b,T)=>{if((T=f.get(T))===void 0)throw Error("Invalid session handle passed to webgpuRegisterBuffer");let x=I(T),E=16*Math.ceil(Number(b)/16);return async()=>{let B=x.createBuffer({size:E,usage:9});try{let G=x.createCommandEncoder();return G.copyBufferToBuffer(m,0,B,0,E),x.queue.submit([G.finish()]),await B.mapAsync(GPUMapMode.READ),B.getMappedRange().slice(0,b)}finally{B.destroy()}}},i.Pc=(m,b)=>{var T=b.buffer;let x=b.byteOffset,E=b.byteLength;if(b=16*Math.ceil(Number(E)/16),m=I(m),!n){var B=cn(o);n=I(B)}let G=(B=n.createBuffer({mappedAtCreation:!0,size:b,usage:6})).getMappedRange();new Uint8Array(G).set(new Uint8Array(T,x,E)),B.unmap(),(T=n.createCommandEncoder()).copyBufferToBuffer(B,0,m,0,b),n.queue.submit([T.finish()]),B.destroy()}},i.webnnInit=e=>{let t=e[0];[i.ed,i.Qc,i.webnnEnsureTensor,i.Rc,i.webnnDownloadTensor,i.dd,i.webnnEnableTraceEvent]=e.slice(1),i.webnnReleaseTensorId=i.Qc,i.webnnUploadTensor=i.Rc,i.webnnRegisterMLContext=i.dd,i.webnnOnRunStart=n=>t.onRunStart(n),i.webnnOnRunEnd=t.onRunEnd.bind(t),i.webnnOnReleaseSession=n=>{t.onReleaseSession(n)},i.webnnCreateMLTensorDownloader=(n,o)=>t.createMLTensorDownloader(n,o),i.webnnRegisterMLTensor=(n,o,s,f)=>t.registerMLTensor(n,o,s,f),i.webnnCreateMLContext=n=>t.createMLContext(n),i.webnnRegisterMLConstant=(n,o,s,f,h,m)=>t.registerMLConstant(n,o,s,f,h,i.fc,m),i.webnnRegisterGraphInput=t.registerGraphInput.bind(t),i.webnnIsGraphInput=t.isGraphInput.bind(t),i.webnnRegisterGraphOutput=t.registerGraphOutput.bind(t),i.webnnIsGraphOutput=t.isGraphOutput.bind(t),i.webnnCreateTemporaryTensor=t.createTemporaryTensor.bind(t),i.webnnIsGraphInputOutputTypeSupported=t.isGraphInputOutputTypeSupported.bind(t)},u},Vn=dr,zn=globalThis.self?.name?.startsWith("em-pthread"),zn&&dr()}),cr,pr,Hn,pe,qn,jt,Zn,Xn,hr,Yn,yr,Jn,mr,Qn,gr=k(()=>{lr(),cr=typeof location>"u"?void 0:location.origin,pr=self.location.href>"file:"&&self.location.href<"file;",Hn=()=>{{if(pr){let r=URL;return new URL(new r("ort.webgpu.bundle.min.mjs",self.location.href).href,cr).href}return self.location.href}},pe=Hn(),qn=()=>{if(pe&&!pe.startsWith("blob:"))return pe.substring(0,pe.lastIndexOf("/")+1)},jt=(r,a)=>{try{let l=a??pe;return(l?new URL(r,l):new URL(r)).origin===cr}catch{return!1}},Zn=(r,a)=>{let l=a??pe;try{return(l?new URL(r,l):new URL(r)).href}catch{return}},Xn=(r,a)=>`${a??"./"}${r}`,hr=async r=>{let a=await(await fetch(r,{credentials:"same-origin"})).blob();return URL.createObjectURL(a)},Yn=async r=>(await import(r)).default,yr=(Po(),Rt(Wn)).default,Jn=async()=>{if(!pe)throw new Error("Failed to load proxy worker: cannot determine the script source URL.");if(jt(pe))return[void 0,yr()];let r=await hr(pe);return[r,yr(r)]},mr=(Uo(),Rt(Fn)).default,Qn=async(r,a,l,i)=>{let u=mr&&!(r||a);if(u)if(pe)u=jt(pe);else if(i&&!l)u=!0;else throw new Error("cannot determine the script source URL.");if(u)return[void 0,mr];{let p="ort-wasm-simd-threaded.asyncify.mjs",c=r??Zn(p,a),d=l&&c&&!jt(c,a),y=d?await hr(c):c??Xn(p,a);return[d?y:void 0,await Yn(y)]}}}),wr,$t,bt,br,Kn,ei,ti,vr,H,Ke=k(()=>{gr(),$t=!1,bt=!1,br=!1,Kn=()=>{if(typeof SharedArrayBuffer>"u")return!1;try{return typeof MessageChannel<"u"&&new MessageChannel().port1.postMessage(new SharedArrayBuffer(1)),WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,5,4,1,3,1,1,10,11,1,9,0,65,0,254,16,2,0,26,11]))}catch{return!1}},ei=()=>{try{return WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,30,1,28,0,65,0,253,15,253,12,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,253,186,1,26,11]))}catch{return!1}},ti=()=>{try{return WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,19,1,17,0,65,1,253,15,65,2,253,15,65,3,253,15,253,147,2,11]))}catch{return!1}},vr=async r=>{if($t)return Promise.resolve();if(bt)throw new Error("multiple calls to 'initializeWebAssembly()' detected.");if(br)throw new Error("previous call to 'initializeWebAssembly()' failed.");bt=!0;let a=r.initTimeout,l=r.numThreads;if(r.simd!==!1){if(r.simd==="relaxed"){if(!ti())throw new Error("Relaxed WebAssembly SIMD is not supported in the current environment.")}else if(!ei())throw new Error("WebAssembly SIMD is not supported in the current environment.")}let i=Kn();l>1&&!i&&(typeof self<"u"&&!self.crossOriginIsolated&&console.warn("env.wasm.numThreads is set to "+l+", but this will not work unless you enable crossOriginIsolated mode. See https://web.dev/cross-origin-isolation-guide/ for more info."),console.warn("WebAssembly multi-threading is not supported in the current environment. Falling back to single-threading."),r.numThreads=l=1);let u=r.wasmPaths,p=typeof u=="string"?u:void 0,c=u?.mjs,d=c?.href??c,y=u?.wasm,w=y?.href??y,v=r.wasmBinary,[C,_]=await Qn(d,p,l>1,!!v||!!w),O=!1,R=[];if(a>0&&R.push(new Promise(j=>{setTimeout(()=>{O=!0,j()},a)})),R.push(new Promise((j,L)=>{let P={numThreads:l};if(v)P.wasmBinary=v;else if(w||p)P.locateFile=M=>w??p+M;else if(d&&d.indexOf("blob:")!==0)P.locateFile=M=>new URL(M,d).href;else if(C){let M=qn();M&&(P.locateFile=D=>M+D)}_(P).then(M=>{bt=!1,$t=!0,wr=M,j(),C&&URL.revokeObjectURL(C)},M=>{bt=!1,br=!0,L(M)})})),await Promise.race(R),O)throw new Error(`WebAssembly backend initializing failed due to timeout: ${a}ms`)},H=()=>{if($t&&wr)return wr;throw new Error("WebAssembly is not initialized yet.")}}),he,kt,V,Cr=k(()=>{Ke(),he=(r,a)=>{let l=H(),i=l.lengthBytesUTF8(r)+1,u=l._malloc(i);return l.stringToUTF8(r,u,i),a.push(u),u},kt=(r,a,l,i)=>{if(typeof r=="object"&&r!==null){if(l.has(r))throw new Error("Circular reference in options");l.add(r)}Object.entries(r).forEach(([u,p])=>{let c=a?a+u:u;if(typeof p=="object")kt(p,c+".",l,i);else if(typeof p=="string"||typeof p=="number")i(c,p.toString());else if(typeof p=="boolean")i(c,p?"1":"0");else throw new Error(`Can't handle extra config type: ${typeof p}`)})},V=r=>{let a=H(),l=a.stackSave();try{let i=a.PTR_SIZE,u=a.stackAlloc(2*i);a._OrtGetLastError(u,u+i);let p=Number(a.getValue(u,i===4?"i32":"i64")),c=a.getValue(u+i,"*"),d=c?a.UTF8ToString(c):"";throw new Error(`${r} ERROR_CODE: ${p}, ERROR_MESSAGE: ${d}`)}finally{a.stackRestore(l)}}}),ri,Lo=k(()=>{Ke(),Cr(),ri=r=>{let a=H(),l=0,i=[],u=r||{};try{if(r?.logSeverityLevel===void 0)u.logSeverityLevel=2;else if(typeof r.logSeverityLevel!="number"||!Number.isInteger(r.logSeverityLevel)||r.logSeverityLevel<0||r.logSeverityLevel>4)throw new Error(`log severity level is not valid: ${r.logSeverityLevel}`);if(r?.logVerbosityLevel===void 0)u.logVerbosityLevel=0;else if(typeof r.logVerbosityLevel!="number"||!Number.isInteger(r.logVerbosityLevel))throw new Error(`log verbosity level is not valid: ${r.logVerbosityLevel}`);r?.terminate===void 0&&(u.terminate=!1);let p=0;return r?.tag!==void 0&&(p=he(r.tag,i)),l=a._OrtCreateRunOptions(u.logSeverityLevel,u.logVerbosityLevel,!!u.terminate,p),l===0&&V("Can't create run options."),r?.extra!==void 0&&kt(r.extra,"",new WeakSet,(c,d)=>{let y=he(c,i),w=he(d,i);a._OrtAddRunConfigEntry(l,y,w)!==0&&V(`Can't set a run config entry: ${c} - ${d}.`)}),[l,i]}catch(p){throw l!==0&&a._OrtReleaseRunOptions(l),i.forEach(c=>a._free(c)),p}}}),ni,ii,ai,Nt,Dt,oi,si,jo=k(()=>{Ke(),Cr(),ni=r=>{switch(r){case"disabled":return 0;case"basic":return 1;case"extended":return 2;case"layout":return 3;case"all":return 99;default:throw new Error(`unsupported graph optimization level: ${r}`)}},ii=r=>{switch(r){case"sequential":return 0;case"parallel":return 1;default:throw new Error(`unsupported execution mode: ${r}`)}},ai=r=>{r.extra||(r.extra={}),r.extra.session||(r.extra.session={});let a=r.extra.session;a.use_ort_model_bytes_directly||(a.use_ort_model_bytes_directly="1"),r.executionProviders&&r.executionProviders.some(l=>(typeof l=="string"?l:l.name)==="webgpu")&&(r.enableMemPattern=!1)},Nt=(r,a,l,i)=>{let u=he(a,i),p=he(l,i);H()._OrtAddSessionConfigEntry(r,u,p)!==0&&V(`Can't set a session config entry: ${a} - ${l}.`)},Dt=(r,a,l,i)=>{let u=he(a,i),p=he(l,i);r.push([u,p])},oi=async(r,a,l)=>{for(let i of a){let u=typeof i=="string"?i:i.name,p=[];switch(u){case"webnn":if(u="WEBNN",typeof i!="string"){let v=i?.deviceType;v&&Nt(r,"deviceType",v,l)}break;case"webgpu":{u="WebGPU";let v;if(typeof i!="string"){let _=i;if(_.device)if(typeof GPUDevice<"u"&&_.device instanceof GPUDevice)v=_.device;else throw new Error("Invalid GPU device set in WebGPU EP options.")}let C=H().webgpuRegisterDevice(v);if(C){let[_,O,R]=C;Dt(p,"deviceId",_.toString(),l),Dt(p,"webgpuInstance",O.toString(),l),Dt(p,"webgpuDevice",R.toString(),l)}}break;case"wasm":case"cpu":continue;default:throw new Error(`not supported execution provider: ${u}`)}let c=he(u,l),d=p.length,y=0,w=0;if(d>0){y=H()._malloc(d*H().PTR_SIZE),l.push(y),w=H()._malloc(d*H().PTR_SIZE),l.push(w);for(let v=0;v<d;v++)H().setValue(y+v*H().PTR_SIZE,p[v][0],"*"),H().setValue(w+v*H().PTR_SIZE,p[v][1],"*")}await H()._OrtAppendExecutionProvider(r,c,y,w,d)!==0&&V(`Can't append execution provider: ${u}.`)}},si=async r=>{let a=H(),l=0,i=[],u=r||{};ai(u);try{let p=ni(u.graphOptimizationLevel??"all"),c=ii(u.executionMode??"sequential"),d=typeof u.logId=="string"?he(u.logId,i):0,y=u.logSeverityLevel??2;if(!Number.isInteger(y)||y<0||y>4)throw new Error(`log severity level is not valid: ${y}`);let w=u.logVerbosityLevel??0;if(!Number.isInteger(w)||w<0||w>4)throw new Error(`log verbosity level is not valid: ${w}`);let v=typeof u.optimizedModelFilePath=="string"?he(u.optimizedModelFilePath,i):0;if(l=a._OrtCreateSessionOptions(p,!!u.enableCpuMemArena,!!u.enableMemPattern,c,!!u.enableProfiling,0,d,y,w,v),l===0&&V("Can't create session options."),u.executionProviders&&await oi(l,u.executionProviders,i),u.enableGraphCapture!==void 0){if(typeof u.enableGraphCapture!="boolean")throw new Error(`enableGraphCapture must be a boolean value: ${u.enableGraphCapture}`);Nt(l,"enableGraphCapture",u.enableGraphCapture.toString(),i)}if(u.freeDimensionOverrides)for(let[C,_]of Object.entries(u.freeDimensionOverrides)){if(typeof C!="string")throw new Error(`free dimension override name must be a string: ${C}`);if(typeof _!="number"||!Number.isInteger(_)||_<0)throw new Error(`free dimension override value must be a non-negative integer: ${_}`);let O=he(C,i);a._OrtAddFreeDimensionOverride(l,O,_)!==0&&V(`Can't set a free dimension override: ${C} - ${_}.`)}return u.extra!==void 0&&kt(u.extra,"",new WeakSet,(C,_)=>{Nt(l,C,_,i)}),[l,i]}catch(p){throw l!==0&&a._OrtReleaseSessionOptions(l)!==0&&V("Can't release session options."),i.forEach(c=>a._free(c)),p}}}),et,Wt,ot,vt,Gt,Tr,_r,Er,st=k(()=>{et=r=>{switch(r){case"int8":return 3;case"uint8":return 2;case"bool":return 9;case"int16":return 5;case"uint16":return 4;case"int32":return 6;case"uint32":return 12;case"float16":return 10;case"float32":return 1;case"float64":return 11;case"string":return 8;case"int64":return 7;case"uint64":return 13;case"int4":return 22;case"uint4":return 21;default:throw new Error(`unsupported data type: ${r}`)}},Wt=r=>{switch(r){case 3:return"int8";case 2:return"uint8";case 9:return"bool";case 5:return"int16";case 4:return"uint16";case 6:return"int32";case 12:return"uint32";case 10:return"float16";case 1:return"float32";case 11:return"float64";case 8:return"string";case 7:return"int64";case 13:return"uint64";case 22:return"int4";case 21:return"uint4";default:throw new Error(`unsupported data type: ${r}`)}},ot=(r,a)=>{let l=[-1,4,1,1,2,2,4,8,-1,1,2,8,4,8,-1,-1,-1,-1,-1,-1,-1,.5,.5][r],i=typeof a=="number"?a:a.reduce((u,p)=>u*p,1);return l>0?Math.ceil(i*l):void 0},vt=r=>{switch(r){case"float16":return typeof Float16Array<"u"&&Float16Array.from?Float16Array:Uint16Array;case"float32":return Float32Array;case"uint8":return Uint8Array;case"int8":return Int8Array;case"uint16":return Uint16Array;case"int16":return Int16Array;case"int32":return Int32Array;case"bool":return Uint8Array;case"float64":return Float64Array;case"uint32":return Uint32Array;case"int64":return BigInt64Array;case"uint64":return BigUint64Array;default:throw new Error(`unsupported type: ${r}`)}},Gt=r=>{switch(r){case"verbose":return 0;case"info":return 1;case"warning":return 2;case"error":return 3;case"fatal":return 4;default:throw new Error(`unsupported logging level: ${r}`)}},Tr=r=>r==="float32"||r==="float16"||r==="int32"||r==="int64"||r==="uint32"||r==="uint8"||r==="bool"||r==="uint4"||r==="int4",_r=r=>r==="float32"||r==="float16"||r==="int32"||r==="int64"||r==="uint32"||r==="uint64"||r==="int8"||r==="uint8"||r==="bool"||r==="uint4"||r==="int4",Er=r=>{switch(r){case"none":return 0;case"cpu":return 1;case"cpu-pinned":return 2;case"texture":return 3;case"gpu-buffer":return 4;case"ml-tensor":return 5;default:throw new Error(`unsupported data location: ${r}`)}}}),Ar,li=k(()=>{lr(),Ar=async r=>{if(typeof r=="string"){let a=await fetch(r);if(!a.ok)throw new Error(`failed to load external data file: ${r}`);let l=a.headers.get("Content-Length"),i=l?parseInt(l,10):0;if(i<1073741824)return new Uint8Array(await a.arrayBuffer());{if(!a.body)throw new Error(`failed to load external data file: ${r}, no response body.`);let u=a.body.getReader(),p;try{p=new ArrayBuffer(i)}catch(d){if(d instanceof RangeError){let y=Math.ceil(i/65536);p=new WebAssembly.Memory({initial:y,maximum:y}).buffer}else throw d}let c=0;for(;;){let{done:d,value:y}=await u.read();if(d)break;let w=y.byteLength;new Uint8Array(p,c,w).set(y),c+=w}return new Uint8Array(p,0,i)}}else return r instanceof Blob?new Uint8Array(await r.arrayBuffer()):r instanceof Uint8Array?r:new Uint8Array(r)}}),ui,$o=k(()=>{st(),ui=(r,a)=>new(vt(a))(r)}),fi,di,ci,pi,hi,yi,le,mi=k(()=>{st(),fi=["V","I","W","E","F"],di=(r,a)=>{console.log(`[${fi[r]},${new Date().toISOString()}]${a}`)},hi=(r,a)=>{ci=r,pi=a},yi=(r,a)=>{let l=Gt(r),i=Gt(ci);l>=i&&di(l,typeof a=="function"?a():a)},le=(...r)=>{pi&&yi(...r)}}),xr,Or,Sr,gi,Ir,wi,Mr,Br,Rr,bi,vi,ko=k(()=>{st(),mi(),xr=new Map([["float32",32],["float16",16],["int32",32],["uint32",32],["int64",64],["uint64",64],["int8",8],["uint8",8],["int4",4],["uint4",4]]),Or=(r,a)=>{if(a==="int32")return r;let l=xr.get(a);if(!l)throw new Error(`WebNN backend does not support data type: ${a}`);let i=l/8;if(r.byteLength%i!==0)throw new Error(`Invalid Uint8Array length - must be a multiple of ${i}.`);let u=r.byteLength/i,p=new(vt(a))(r.buffer,r.byteOffset,u);switch(a){case"int64":case"uint64":{let c=new Int32Array(u);for(let d=0;d<u;d++){let y=p[d];if(y>2147483647n||y<-2147483648n)throw new Error("Can not convert int64 data to int32 - value out of range.");c[d]=Number(y)}return new Uint8Array(c.buffer)}case"int8":case"uint8":case"uint32":{if(a==="uint32"&&p.some(d=>d>2147483647))throw new Error("Can not convert uint32 data to int32 - value out of range.");let c=Int32Array.from(p,Number);return new Uint8Array(c.buffer)}default:throw new Error(`Unsupported data conversion from ${a} to 'int32'`)}},Sr=(r,a)=>{if(a==="int32")return r;if(r.byteLength%4!==0)throw new Error("Invalid Uint8Array length - must be a multiple of 4 (int32).");let l=r.byteLength/4,i=new Int32Array(r.buffer,r.byteOffset,l);switch(a){case"int64":{let u=BigInt64Array.from(i,BigInt);return new Uint8Array(u.buffer)}case"uint64":{if(i.some(p=>p<0))throw new Error("Can not convert int32 data to uin64 - negative value found.");let u=BigUint64Array.from(i,BigInt);return new Uint8Array(u.buffer)}case"int8":{if(i.some(p=>p<-128||p>127))throw new Error("Can not convert int32 data to int8 - value out of range.");let u=Int8Array.from(i,Number);return new Uint8Array(u.buffer)}case"uint8":{if(i.some(u=>u<0||u>255))throw new Error("Can not convert int32 data to uint8 - value out of range.");return Uint8Array.from(i,Number)}case"uint32":{if(i.some(p=>p<0))throw new Error("Can not convert int32 data to uint32 - negative value found.");let u=Uint32Array.from(i,Number);return new Uint8Array(u.buffer)}default:throw new Error(`Unsupported data conversion from 'int32' to ${a}`)}},gi=1,Ir=()=>gi++,wi=new Map([["int8","int32"],["uint8","int32"],["uint32","int32"],["int64","int32"]]),Mr=(r,a)=>{let l=xr.get(r);if(!l)throw new Error(`WebNN backend does not support data type: ${r}`);return a.length>0?Math.ceil(a.reduce((i,u)=>i*u)*l/8):0},Br=class{constructor(r){this.isDataConverted=!1;let{sessionId:a,context:l,tensor:i,dataType:u,shape:p,fallbackDataType:c}=r;this.sessionId=a,this.mlContext=l,this.mlTensor=i,this.dataType=u,this.tensorShape=p,this.fallbackDataType=c}get tensor(){return this.mlTensor}get type(){return this.dataType}get fallbackType(){return this.fallbackDataType}get shape(){return this.tensorShape}get byteLength(){return Mr(this.dataType,this.tensorShape)}destroy(){le("verbose",()=>"[WebNN] TensorWrapper.destroy"),this.mlTensor.destroy()}write(r){this.mlContext.writeTensor(this.mlTensor,r)}async read(r){if(this.fallbackDataType){let a=await this.mlContext.readTensor(this.mlTensor),l=Sr(new Uint8Array(a),this.dataType);if(r){(r instanceof ArrayBuffer?new Uint8Array(r):new Uint8Array(r.buffer,r.byteOffset,r.byteLength)).set(l);return}else return l.buffer}else return r?this.mlContext.readTensor(this.mlTensor,r):this.mlContext.readTensor(this.mlTensor)}canReuseTensor(r,a,l){return this.mlContext===r&&this.dataType===a&&this.tensorShape.length===l.length&&this.tensorShape.every((i,u)=>i===l[u])}setIsDataConverted(r){this.isDataConverted=r}},Rr=class{constructor(r,a){this.tensorManager=r,this.wrapper=a}get tensorWrapper(){return this.wrapper}releaseTensor(){this.tensorWrapper&&(this.tensorManager.releaseTensor(this.tensorWrapper),this.wrapper=void 0)}async ensureTensor(r,a,l,i){let u=this.tensorManager.getMLContext(r),p;if(!u.opSupportLimits().input.dataTypes.includes(a)){if(p=wi.get(a),!p||!u.opSupportLimits().input.dataTypes.includes(p))throw new Error(`WebNN backend does not support data type: ${a}`);le("verbose",()=>`[WebNN] TensorIdTracker.ensureTensor: fallback dataType from ${a} to ${p}`)}if(this.wrapper){if(this.wrapper.canReuseTensor(u,a,l))return this.wrapper.tensor;if(i){if(this.wrapper.byteLength!==Mr(a,l))throw new Error("Unable to copy data to tensor with different size.");this.activeUpload=new Uint8Array(await this.wrapper.read())}this.tensorManager.releaseTensor(this.wrapper)}let c=typeof MLTensorUsage>"u"?void 0:MLTensorUsage.READ|MLTensorUsage.WRITE;return this.wrapper=await this.tensorManager.getCachedTensor(r,a,l,c,!0,!0,p),i&&this.activeUpload&&(this.wrapper.write(this.activeUpload),this.activeUpload=void 0),this.wrapper.tensor}upload(r){let a=r;if(this.wrapper){if(this.wrapper.fallbackType)if(this.wrapper.fallbackType==="int32")a=Or(r,this.wrapper.type),this.wrapper.setIsDataConverted(!0);else throw new Error(`Unsupported fallback data type: ${this.wrapper.fallbackType}`);if(r.byteLength===this.wrapper.byteLength){this.wrapper.write(a);return}else le("verbose",()=>"Data size does not match tensor size. Releasing tensor."),this.releaseTensor()}this.activeUpload?this.activeUpload.set(a):this.activeUpload=new Uint8Array(a)}async download(r){if(this.activeUpload){let a=this.wrapper?.isDataConverted?Sr(this.activeUpload,this.wrapper?.type):this.activeUpload;if(r){r instanceof ArrayBuffer?new Uint8Array(r).set(a):new Uint8Array(r.buffer,r.byteOffset,r.byteLength).set(a);return}else return a.buffer}if(!this.wrapper)throw new Error("Tensor has not been created.");return r?this.wrapper.read(r):this.wrapper.read()}},bi=class{constructor(r){this.backend=r,this.tensorTrackersById=new Map,this.freeTensors=[],this.externalTensors=new Set}getMLContext(r){let a=this.backend.getMLContext(r);if(!a)throw new Error("MLContext not found for session.");return a}reserveTensorId(){let r=Ir();return this.tensorTrackersById.set(r,new Rr(this)),r}releaseTensorId(r){let a=this.tensorTrackersById.get(r);a&&(this.tensorTrackersById.delete(r),a.tensorWrapper&&this.releaseTensor(a.tensorWrapper))}async ensureTensor(r,a,l,i,u){le("verbose",()=>`[WebNN] TensorManager.ensureTensor {tensorId: ${a}, dataType: ${l}, shape: ${i}, copyOld: ${u}}`);let p=this.tensorTrackersById.get(a);if(!p)throw new Error("Tensor not found.");return p.ensureTensor(r,l,i,u)}upload(r,a){let l=this.tensorTrackersById.get(r);if(!l)throw new Error("Tensor not found.");l.upload(a)}async download(r,a){le("verbose",()=>`[WebNN] TensorManager.download {tensorId: ${r}, dstBuffer: ${a?.byteLength}}`);let l=this.tensorTrackersById.get(r);if(!l)throw new Error("Tensor not found.");return l.download(a)}releaseTensorsForSession(r){for(let a of this.freeTensors)a.sessionId===r&&a.destroy();this.freeTensors=this.freeTensors.filter(a=>a.sessionId!==r)}registerTensor(r,a,l,i){let u=this.getMLContext(r),p=Ir(),c=new Br({sessionId:r,context:u,tensor:a,dataType:l,shape:i});return this.tensorTrackersById.set(p,new Rr(this,c)),this.externalTensors.add(c),p}async getCachedTensor(r,a,l,i,u,p,c){let d=this.getMLContext(r);for(let[w,v]of this.freeTensors.entries())if(v.canReuseTensor(d,a,l)){le("verbose",()=>`[WebNN] Reusing tensor {dataType: ${a}, ${c?`fallbackDataType: ${c},`:""} shape: ${l}`);let C=this.freeTensors.splice(w,1)[0];return C.sessionId=r,C}le("verbose",()=>`[WebNN] MLContext.createTensor {dataType: ${a}, ${c?`fallbackDataType: ${c},`:""} shape: ${l}}`);let y=await d.createTensor({dataType:c??a,shape:l,dimensions:l,usage:i,writable:u,readable:p});return new Br({sessionId:r,context:d,tensor:y,dataType:a,shape:l,fallbackDataType:c})}releaseTensor(r){this.externalTensors.has(r)&&this.externalTensors.delete(r),this.freeTensors.push(r)}},vi=(...r)=>new bi(...r)}),Ci={};mt(Ci,{WebNNBackend:()=>_i});var Ct,Ti,_i,No=k(()=>{st(),Ke(),$o(),ko(),mi(),Ct=new Map([[1,"float32"],[10,"float16"],[6,"int32"],[12,"uint32"],[7,"int64"],[13,"uint64"],[22,"int4"],[21,"uint4"],[3,"int8"],[2,"uint8"],[9,"uint8"]]),Ti=(r,a)=>{if(r===a)return!0;if(r===void 0||a===void 0)return!1;let l=Object.keys(r).sort(),i=Object.keys(a).sort();return l.length===i.length&&l.every((u,p)=>u===i[p]&&r[u]===a[u])},_i=class{constructor(r){this.tensorManager=vi(this),this.mlContextBySessionId=new Map,this.sessionIdsByMLContext=new Map,this.mlContextCache=[],this.sessionGraphInputs=new Map,this.sessionGraphOutputs=new Map,this.temporaryGraphInputs=[],this.temporaryGraphOutputs=[],this.temporarySessionTensorIds=new Map,hi(r.logLevel,!!r.debug)}get currentSessionId(){if(this.activeSessionId===void 0)throw new Error("No active session");return this.activeSessionId}onRunStart(r){le("verbose",()=>`[WebNN] onRunStart {sessionId: ${r}}`),this.activeSessionId=r}onRunEnd(r){le("verbose",()=>`[WebNN] onRunEnd {sessionId: ${r}}`);let a=this.temporarySessionTensorIds.get(r);if(a){for(let l of a)le("verbose",()=>`[WebNN] releasing temporary tensor {tensorId: ${l}}`),this.tensorManager.releaseTensorId(l);this.temporarySessionTensorIds.delete(r),this.activeSessionId=void 0}}async createMLContext(r){if(r instanceof GPUDevice){let l=this.mlContextCache.findIndex(i=>i.gpuDevice===r);if(l!==-1)return this.mlContextCache[l].mlContext;{let i=await navigator.ml.createContext(r);return this.mlContextCache.push({gpuDevice:r,mlContext:i}),i}}else if(r===void 0){let l=this.mlContextCache.findIndex(i=>i.options===void 0&&i.gpuDevice===void 0);if(l!==-1)return this.mlContextCache[l].mlContext;{let i=await navigator.ml.createContext();return this.mlContextCache.push({mlContext:i}),i}}let a=this.mlContextCache.findIndex(l=>Ti(l.options,r));if(a!==-1)return this.mlContextCache[a].mlContext;{let l=await navigator.ml.createContext(r);return this.mlContextCache.push({options:r,mlContext:l}),l}}registerMLContext(r,a){this.mlContextBySessionId.set(r,a);let l=this.sessionIdsByMLContext.get(a);l||(l=new Set,this.sessionIdsByMLContext.set(a,l)),l.add(r),this.temporaryGraphInputs.length>0&&(this.sessionGraphInputs.set(r,this.temporaryGraphInputs),this.temporaryGraphInputs=[]),this.temporaryGraphOutputs.length>0&&(this.sessionGraphOutputs.set(r,this.temporaryGraphOutputs),this.temporaryGraphOutputs=[])}onReleaseSession(r){this.sessionGraphInputs.delete(r),this.sessionGraphOutputs.delete(r);let a=this.mlContextBySessionId.get(r);if(!a)return;this.tensorManager.releaseTensorsForSession(r),this.mlContextBySessionId.delete(r);let l=this.sessionIdsByMLContext.get(a);if(l.delete(r),l.size===0){this.sessionIdsByMLContext.delete(a);let i=this.mlContextCache.findIndex(u=>u.mlContext===a);i!==-1&&this.mlContextCache.splice(i,1)}}getMLContext(r){return this.mlContextBySessionId.get(r)}reserveTensorId(){return this.tensorManager.reserveTensorId()}releaseTensorId(r){le("verbose",()=>`[WebNN] releaseTensorId {tensorId: ${r}}`),this.tensorManager.releaseTensorId(r)}async ensureTensor(r,a,l,i,u){let p=Ct.get(l);if(!p)throw new Error(`Unsupported ONNX data type: ${l}`);return this.tensorManager.ensureTensor(r??this.currentSessionId,a,p,i,u)}async createTemporaryTensor(r,a,l){le("verbose",()=>`[WebNN] createTemporaryTensor {onnxDataType: ${a}, shape: ${l}}`);let i=Ct.get(a);if(!i)throw new Error(`Unsupported ONNX data type: ${a}`);let u=this.tensorManager.reserveTensorId();await this.tensorManager.ensureTensor(r,u,i,l,!1);let p=this.temporarySessionTensorIds.get(r);return p?p.push(u):this.temporarySessionTensorIds.set(r,[u]),u}uploadTensor(r,a){if(!H().shouldTransferToMLTensor)throw new Error("Trying to upload to a MLTensor while shouldTransferToMLTensor is false");le("verbose",()=>`[WebNN] uploadTensor {tensorId: ${r}, data: ${a.byteLength}}`),this.tensorManager.upload(r,a)}async downloadTensor(r,a){return this.tensorManager.download(r,a)}createMLTensorDownloader(r,a){return async()=>{let l=await this.tensorManager.download(r);return ui(l,a)}}registerMLTensor(r,a,l,i){let u=Ct.get(l);if(!u)throw new Error(`Unsupported ONNX data type: ${l}`);let p=this.tensorManager.registerTensor(r,a,u,i);return le("verbose",()=>`[WebNN] registerMLTensor {tensor: ${a}, dataType: ${u}, dimensions: ${i}} -> {tensorId: ${p}}`),p}registerMLConstant(r,a,l,i,u,p,c=!1){if(!p)throw new Error("External mounted files are not available.");let d=r;r.startsWith("./")&&(d=r.substring(2));let y=p.get(d);if(!y)throw new Error(`File with name ${d} not found in preloaded files.`);if(a+l>y.byteLength)throw new Error("Out of bounds: data offset and length exceed the external file data size.");let w=y.slice(a,a+l).buffer,v;switch(u.dataType){case"float32":v=new Float32Array(w);break;case"float16":v=typeof Float16Array<"u"&&Float16Array.from?new Float16Array(w):new Uint16Array(w);break;case"int32":v=new Int32Array(w);break;case"uint32":v=new Uint32Array(w);break;case"int64":if(c){let C=Or(new Uint8Array(w),"int64");v=new Int32Array(C.buffer),u.dataType="int32"}else v=new BigInt64Array(w);break;case"uint64":v=new BigUint64Array(w);break;case"int8":v=new Int8Array(w);break;case"int4":case"uint4":case"uint8":v=new Uint8Array(w);break;default:throw new Error(`Unsupported data type: ${u.dataType} in creating WebNN Constant from external data.`)}return le("verbose",()=>`[WebNN] registerMLConstant {dataType: ${u.dataType}, shape: ${u.shape}}} ${c?"(Note: it was int64 data type and registered to int32 as workaround)":""}`),i.constant(u,v)}registerGraphInput(r){this.temporaryGraphInputs.push(r)}registerGraphOutput(r){this.temporaryGraphOutputs.push(r)}isGraphInput(r,a){let l=this.sessionGraphInputs.get(r);return l?l.includes(a):!1}isGraphOutput(r,a){let l=this.sessionGraphOutputs.get(r);return l?l.includes(a):!1}isGraphInputOutputTypeSupported(r,a,l=!0){let i=this.mlContextBySessionId.get(r),u=Ct.get(et(a));return typeof u>"u"?!1:l?!!i?.opSupportLimits().input.dataTypes.includes(u):!!i?.opSupportLimits().output.dataTypes.includes(u)}flush(){}}}),Ei,Pr,Ur,Fe,Ai,Lr,Ft,jr,$r,kr,Nr,Dr,Wr,xi=k(()=>{Qe(),Lo(),jo(),st(),Ke(),Cr(),li(),Ei=(r,a)=>{H()._OrtInit(r,a)!==0&&V("Can't initialize onnxruntime.")},Pr=async r=>{Ei(r.wasm.numThreads,Gt(r.logLevel))},Ur=async(r,a)=>{H().asyncInit?.();let l=r.webgpu.adapter;if(a==="webgpu"){if(typeof navigator>"u"||!navigator.gpu)throw new Error("WebGPU is not supported in current environment");if(l){if(typeof l.limits!="object"||typeof l.features!="object"||typeof l.requestDevice!="function")throw new Error("Invalid GPU adapter set in `env.webgpu.adapter`. It must be a GPUAdapter object.")}else{let i=r.webgpu.powerPreference;if(i!==void 0&&i!=="low-power"&&i!=="high-performance")throw new Error(`Invalid powerPreference setting: "${i}"`);let u=r.webgpu.forceFallbackAdapter;if(u!==void 0&&typeof u!="boolean")throw new Error(`Invalid forceFallbackAdapter setting: "${u}"`);if(l=await navigator.gpu.requestAdapter({powerPreference:i,forceFallbackAdapter:u}),!l)throw new Error('Failed to get GPU adapter. You may need to enable flag "--enable-unsafe-webgpu" if you are using Chrome.')}}if(a==="webnn"&&(typeof navigator>"u"||!navigator.ml))throw new Error("WebNN is not supported in current environment");if(a==="webgpu"&&H().webgpuInit(i=>{r.webgpu.device=i}),a==="webnn"){let i=new(No(),Rt(Ci)).WebNNBackend(r);H().webnnInit([i,()=>i.reserveTensorId(),u=>i.releaseTensorId(u),async(u,p,c,d,y)=>i.ensureTensor(u,p,c,d,y),(u,p)=>{i.uploadTensor(u,p)},async(u,p)=>i.downloadTensor(u,p),(u,p)=>i.registerMLContext(u,p),!!r.trace])}},Fe=new Map,Ai=r=>{let a=H(),l=a.stackSave();try{let i=a.PTR_SIZE,u=a.stackAlloc(2*i);a._OrtGetInputOutputCount(r,u,u+i)!==0&&V("Can't get session input/output count.");let p=i===4?"i32":"i64";return[Number(a.getValue(u,p)),Number(a.getValue(u+i,p))]}finally{a.stackRestore(l)}},Lr=(r,a)=>{let l=H(),i=l.stackSave(),u=0;try{let p=l.PTR_SIZE,c=l.stackAlloc(2*p);l._OrtGetInputOutputMetadata(r,a,c,c+p)!==0&&V("Can't get session input/output metadata.");let d=Number(l.getValue(c,"*"));u=Number(l.getValue(c+p,"*"));let y=l.HEAP32[u/4];if(y===0)return[d,0];let w=l.HEAPU32[u/4+1],v=[];for(let C=0;C<w;C++){let _=Number(l.getValue(u+8+C*p,"*"));v.push(_!==0?l.UTF8ToString(_):Number(l.getValue(u+8+(C+w)*p,"*")))}return[d,y,v]}finally{l.stackRestore(i),u!==0&&l._OrtFree(u)}},Ft=r=>{let a=H(),l=a._malloc(r.byteLength);if(l===0)throw new Error(`Can't create a session. failed to allocate a buffer of size ${r.byteLength}.`);return a.HEAPU8.set(r,l),[l,r.byteLength]},jr=async(r,a)=>{let l,i,u=H();Array.isArray(r)?[l,i]=r:r.buffer===u.HEAPU8.buffer?[l,i]=[r.byteOffset,r.byteLength]:[l,i]=Ft(r);let p=0,c=0,d=0,y=[],w=[],v=[];try{if([c,y]=await si(a),a?.externalData&&u.mountExternalData){let U=[];for(let F of a.externalData){let ie=typeof F=="string"?F:F.path;U.push(Ar(typeof F=="string"?F:F.data).then(se=>{u.mountExternalData(ie,se)}))}await Promise.all(U)}for(let U of a?.executionProviders??[])if((typeof U=="string"?U:U.name)==="webnn"){if(u.shouldTransferToMLTensor=!1,typeof U!="string"){let F=U,ie=F?.context,se=F?.gpuDevice,ee=F?.deviceType,te=F?.powerPreference;ie?u.currentContext=ie:se?u.currentContext=await u.webnnCreateMLContext(se):u.currentContext=await u.webnnCreateMLContext({deviceType:ee,powerPreference:te})}else u.currentContext=await u.webnnCreateMLContext();break}p=await u._OrtCreateSession(l,i,c),u.webgpuOnCreateSession?.(p),p===0&&V("Can't create a session."),u.jsepOnCreateSession?.(),u.currentContext&&(u.webnnRegisterMLContext(p,u.currentContext),u.currentContext=void 0,u.shouldTransferToMLTensor=!0);let[C,_]=Ai(p),O=!!a?.enableGraphCapture,R=[],j=[],L=[],P=[],M=[];for(let U=0;U<C;U++){let[F,ie,se]=Lr(p,U);F===0&&V("Can't get an input name."),w.push(F);let ee=u.UTF8ToString(F);R.push(ee),L.push(ie===0?{name:ee,isTensor:!1}:{name:ee,isTensor:!0,type:Wt(ie),shape:se})}for(let U=0;U<_;U++){let[F,ie,se]=Lr(p,U+C);F===0&&V("Can't get an output name."),v.push(F);let ee=u.UTF8ToString(F);j.push(ee),P.push(ie===0?{name:ee,isTensor:!1}:{name:ee,isTensor:!0,type:Wt(ie),shape:se});{if(O&&a?.preferredOutputLocation===void 0){M.push("gpu-buffer");continue}let te=typeof a?.preferredOutputLocation=="string"?a.preferredOutputLocation:a?.preferredOutputLocation?.[ee]??"cpu",ae=u.webnnIsGraphOutput;if(te==="cpu"&&ae&&ae(p,ee)){M.push("ml-tensor-cpu-output");continue}if(te!=="cpu"&&te!=="cpu-pinned"&&te!=="gpu-buffer"&&te!=="ml-tensor")throw new Error(`Not supported preferred output location: ${te}.`);if(O&&te!=="gpu-buffer")throw new Error(`Not supported preferred output location: ${te}. Only 'gpu-buffer' location is supported when enableGraphCapture is true.`);M.push(te)}}let D=null;return M.some(U=>U==="gpu-buffer"||U==="ml-tensor"||U==="ml-tensor-cpu-output")&&(d=u._OrtCreateBinding(p),d===0&&V("Can't create IO binding."),D={handle:d,outputPreferredLocations:M,outputPreferredLocationsEncoded:M.map(U=>U==="ml-tensor-cpu-output"?"ml-tensor":U).map(U=>Er(U))}),Fe.set(p,[p,w,v,D,O,!1]),[p,R,j,L,P]}catch(C){throw w.forEach(_=>u._OrtFree(_)),v.forEach(_=>u._OrtFree(_)),d!==0&&u._OrtReleaseBinding(d)!==0&&V("Can't release IO binding."),p!==0&&u._OrtReleaseSession(p)!==0&&V("Can't release session."),C}finally{u._free(l),c!==0&&u._OrtReleaseSessionOptions(c)!==0&&V("Can't release session options."),y.forEach(C=>u._free(C)),u.unmountExternalData?.()}},$r=r=>{let a=H(),l=Fe.get(r);if(!l)throw new Error(`cannot release session. invalid session id: ${r}`);let[i,u,p,c,d]=l;c&&(d&&a._OrtClearBoundOutputs(c.handle)!==0&&V("Can't clear bound outputs."),a._OrtReleaseBinding(c.handle)!==0&&V("Can't release IO binding.")),a.jsepOnReleaseSession?.(r),a.webnnOnReleaseSession?.(r),a.webgpuOnReleaseSession?.(r),u.forEach(y=>a._OrtFree(y)),p.forEach(y=>a._OrtFree(y)),a._OrtReleaseSession(i)!==0&&V("Can't release session."),Fe.delete(r)},kr=async(r,a,l,i,u,p,c=!1)=>{if(!r){a.push(0);return}let d=H(),y=d.PTR_SIZE,w=r[0],v=r[1],C=r[3],_=C,O,R;if(w==="string"&&(C==="gpu-buffer"||C==="ml-tensor"))throw new Error("String tensor is not supported on GPU.");if(c&&C!=="gpu-buffer")throw new Error(`External buffer must be provided for input/output index ${p} when enableGraphCapture is true.`);if(C==="gpu-buffer"){let P=r[2].gpuBuffer;R=ot(et(w),v);{let M=d.webgpuRegisterBuffer;if(!M)throw new Error('Tensor location "gpu-buffer" is not supported without using WebGPU.');O=M(P,i)}}else if(C==="ml-tensor"){let P=r[2].mlTensor;R=ot(et(w),v);let M=d.webnnRegisterMLTensor;if(!M)throw new Error('Tensor location "ml-tensor" is not supported without using WebNN.');O=M(i,P,et(w),v)}else{let P=r[2];if(Array.isArray(P)){R=y*P.length,O=d._malloc(R),l.push(O);for(let M=0;M<P.length;M++){if(typeof P[M]!="string")throw new TypeError(`tensor data at index ${M} is not a string`);d.setValue(O+M*y,he(P[M],l),"*")}}else{let M=d.webnnIsGraphInput,D=d.webnnIsGraphOutput;if(w!=="string"&&M&&D){let U=d.UTF8ToString(u);if(M(i,U)||D(i,U)){let F=et(w);R=ot(F,v),_="ml-tensor";let ie=d.webnnCreateTemporaryTensor,se=d.webnnUploadTensor;if(!ie||!se)throw new Error('Tensor location "ml-tensor" is not supported without using WebNN.');let ee=await ie(i,F,v);se(ee,new Uint8Array(P.buffer,P.byteOffset,P.byteLength)),O=ee}else R=P.byteLength,O=d._malloc(R),l.push(O),d.HEAPU8.set(new Uint8Array(P.buffer,P.byteOffset,R),O)}else R=P.byteLength,O=d._malloc(R),l.push(O),d.HEAPU8.set(new Uint8Array(P.buffer,P.byteOffset,R),O)}}let j=d.stackSave(),L=d.stackAlloc(4*v.length);try{v.forEach((M,D)=>d.setValue(L+D*y,M,y===4?"i32":"i64"));let P=d._OrtCreateTensor(et(w),O,R,L,v.length,Er(_));P===0&&V(`Can't create tensor for input/output. session=${i}, index=${p}.`),a.push(P)}finally{d.stackRestore(j)}},Nr=async(r,a,l,i,u,p)=>{let c=H(),d=c.PTR_SIZE,y=Fe.get(r);if(!y)throw new Error(`cannot run inference. invalid session id: ${r}`);let w=y[0],v=y[1],C=y[2],_=y[3],O=y[4],R=y[5],j=a.length,L=i.length,P=0,M=[],D=[],U=[],F=[],ie=c.stackSave(),se=c.stackAlloc(j*d),ee=c.stackAlloc(j*d),te=c.stackAlloc(L*d),ae=c.stackAlloc(L*d);try{[P,M]=ri(p),We("wasm prepareInputOutputTensor");for(let $=0;$<j;$++)await kr(l[$],D,F,r,v[a[$]],a[$],O);for(let $=0;$<L;$++)await kr(u[$],U,F,r,C[i[$]],j+i[$],O);Ge("wasm prepareInputOutputTensor");for(let $=0;$<j;$++)c.setValue(se+$*d,D[$],"*"),c.setValue(ee+$*d,v[a[$]],"*");for(let $=0;$<L;$++)c.setValue(te+$*d,U[$],"*"),c.setValue(ae+$*d,C[i[$]],"*");if(_&&!R){let{handle:$,outputPreferredLocations:be,outputPreferredLocationsEncoded:ft}=_;if(v.length!==j)throw new Error(`input count from feeds (${j}) is expected to be always equal to model's input count (${v.length}).`);We("wasm bindInputsOutputs");for(let N=0;N<j;N++){let oe=a[N];await c._OrtBindInput($,v[oe],D[N])!==0&&V(`Can't bind input[${N}] for session=${r}.`)}for(let N=0;N<L;N++){let oe=i[N];u[N]?.[3]?c._OrtBindOutput($,C[oe],U[N],0)!==0&&V(`Can't bind pre-allocated output[${N}] for session=${r}.`):c._OrtBindOutput($,C[oe],0,ft[oe])!==0&&V(`Can't bind output[${N}] to ${be[N]} for session=${r}.`)}Ge("wasm bindInputsOutputs"),Fe.set(r,[w,v,C,_,O,!0])}c.jsepOnRunStart?.(w),c.webnnOnRunStart?.(w);let X;_?X=await c._OrtRunWithBinding(w,_.handle,L,te,P):X=await c._OrtRun(w,ee,se,j,ae,L,te,P),X!==0&&V("failed to call OrtRun().");let we=[],Et=[];We("wasm ProcessOutputTensor");for(let $=0;$<L;$++){let be=Number(c.getValue(te+$*d,"*"));if(be===U[$]){we.push(u[$]);continue}let ft=c.stackSave(),N=c.stackAlloc(4*d),oe=!1,K,re=0;try{c._OrtGetTensorData(be,N,N+d,N+2*d,N+3*d)!==0&&V(`Can't access output tensor data on index ${$}.`);let Y=d===4?"i32":"i64",xe=Number(c.getValue(N,Y));re=c.getValue(N+d,"*");let dt=c.getValue(N+d*2,"*"),S=Number(c.getValue(N+d*3,Y)),A=[];for(let J=0;J<S;J++)A.push(Number(c.getValue(dt+J*d,Y)));c._OrtFree(dt)!==0&&V("Can't free memory for tensor dims.");let ve=A.reduce((J,W)=>J*W,1);K=Wt(xe);let ye=_?.outputPreferredLocations[i[$]];if(K==="string"){if(ye==="gpu-buffer"||ye==="ml-tensor")throw new Error("String tensor is not supported on GPU.");let J=[];for(let W=0;W<ve;W++){let Ce=c.getValue(re+W*d,"*"),nt=c.getValue(re+(W+1)*d,"*"),Re=W===ve-1?void 0:nt-Ce;J.push(c.UTF8ToString(Ce,Re))}we.push([K,A,J,"cpu"])}else if(ye==="gpu-buffer"&&ve>0){let J=c.webgpuGetBuffer;if(!J)throw new Error('preferredLocation "gpu-buffer" is not supported without using WebGPU.');let W=J(re),Ce=ot(xe,ve);if(Ce===void 0||!Tr(K))throw new Error(`Unsupported data type: ${K}`);oe=!0;{c.webgpuRegisterBuffer(W,r,re);let nt=c.webgpuCreateDownloader(W,Ce,r);we.push([K,A,{gpuBuffer:W,download:async()=>{let Re=await nt();return new(vt(K))(Re)},dispose:()=>{c._OrtReleaseTensor(be)!==0&&V("Can't release tensor.")}},"gpu-buffer"])}}else if(ye==="ml-tensor"&&ve>0){let J=c.webnnEnsureTensor,W=c.webnnIsGraphInputOutputTypeSupported;if(!J||!W)throw new Error('preferredLocation "ml-tensor" is not supported without using WebNN.');if(ot(xe,ve)===void 0||!_r(K))throw new Error(`Unsupported data type: ${K}`);if(!W(r,K,!1))throw new Error(`preferredLocation "ml-tensor" for ${K} output is not supported by current WebNN Context.`);let Ce=await J(r,re,xe,A,!1);oe=!0,we.push([K,A,{mlTensor:Ce,download:c.webnnCreateMLTensorDownloader(re,K),dispose:()=>{c.webnnReleaseTensorId(re),c._OrtReleaseTensor(be)}},"ml-tensor"])}else if(ye==="ml-tensor-cpu-output"&&ve>0){let J=c.webnnCreateMLTensorDownloader(re,K)(),W=we.length;oe=!0,Et.push((async()=>{let Ce=[W,await J];return c.webnnReleaseTensorId(re),c._OrtReleaseTensor(be),Ce})()),we.push([K,A,[],"cpu"])}else{let J=vt(K),W=new J(ve);new Uint8Array(W.buffer,W.byteOffset,W.byteLength).set(c.HEAPU8.subarray(re,re+W.byteLength)),we.push([K,A,W,"cpu"])}}finally{c.stackRestore(ft),K==="string"&&re&&c._free(re),oe||c._OrtReleaseTensor(be)}}_&&!O&&(c._OrtClearBoundOutputs(_.handle)!==0&&V("Can't clear bound outputs."),Fe.set(r,[w,v,C,_,O,!1]));for(let[$,be]of await Promise.all(Et))we[$][2]=be;return Ge("wasm ProcessOutputTensor"),we}finally{c.webnnOnRunEnd?.(w),c.stackRestore(ie),l.forEach(X=>{X&&X[3]==="gpu-buffer"&&c.webgpuUnregisterBuffer(X[2].gpuBuffer)}),u.forEach(X=>{X&&X[3]==="gpu-buffer"&&c.webgpuUnregisterBuffer(X[2].gpuBuffer)}),D.forEach(X=>c._OrtReleaseTensor(X)),U.forEach(X=>c._OrtReleaseTensor(X)),F.forEach(X=>c._free(X)),P!==0&&c._OrtReleaseRunOptions(P),M.forEach(X=>c._free(X))}},Dr=r=>{let a=H(),l=Fe.get(r);if(!l)throw new Error("invalid session id");let i=l[0],u=a._OrtEndProfiling(i);u===0&&V("Can't get an profile file name."),a._OrtFree(u)},Wr=r=>{let a=[];for(let l of r){let i=l[2];!Array.isArray(i)&&"buffer"in i&&a.push(i.buffer)}return a}}),Ve,ge,lt,Tt,_t,Vt,Gr,zt,tt,rt,Oi,Si,Ii,Mi,Bi,Ri,Pi,Ui,Li=k(()=>{Qe(),xi(),Ke(),gr(),Ve=()=>!!Z.wasm.proxy&&typeof document<"u",lt=!1,Tt=!1,_t=!1,zt=new Map,tt=(r,a)=>{let l=zt.get(r);l?l.push(a):zt.set(r,[a])},rt=()=>{if(lt||!Tt||_t||!ge)throw new Error("worker not ready")},Oi=r=>{switch(r.data.type){case"init-wasm":lt=!1,r.data.err?(_t=!0,Gr[1](r.data.err)):(Tt=!0,Gr[0]()),Vt&&(URL.revokeObjectURL(Vt),Vt=void 0);break;case"init-ep":case"copy-from":case"create":case"release":case"run":case"end-profiling":{let a=zt.get(r.data.type);r.data.err?a.shift()[1](r.data.err):a.shift()[0](r.data.out);break}}},Si=async()=>{if(!Tt){if(lt)throw new Error("multiple calls to 'initWasm()' detected.");if(_t)throw new Error("previous call to 'initWasm()' failed.");if(lt=!0,Ve())return new Promise((r,a)=>{ge?.terminate(),Jn().then(([l,i])=>{try{ge=i,ge.onerror=p=>a(p),ge.onmessage=Oi,Gr=[r,a];let u={type:"init-wasm",in:Z};!u.in.wasm.wasmPaths&&(l||pr)&&(u.in.wasm.wasmPaths={wasm:new URL("/assets/ort-wasm-simd-threaded.asyncify-BJtBjfiH.wasm",self.location.href).href}),ge.postMessage(u),Vt=l}catch(u){a(u)}},a)});try{await vr(Z.wasm),await Pr(Z),Tt=!0}catch(r){throw _t=!0,r}finally{lt=!1}}},Ii=async r=>{if(Ve())return rt(),new Promise((a,l)=>{tt("init-ep",[a,l]);let i={type:"init-ep",in:{epName:r,env:Z}};ge.postMessage(i)});await Ur(Z,r)},Mi=async r=>Ve()?(rt(),new Promise((a,l)=>{tt("copy-from",[a,l]);let i={type:"copy-from",in:{buffer:r}};ge.postMessage(i,[r.buffer])})):Ft(r),Bi=async(r,a)=>{if(Ve()){if(a?.preferredOutputLocation)throw new Error('session option "preferredOutputLocation" is not supported for proxy.');return rt(),new Promise((l,i)=>{tt("create",[l,i]);let u={type:"create",in:{model:r,options:{...a}}},p=[];r instanceof Uint8Array&&p.push(r.buffer),ge.postMessage(u,p)})}else return jr(r,a)},Ri=async r=>{if(Ve())return rt(),new Promise((a,l)=>{tt("release",[a,l]);let i={type:"release",in:r};ge.postMessage(i)});$r(r)},Pi=async(r,a,l,i,u,p)=>{if(Ve()){if(l.some(c=>c[3]!=="cpu"))throw new Error("input tensor on GPU is not supported for proxy.");if(u.some(c=>c))throw new Error("pre-allocated output tensor is not supported for proxy.");return rt(),new Promise((c,d)=>{tt("run",[c,d]);let y=l,w={type:"run",in:{sessionId:r,inputIndices:a,inputs:y,outputIndices:i,options:p}};ge.postMessage(w,Wr(y))})}else return Nr(r,a,l,i,u,p)},Ui=async r=>{if(Ve())return rt(),new Promise((a,l)=>{tt("end-profiling",[a,l]);let i={type:"end-profiling",in:r};ge.postMessage(i)});Dr(r)}}),Fr,ji,$i,Do=k(()=>{Qe(),Li(),st(),lr(),li(),Fr=(r,a)=>{switch(r.location){case"cpu":return[r.type,r.dims,r.data,"cpu"];case"gpu-buffer":return[r.type,r.dims,{gpuBuffer:r.gpuBuffer},"gpu-buffer"];case"ml-tensor":return[r.type,r.dims,{mlTensor:r.mlTensor},"ml-tensor"];default:throw new Error(`invalid data location: ${r.location} for ${a()}`)}},ji=r=>{switch(r[3]){case"cpu":return new Ae(r[0],r[2],r[1]);case"gpu-buffer":{let a=r[0];if(!Tr(a))throw new Error(`not supported data type: ${a} for deserializing GPU tensor`);let{gpuBuffer:l,download:i,dispose:u}=r[2];return Ae.fromGpuBuffer(l,{dataType:a,dims:r[1],download:i,dispose:u})}case"ml-tensor":{let a=r[0];if(!_r(a))throw new Error(`not supported data type: ${a} for deserializing MLTensor tensor`);let{mlTensor:l,download:i,dispose:u}=r[2];return Ae.fromMLTensor(l,{dataType:a,dims:r[1],download:i,dispose:u})}default:throw new Error(`invalid data location: ${r[3]}`)}},$i=class{async fetchModelAndCopyToWasmMemory(r){return Mi(await Ar(r))}async loadModel(r,a){Ye();let l;typeof r=="string"?l=await this.fetchModelAndCopyToWasmMemory(r):l=r,[this.sessionId,this.inputNames,this.outputNames,this.inputMetadata,this.outputMetadata]=await Bi(l,a),Je()}async dispose(){return Ri(this.sessionId)}async run(r,a,l){Ye();let i=[],u=[];Object.entries(r).forEach(C=>{let _=C[0],O=C[1],R=this.inputNames.indexOf(_);if(R===-1)throw new Error(`invalid input '${_}'`);i.push(O),u.push(R)});let p=[],c=[];Object.entries(a).forEach(C=>{let _=C[0],O=C[1],R=this.outputNames.indexOf(_);if(R===-1)throw new Error(`invalid output '${_}'`);p.push(O),c.push(R)});let d=i.map((C,_)=>Fr(C,()=>`input "${this.inputNames[u[_]]}"`)),y=p.map((C,_)=>C?Fr(C,()=>`output "${this.outputNames[c[_]]}"`):null),w=await Pi(this.sessionId,u,d,c,y,l),v={};for(let C=0;C<w.length;C++)v[this.outputNames[c[C]]]=p[C]??ji(w[C]);return Je(),v}startProfiling(){}endProfiling(){Ui(this.sessionId)}}}),ki={};mt(ki,{OnnxruntimeWebAssemblyBackend:()=>zr,initializeFlags:()=>Vr,wasmBackend:()=>Ni});var Vr,zr,Ni,Wo=k(()=>{Qe(),Li(),Do(),Vr=()=>{(typeof Z.wasm.initTimeout!="number"||Z.wasm.initTimeout<0)&&(Z.wasm.initTimeout=0);let r=Z.wasm.simd;if(typeof r!="boolean"&&r!==void 0&&r!=="fixed"&&r!=="relaxed"&&(console.warn(`Property "env.wasm.simd" is set to unknown value "${r}". Reset it to \`false\` and ignore SIMD feature checking.`),Z.wasm.simd=!1),typeof Z.wasm.proxy!="boolean"&&(Z.wasm.proxy=!1),typeof Z.wasm.trace!="boolean"&&(Z.wasm.trace=!1),typeof Z.wasm.numThreads!="number"||!Number.isInteger(Z.wasm.numThreads)||Z.wasm.numThreads<=0)if(typeof self<"u"&&!self.crossOriginIsolated)Z.wasm.numThreads=1;else{let a=typeof navigator>"u"?wo("node:os").cpus().length:navigator.hardwareConcurrency;Z.wasm.numThreads=Math.min(4,Math.ceil((a||1)/2))}},zr=class{async init(r){Vr(),await Si(),await Ii(r)}async createInferenceSessionHandler(r,a){let l=new $i;return await l.loadModel(r,a),l}},Ni=new zr});Qe(),Qe(),Qe();var Go="1.23.2",Fo=Dn;{let r=(Wo(),Rt(ki)).wasmBackend;Ze("webgpu",r,5),Ze("webnn",r,5),Ze("cpu",r,10),Ze("wasm",r,10)}Object.defineProperty(Z.versions,"web",{value:Go,enumerable:!0});var Vo=Object.freeze({__proto__:null,get InferenceSession(){return Lt},get TRACE(){return Ut},get TRACE_EVENT_BEGIN(){return We},get TRACE_EVENT_END(){return Ge},get TRACE_FUNC_BEGIN(){return Ye},get TRACE_FUNC_END(){return Je},get Tensor(){return Ae},default:Fo,get env(){return Z},get registerBackend(){return Ze}});const zo="mic-onnx-models",ut="models",Ho=1;function Di(){return new Promise((r,a)=>{const l=indexedDB.open(zo,Ho);l.onupgradeneeded=function(i){const u=l.result;u.objectStoreNames.contains(ut)||u.createObjectStore(ut,{keyPath:"modelUrl"})},l.onsuccess=function(){r(l.result)},l.onerror=function(i){a(i)}})}async function qo(r){const a=await Di();return new Promise((l,i)=>{const c=a.transaction([ut],"readonly").objectStore(ut).get(r);c.onsuccess=function(){l(c.result?c.result.data:null)},c.onerror=function(d){i(d)}})}async function Zo(r,a){const l=await Di();return new Promise((i,u)=>{const p=l.transaction([ut],"readwrite");p.objectStore(ut).put({modelUrl:r,data:a}),p.oncomplete=function(){i()},p.onerror=function(d){u(d)}})}function Xo(r){const a=r.byteLength;if(a<1024*1024)throw new Error(`ONNX file too small (${a} bytes)`);const l=new Uint8Array(r.slice(0,16));if(l.every(u=>u>=9&&u<=126)){const u=new TextDecoder().decode(l);throw new Error(`Downloaded file looks like text: ${u}`)}}async function Yo(r,a){const l=await fetch(r,{cache:"no-store",headers:{Accept:"application/octet-stream"}});if(!l.ok)throw new Error(`Failed to download model ${r}: ${l.status}`);const i=l.headers.get("content-length"),u=i?parseInt(i,10):null;if(!l.body)throw new Error("Response body is null");const p=l.body.getReader(),c=[];let d=0;for(self.postMessage({status:"download_start",modelUrl:r,total:u});;){const{done:v,value:C}=await p.read();if(v)break;c.push(C),d+=C.byteLength,self.postMessage({status:"download_progress",modelUrl:r,received:d,total:u,progress:u?d/u*100:-1})}const y=new Uint8Array(d);let w=0;for(const v of c)y.set(v,w),w+=v.byteLength;return Xo(y.buffer),self.postMessage({status:"download_complete",modelUrl:r,size:d}),y.buffer}class Jo{static modelSessions={};static sessionPromises={};static creatingSession=!1;static async getSession(a){if(this.modelSessions[a])return this.modelSessions[a];if(this.sessionPromises[a])return this.sessionPromises[a];for(;this.creatingSession;)await new Promise(i=>setTimeout(i,10));if(this.modelSessions[a])return this.modelSessions[a];if(this.sessionPromises[a])return this.sessionPromises[a];this.creatingSession=!0;const l=(async()=>{console.log("",a);let i=await qo(a);i||(console.log("",a),i=await Yo(a),console.log("",a),await Zo(a,i),console.log("",a));const u=await Lt.create(i,{executionProviders:["webgpu"],logSeverityLevel:3,logVerbosityLevel:0});return this.modelSessions[a]={session:u,ort:Vo},this.creatingSession=!1,this.modelSessions[a]})().catch(i=>{throw delete this.sessionPromises[a],this.creatingSession=!1,i});return this.sessionPromises[a]=l,l}static async predict({embedding:a,modelUrl:l,target:i}){return await this.predictEmbedding({embedding:a,modelUrl:l})}static async predictEmbedding({embedding:a,modelUrl:l,device:i="webgpu"}){const{session:u,ort:p}=await this.getSession(l);let c;if(a instanceof Float32Array)c=a;else if(Array.isArray(a))c=new Float32Array(a);else throw new Error("Invalid embedding format");let d=1,y=320;if(c.length%(d*y)!==0)throw new Error(` (${c.length})  320`);let w=c.length/(d*y);if(!Number.isInteger(w))throw new Error(`: ${c.length} / (${d}*${y})`);const v=new p.Tensor("float32",c,[d,w,y]),_={[u.inputNames[0]]:v},O=await u.run(_),R=u.outputNames[0],j=O[R];return{mic:Array.isArray(j.data)?j.data[0]:j.data,outputRaw:j.data}}}self.addEventListener("message",async r=>{try{const{embedding:a,modelUrl:l,device:i}=r.data||{};self.postMessage({status:"computing",message:"MIC..."});const u=await Jo.predictEmbedding({embedding:a,modelUrl:l,device:i});self.postMessage({status:"complete",mic:u.mic,outputRaw:u.outputRaw})}catch(a){self.postMessage({status:"error",error:a.message||String(a)})}})})();
