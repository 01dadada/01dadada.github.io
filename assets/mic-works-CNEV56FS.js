(function(){"use strict";var rr=Object.defineProperty,po=Object.getOwnPropertyDescriptor,ho=Object.getOwnPropertyNames,yo=Object.prototype.hasOwnProperty,mo=(n=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(n,{get:(a,l)=>(typeof require<"u"?require:a)[l]}):n)(function(n){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+n+'" is not supported')}),k=(n,a)=>()=>(n&&(a=n(n=0)),a),yt=(n,a)=>{for(var l in a)rr(n,l,{get:a[l],enumerable:!0})},go=(n,a,l,i)=>{if(a&&typeof a=="object"||typeof a=="function")for(let u of ho(a))!yo.call(n,u)&&u!==l&&rr(n,u,{get:()=>a[u],enumerable:!(i=po(a,u))||i.enumerable});return n},Mt=n=>go(rr({},"__esModule",{value:!0}),n),mt,De,Ze,Cn,Tn,_n=k(()=>{mt=new Map,De=[],Ze=(n,a,l)=>{if(a&&typeof a.init=="function"&&typeof a.createInferenceSessionHandler=="function"){let i=mt.get(n);if(i===void 0)mt.set(n,{backend:a,priority:l});else{if(i.priority>l)return;if(i.priority===l&&i.backend!==a)throw new Error(`cannot register backend "${n}" using priority ${l}`)}if(l>=0){let u=De.indexOf(n);u!==-1&&De.splice(u,1);for(let p=0;p<De.length;p++)if(mt.get(De[p]).priority<=l){De.splice(p,0,n);return}De.push(n)}return}throw new TypeError("not a valid backend")},Cn=async n=>{let a=mt.get(n);if(!a)return"backend not found.";if(a.initialized)return a.backend;if(a.aborted)return a.error;{let l=!!a.initPromise;try{return l||(a.initPromise=a.backend.init(n)),await a.initPromise,a.initialized=!0,a.backend}catch(i){return l||(a.error=`${i}`,a.aborted=!0),a.error}finally{delete a.initPromise}}},Tn=async n=>{let a=n.executionProviders||[],l=a.map(y=>typeof y=="string"?y:y.name),i=l.length===0?De:l,u,p=[],c=new Set;for(let y of i){let w=await Cn(y);typeof w=="string"?p.push({name:y,err:w}):(u||(u=w),u===w&&c.add(y))}if(!u)throw new Error(`no available backend found. ERR: ${p.map(y=>`[${y.name}] ${y.err}`).join(", ")}`);for(let{name:y,err:w}of p)l.includes(y)&&console.warn(`removing requested execution provider "${y}" from session options because it is not available: ${w}`);let d=a.filter(y=>c.has(typeof y=="string"?y:y.name));return[u,new Proxy(n,{get:(y,w)=>w==="executionProviders"?d:Reflect.get(y,w)})]}}),wo=k(()=>{_n()}),En,bo=k(()=>{En="1.23.2"}),nr,ne,An=k(()=>{bo(),nr="warning",ne={wasm:{},webgl:{},webgpu:{},versions:{common:En},set logLevel(n){if(n!==void 0){if(typeof n!="string"||["verbose","info","warning","error","fatal"].indexOf(n)===-1)throw new Error(`Unsupported logging level: ${n}`);nr=n}},get logLevel(){return nr}},Object.defineProperty(ne,"logLevel",{enumerable:!0})}),Z,vo=k(()=>{An(),Z=ne}),xn,On,Co=k(()=>{xn=(n,a)=>{let l=typeof document<"u"?document.createElement("canvas"):new OffscreenCanvas(1,1);l.width=n.dims[3],l.height=n.dims[2];let i=l.getContext("2d");if(i!=null){let u,p;a?.tensorLayout!==void 0&&a.tensorLayout==="NHWC"?(u=n.dims[2],p=n.dims[3]):(u=n.dims[3],p=n.dims[2]);let c=a?.format!==void 0?a.format:"RGB",d=a?.norm,y,w;d===void 0||d.mean===void 0?y=[255,255,255,255]:typeof d.mean=="number"?y=[d.mean,d.mean,d.mean,d.mean]:(y=[d.mean[0],d.mean[1],d.mean[2],0],d.mean[3]!==void 0&&(y[3]=d.mean[3])),d===void 0||d.bias===void 0?w=[0,0,0,0]:typeof d.bias=="number"?w=[d.bias,d.bias,d.bias,d.bias]:(w=[d.bias[0],d.bias[1],d.bias[2],0],d.bias[3]!==void 0&&(w[3]=d.bias[3]));let v=p*u,C=0,_=v,O=v*2,R=-1;c==="RGBA"?(C=0,_=v,O=v*2,R=v*3):c==="RGB"?(C=0,_=v,O=v*2):c==="RBG"&&(C=0,O=v,_=v*2);for(let j=0;j<p;j++)for(let L=0;L<u;L++){let U=(n.data[C++]-w[0])*y[0],B=(n.data[_++]-w[1])*y[1],D=(n.data[O++]-w[2])*y[2],P=R===-1?255:(n.data[R++]-w[3])*y[3];i.fillStyle="rgba("+U+","+B+","+D+","+P+")",i.fillRect(L,j,1,1)}if("toDataURL"in l)return l.toDataURL();throw new Error("toDataURL is not supported")}else throw new Error("Can not access image data")},On=(n,a)=>{let l=typeof document<"u"?document.createElement("canvas").getContext("2d"):new OffscreenCanvas(1,1).getContext("2d"),i;if(l!=null){let u,p,c;a?.tensorLayout!==void 0&&a.tensorLayout==="NHWC"?(u=n.dims[2],p=n.dims[1],c=n.dims[3]):(u=n.dims[3],p=n.dims[2],c=n.dims[1]);let d=a!==void 0&&a.format!==void 0?a.format:"RGB",y=a?.norm,w,v;y===void 0||y.mean===void 0?w=[255,255,255,255]:typeof y.mean=="number"?w=[y.mean,y.mean,y.mean,y.mean]:(w=[y.mean[0],y.mean[1],y.mean[2],255],y.mean[3]!==void 0&&(w[3]=y.mean[3])),y===void 0||y.bias===void 0?v=[0,0,0,0]:typeof y.bias=="number"?v=[y.bias,y.bias,y.bias,y.bias]:(v=[y.bias[0],y.bias[1],y.bias[2],0],y.bias[3]!==void 0&&(v[3]=y.bias[3]));let C=p*u;if(a!==void 0&&(a.format!==void 0&&c===4&&a.format!=="RGBA"||c===3&&a.format!=="RGB"&&a.format!=="BGR"))throw new Error("Tensor format doesn't match input tensor dims");let _=4,O=0,R=1,j=2,L=3,U=0,B=C,D=C*2,P=-1;d==="RGBA"?(U=0,B=C,D=C*2,P=C*3):d==="RGB"?(U=0,B=C,D=C*2):d==="RBG"&&(U=0,D=C,B=C*2),i=l.createImageData(u,p);for(let F=0;F<p*u;O+=_,R+=_,j+=_,L+=_,F++)i.data[O]=(n.data[U++]-v[0])*w[0],i.data[R]=(n.data[B++]-v[1])*w[1],i.data[j]=(n.data[D++]-v[2])*w[2],i.data[L]=P===-1?255:(n.data[P++]-v[3])*w[3]}else throw new Error("Can not access image data");return i}}),Rt,In,Sn,Bn,Mn,Rn,To=k(()=>{ar(),Rt=(n,a)=>{if(n===void 0)throw new Error("Image buffer must be defined");if(a.height===void 0||a.width===void 0)throw new Error("Image height and width must be defined");if(a.tensorLayout==="NHWC")throw new Error("NHWC Tensor layout is not supported yet");let{height:l,width:i}=a,u=a.norm??{mean:255,bias:0},p,c;typeof u.mean=="number"?p=[u.mean,u.mean,u.mean,u.mean]:p=[u.mean[0],u.mean[1],u.mean[2],u.mean[3]??255],typeof u.bias=="number"?c=[u.bias,u.bias,u.bias,u.bias]:c=[u.bias[0],u.bias[1],u.bias[2],u.bias[3]??0];let d=a.format!==void 0?a.format:"RGBA",y=a.tensorFormat!==void 0&&a.tensorFormat!==void 0?a.tensorFormat:"RGB",w=l*i,v=y==="RGBA"?new Float32Array(w*4):new Float32Array(w*3),C=4,_=0,O=1,R=2,j=3,L=0,U=w,B=w*2,D=-1;d==="RGB"&&(C=3,_=0,O=1,R=2,j=-1),y==="RGBA"?D=w*3:y==="RBG"?(L=0,B=w,U=w*2):y==="BGR"&&(B=0,U=w,L=w*2);for(let P=0;P<w;P++,_+=C,R+=C,O+=C,j+=C)v[L++]=(n[_]+c[0])/p[0],v[U++]=(n[O]+c[1])/p[1],v[B++]=(n[R]+c[2])/p[2],D!==-1&&j!==-1&&(v[D++]=(n[j]+c[3])/p[3]);return y==="RGBA"?new ce("float32",v,[1,4,l,i]):new ce("float32",v,[1,3,l,i])},In=async(n,a)=>{let l=typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement,i=typeof ImageData<"u"&&n instanceof ImageData,u=typeof ImageBitmap<"u"&&n instanceof ImageBitmap,p=typeof n=="string",c,d=a??{},y=()=>{if(typeof document<"u")return document.createElement("canvas");if(typeof OffscreenCanvas<"u")return new OffscreenCanvas(1,1);throw new Error("Canvas is not supported")},w=v=>typeof HTMLCanvasElement<"u"&&v instanceof HTMLCanvasElement||v instanceof OffscreenCanvas?v.getContext("2d"):null;if(l){let v=y();v.width=n.width,v.height=n.height;let C=w(v);if(C!=null){let _=n.height,O=n.width;if(a!==void 0&&a.resizedHeight!==void 0&&a.resizedWidth!==void 0&&(_=a.resizedHeight,O=a.resizedWidth),a!==void 0){if(d=a,a.tensorFormat!==void 0)throw new Error("Image input config format must be RGBA for HTMLImageElement");d.tensorFormat="RGBA",d.height=_,d.width=O}else d.tensorFormat="RGBA",d.height=_,d.width=O;C.drawImage(n,0,0),c=C.getImageData(0,0,O,_).data}else throw new Error("Can not access image data")}else if(i){let v,C;if(a!==void 0&&a.resizedWidth!==void 0&&a.resizedHeight!==void 0?(v=a.resizedHeight,C=a.resizedWidth):(v=n.height,C=n.width),a!==void 0&&(d=a),d.format="RGBA",d.height=v,d.width=C,a!==void 0){let _=y();_.width=C,_.height=v;let O=w(_);if(O!=null)O.putImageData(n,0,0),c=O.getImageData(0,0,C,v).data;else throw new Error("Can not access image data")}else c=n.data}else if(u){if(a===void 0)throw new Error("Please provide image config with format for Imagebitmap");let v=y();v.width=n.width,v.height=n.height;let C=w(v);if(C!=null){let _=n.height,O=n.width;return C.drawImage(n,0,0,O,_),c=C.getImageData(0,0,O,_).data,d.height=_,d.width=O,Rt(c,d)}else throw new Error("Can not access image data")}else{if(p)return new Promise((v,C)=>{let _=y(),O=w(_);if(!n||!O)return C();let R=new Image;R.crossOrigin="Anonymous",R.src=n,R.onload=()=>{_.width=R.width,_.height=R.height,O.drawImage(R,0,0,_.width,_.height);let j=O.getImageData(0,0,_.width,_.height);d.height=_.height,d.width=_.width,v(Rt(j.data,d))}});throw new Error("Input data provided is not supported - aborted tensor creation")}if(c!==void 0)return Rt(c,d);throw new Error("Input data provided is not supported - aborted tensor creation")},Sn=(n,a)=>{let{width:l,height:i,download:u,dispose:p}=a,c=[1,i,l,4];return new ce({location:"texture",type:"float32",texture:n,dims:c,download:u,dispose:p})},Bn=(n,a)=>{let{dataType:l,dims:i,download:u,dispose:p}=a;return new ce({location:"gpu-buffer",type:l??"float32",gpuBuffer:n,dims:i,download:u,dispose:p})},Mn=(n,a)=>{let{dataType:l,dims:i,download:u,dispose:p}=a;return new ce({location:"ml-tensor",type:l??"float32",mlTensor:n,dims:i,download:u,dispose:p})},Rn=(n,a,l)=>new ce({location:"cpu-pinned",type:n,data:a,dims:l??[a.length]})}),Xe,gt,ir,Un,_o=k(()=>{Xe=new Map([["float32",Float32Array],["uint8",Uint8Array],["int8",Int8Array],["uint16",Uint16Array],["int16",Int16Array],["int32",Int32Array],["bool",Uint8Array],["float64",Float64Array],["uint32",Uint32Array],["int4",Uint8Array],["uint4",Uint8Array]]),gt=new Map([[Float32Array,"float32"],[Uint8Array,"uint8"],[Int8Array,"int8"],[Uint16Array,"uint16"],[Int16Array,"int16"],[Int32Array,"int32"],[Float64Array,"float64"],[Uint32Array,"uint32"]]),ir=!1,Un=()=>{if(!ir){ir=!0;let n=typeof BigInt64Array<"u"&&BigInt64Array.from,a=typeof BigUint64Array<"u"&&BigUint64Array.from,l=globalThis.Float16Array,i=typeof l<"u"&&l.from;n&&(Xe.set("int64",BigInt64Array),gt.set(BigInt64Array,"int64")),a&&(Xe.set("uint64",BigUint64Array),gt.set(BigUint64Array,"uint64")),i?(Xe.set("float16",l),gt.set(l,"float16")):Xe.set("float16",Uint16Array)}}}),Pn,Ln,Eo=k(()=>{ar(),Pn=n=>{let a=1;for(let l=0;l<n.length;l++){let i=n[l];if(typeof i!="number"||!Number.isSafeInteger(i))throw new TypeError(`dims[${l}] must be an integer, got: ${i}`);if(i<0)throw new RangeError(`dims[${l}] must be a non-negative integer, got: ${i}`);a*=i}return a},Ln=(n,a)=>{switch(n.location){case"cpu":return new ce(n.type,n.data,a);case"cpu-pinned":return new ce({location:"cpu-pinned",data:n.data,type:n.type,dims:a});case"texture":return new ce({location:"texture",texture:n.texture,type:n.type,dims:a});case"gpu-buffer":return new ce({location:"gpu-buffer",gpuBuffer:n.gpuBuffer,type:n.type,dims:a});case"ml-tensor":return new ce({location:"ml-tensor",mlTensor:n.mlTensor,type:n.type,dims:a});default:throw new Error(`tensorReshape: tensor location ${n.location} is not supported`)}}}),ce,ar=k(()=>{Co(),To(),_o(),Eo(),ce=class{constructor(n,a,l){Un();let i,u;if(typeof n=="object"&&"location"in n)switch(this.dataLocation=n.location,i=n.type,u=n.dims,n.location){case"cpu-pinned":{let c=Xe.get(i);if(!c)throw new TypeError(`unsupported type "${i}" to create tensor from pinned buffer`);if(!(n.data instanceof c))throw new TypeError(`buffer should be of type ${c.name}`);this.cpuData=n.data;break}case"texture":{if(i!=="float32")throw new TypeError(`unsupported type "${i}" to create tensor from texture`);this.gpuTextureData=n.texture,this.downloader=n.download,this.disposer=n.dispose;break}case"gpu-buffer":{if(i!=="float32"&&i!=="float16"&&i!=="int32"&&i!=="int64"&&i!=="uint32"&&i!=="uint8"&&i!=="bool"&&i!=="uint4"&&i!=="int4")throw new TypeError(`unsupported type "${i}" to create tensor from gpu buffer`);this.gpuBufferData=n.gpuBuffer,this.downloader=n.download,this.disposer=n.dispose;break}case"ml-tensor":{if(i!=="float32"&&i!=="float16"&&i!=="int32"&&i!=="int64"&&i!=="uint32"&&i!=="uint64"&&i!=="int8"&&i!=="uint8"&&i!=="bool"&&i!=="uint4"&&i!=="int4")throw new TypeError(`unsupported type "${i}" to create tensor from MLTensor`);this.mlTensorData=n.mlTensor,this.downloader=n.download,this.disposer=n.dispose;break}default:throw new Error(`Tensor constructor: unsupported location '${this.dataLocation}'`)}else{let c,d;if(typeof n=="string")if(i=n,d=l,n==="string"){if(!Array.isArray(a))throw new TypeError("A string tensor's data must be a string array.");c=a}else{let y=Xe.get(n);if(y===void 0)throw new TypeError(`Unsupported tensor type: ${n}.`);if(Array.isArray(a)){if(n==="float16"&&y===Uint16Array||n==="uint4"||n==="int4")throw new TypeError(`Creating a ${n} tensor from number array is not supported. Please use ${y.name} as data.`);n==="uint64"||n==="int64"?c=y.from(a,BigInt):c=y.from(a)}else if(a instanceof y)c=a;else if(a instanceof Uint8ClampedArray)if(n==="uint8")c=Uint8Array.from(a);else throw new TypeError("A Uint8ClampedArray tensor's data must be type of uint8");else if(n==="float16"&&a instanceof Uint16Array&&y!==Uint16Array)c=new globalThis.Float16Array(a.buffer,a.byteOffset,a.length);else throw new TypeError(`A ${i} tensor's data must be type of ${y}`)}else if(d=a,Array.isArray(n)){if(n.length===0)throw new TypeError("Tensor type cannot be inferred from an empty array.");let y=typeof n[0];if(y==="string")i="string",c=n;else if(y==="boolean")i="bool",c=Uint8Array.from(n);else throw new TypeError(`Invalid element type of data array: ${y}.`)}else if(n instanceof Uint8ClampedArray)i="uint8",c=Uint8Array.from(n);else{let y=gt.get(n.constructor);if(y===void 0)throw new TypeError(`Unsupported type for tensor data: ${n.constructor}.`);i=y,c=n}if(d===void 0)d=[c.length];else if(!Array.isArray(d))throw new TypeError("A tensor's dims must be a number array");u=d,this.cpuData=c,this.dataLocation="cpu"}let p=Pn(u);if(this.cpuData&&p!==this.cpuData.length&&!((i==="uint4"||i==="int4")&&Math.ceil(p/2)===this.cpuData.length))throw new Error(`Tensor's size(${p}) does not match data length(${this.cpuData.length}).`);this.type=i,this.dims=u,this.size=p}static async fromImage(n,a){return In(n,a)}static fromTexture(n,a){return Sn(n,a)}static fromGpuBuffer(n,a){return Bn(n,a)}static fromMLTensor(n,a){return Mn(n,a)}static fromPinnedBuffer(n,a,l){return Rn(n,a,l)}toDataURL(n){return xn(this,n)}toImageData(n){return On(this,n)}get data(){if(this.ensureValid(),!this.cpuData)throw new Error("The data is not on CPU. Use `getData()` to download GPU data to CPU, or use `texture` or `gpuBuffer` property to access the GPU data directly.");return this.cpuData}get location(){return this.dataLocation}get texture(){if(this.ensureValid(),!this.gpuTextureData)throw new Error("The data is not stored as a WebGL texture.");return this.gpuTextureData}get gpuBuffer(){if(this.ensureValid(),!this.gpuBufferData)throw new Error("The data is not stored as a WebGPU buffer.");return this.gpuBufferData}get mlTensor(){if(this.ensureValid(),!this.mlTensorData)throw new Error("The data is not stored as a WebNN MLTensor.");return this.mlTensorData}async getData(n){switch(this.ensureValid(),this.dataLocation){case"cpu":case"cpu-pinned":return this.data;case"texture":case"gpu-buffer":case"ml-tensor":{if(!this.downloader)throw new Error("The current tensor is not created with a specified data downloader.");if(this.isDownloading)throw new Error("The current tensor is being downloaded.");try{this.isDownloading=!0;let a=await this.downloader();return this.downloader=void 0,this.dataLocation="cpu",this.cpuData=a,n&&this.disposer&&(this.disposer(),this.disposer=void 0),a}finally{this.isDownloading=!1}}default:throw new Error(`cannot get data from location: ${this.dataLocation}`)}}dispose(){if(this.isDownloading)throw new Error("The current tensor is being downloaded.");this.disposer&&(this.disposer(),this.disposer=void 0),this.cpuData=void 0,this.gpuTextureData=void 0,this.gpuBufferData=void 0,this.mlTensorData=void 0,this.downloader=void 0,this.isDownloading=void 0,this.dataLocation="none"}ensureValid(){if(this.dataLocation==="none")throw new Error("The tensor is disposed.")}reshape(n){if(this.ensureValid(),this.downloader||this.disposer)throw new Error("Cannot reshape a tensor that owns GPU resource.");return Ln(this,n)}}}),Ae,jn=k(()=>{ar(),Ae=ce}),Ut,or,Ye,Je,We,Ge,$n=k(()=>{An(),Ut=(n,a)=>{(typeof ne.trace>"u"?!ne.wasm.trace:!ne.trace)||console.timeStamp(`${n}::ORT::${a}`)},or=(n,a)=>{let l=new Error().stack?.split(/\r\n|\r|\n/g)||[],i=!1;for(let u=0;u<l.length;u++){if(i&&!l[u].includes("TRACE_FUNC")){let p=`FUNC_${n}::${l[u].trim().split(" ")[1]}`;a&&(p+=`::${a}`),Ut("CPU",p);return}l[u].includes("TRACE_FUNC")&&(i=!0)}},Ye=n=>{(typeof ne.trace>"u"?!ne.wasm.trace:!ne.trace)||or("BEGIN",n)},Je=n=>{(typeof ne.trace>"u"?!ne.wasm.trace:!ne.trace)||or("END",n)},We=n=>{(typeof ne.trace>"u"?!ne.wasm.trace:!ne.trace)||console.time(`ORT::${n}`)},Ge=n=>{(typeof ne.trace>"u"?!ne.wasm.trace:!ne.trace)||console.timeEnd(`ORT::${n}`)}}),kn,Ao=k(()=>{_n(),jn(),$n(),kn=class co{constructor(a){this.handler=a}async run(a,l,i){Ye(),We("InferenceSession.run");let u={},p={};if(typeof a!="object"||a===null||a instanceof Ae||Array.isArray(a))throw new TypeError("'feeds' must be an object that use input names as keys and OnnxValue as corresponding values.");let c=!0;if(typeof l=="object"){if(l===null)throw new TypeError("Unexpected argument[1]: cannot be null.");if(l instanceof Ae)throw new TypeError("'fetches' cannot be a Tensor");if(Array.isArray(l)){if(l.length===0)throw new TypeError("'fetches' cannot be an empty array.");c=!1;for(let w of l){if(typeof w!="string")throw new TypeError("'fetches' must be a string array or an object.");if(this.outputNames.indexOf(w)===-1)throw new RangeError(`'fetches' contains invalid output name: ${w}.`);u[w]=null}if(typeof i=="object"&&i!==null)p=i;else if(typeof i<"u")throw new TypeError("'options' must be an object.")}else{let w=!1,v=Object.getOwnPropertyNames(l);for(let C of this.outputNames)if(v.indexOf(C)!==-1){let _=l[C];(_===null||_ instanceof Ae)&&(w=!0,c=!1,u[C]=_)}if(w){if(typeof i=="object"&&i!==null)p=i;else if(typeof i<"u")throw new TypeError("'options' must be an object.")}else p=l}}else if(typeof l<"u")throw new TypeError("Unexpected argument[1]: must be 'fetches' or 'options'.");for(let w of this.inputNames)if(typeof a[w]>"u")throw new Error(`input '${w}' is missing in 'feeds'.`);if(c)for(let w of this.outputNames)u[w]=null;let d=await this.handler.run(a,u,p),y={};for(let w in d)if(Object.hasOwnProperty.call(d,w)){let v=d[w];v instanceof Ae?y[w]=v:y[w]=new Ae(v.type,v.data,v.dims)}return Ge("InferenceSession.run"),Je(),y}async release(){return this.handler.dispose()}static async create(a,l,i,u){Ye(),We("InferenceSession.create");let p,c={};if(typeof a=="string"){if(p=a,typeof l=="object"&&l!==null)c=l;else if(typeof l<"u")throw new TypeError("'options' must be an object.")}else if(a instanceof Uint8Array){if(p=a,typeof l=="object"&&l!==null)c=l;else if(typeof l<"u")throw new TypeError("'options' must be an object.")}else if(a instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&a instanceof SharedArrayBuffer){let v=a,C=0,_=a.byteLength;if(typeof l=="object"&&l!==null)c=l;else if(typeof l=="number"){if(C=l,!Number.isSafeInteger(C))throw new RangeError("'byteOffset' must be an integer.");if(C<0||C>=v.byteLength)throw new RangeError(`'byteOffset' is out of range [0, ${v.byteLength}).`);if(_=a.byteLength-C,typeof i=="number"){if(_=i,!Number.isSafeInteger(_))throw new RangeError("'byteLength' must be an integer.");if(_<=0||C+_>v.byteLength)throw new RangeError(`'byteLength' is out of range (0, ${v.byteLength-C}].`);if(typeof u=="object"&&u!==null)c=u;else if(typeof u<"u")throw new TypeError("'options' must be an object.")}else if(typeof i<"u")throw new TypeError("'byteLength' must be a number.")}else if(typeof l<"u")throw new TypeError("'options' must be an object.");p=new Uint8Array(v,C,_)}else throw new TypeError("Unexpected argument[0]: must be 'path' or 'buffer'.");let[d,y]=await Tn(c),w=await d.createInferenceSessionHandler(p,y);return Ge("InferenceSession.create"),Je(),new co(w)}startProfiling(){this.handler.startProfiling()}endProfiling(){this.handler.endProfiling()}get inputNames(){return this.handler.inputNames}get outputNames(){return this.handler.outputNames}get inputMetadata(){return this.handler.inputMetadata}get outputMetadata(){return this.handler.outputMetadata}}}),Pt,xo=k(()=>{Ao(),Pt=kn}),Oo=k(()=>{}),Io=k(()=>{}),So=k(()=>{}),Bo=k(()=>{}),Nn={};yt(Nn,{InferenceSession:()=>Pt,TRACE:()=>Ut,TRACE_EVENT_BEGIN:()=>We,TRACE_EVENT_END:()=>Ge,TRACE_FUNC_BEGIN:()=>Ye,TRACE_FUNC_END:()=>Je,Tensor:()=>Ae,env:()=>Z,registerBackend:()=>Ze});var Qe=k(()=>{wo(),vo(),xo(),jn(),Oo(),Io(),$n(),So(),Bo()}),sr=k(()=>{}),Dn={};yt(Dn,{default:()=>Wn});var lr,ur,Wn,Mo=k(()=>{Ai(),Ke(),mr(),lr="ort-wasm-proxy-worker",ur=globalThis.self?.name===lr,ur&&(self.onmessage=n=>{let{type:a,in:l}=n.data;try{switch(a){case"init-wasm":br(l.wasm).then(()=>{Rr(l).then(()=>{postMessage({type:a})},i=>{postMessage({type:a,err:i})})},i=>{postMessage({type:a,err:i})});break;case"init-ep":{let{epName:i,env:u}=l;Ur(u,i).then(()=>{postMessage({type:a})},p=>{postMessage({type:a,err:p})});break}case"copy-from":{let{buffer:i}=l,u=Gt(i);postMessage({type:a,out:u});break}case"create":{let{model:i,options:u}=l;Lr(i,u).then(p=>{postMessage({type:a,out:p})},p=>{postMessage({type:a,err:p})});break}case"release":jr(l),postMessage({type:a});break;case"run":{let{sessionId:i,inputIndices:u,inputs:p,outputIndices:c,options:d}=l;kr(i,u,p,c,new Array(c.length).fill(null),d).then(y=>{y.some(w=>w[3]!=="cpu")?postMessage({type:a,err:"Proxy does not support non-cpu tensor location."}):postMessage({type:a,out:y},Dr([...p,...y]))},y=>{postMessage({type:a,err:y})});break}case"end-profiling":Nr(l),postMessage({type:a});break;default:}}catch(i){postMessage({type:a,err:i})}}),Wn=ur?null:n=>new Worker(n??pe,{type:"module",name:lr})}),Gn={};yt(Gn,{default:()=>Fn});var fr,Fn,Vn,Ro=k(()=>{fr=async function(n={}){var a,l,i=n,u=new Promise((e,t)=>{a=e,l=t}),p=typeof window=="object",c=typeof WorkerGlobalScope<"u",d=c&&self.name?.startsWith("em-pthread");i.mountExternalData=(e,t)=>{e.startsWith("./")&&(e=e.substring(2)),(i.fc||(i.fc=new Map)).set(e,t)},i.unmountExternalData=()=>{delete i.fc};var y=globalThis.SharedArrayBuffer??new WebAssembly.Memory({initial:0,maximum:0,ld:!0}).buffer.constructor;let w=()=>{let e=(t,r,o)=>(...s)=>{let f=Be,h=r?.();s=t(...s);let m=r?.();return h!==m&&(t=m,o(h),r=o=null),Be!=f?new Promise((b,T)=>{nn={resolve:b,reject:T}}):s};(()=>{for(let t of["_OrtAppendExecutionProvider","_OrtCreateSession","_OrtRun","_OrtRunWithBinding","_OrtBindInput"])i[t]=e(i[t],()=>i[t],r=>i[t]=r)})(),typeof jsepRunAsync<"u"&&(i._OrtRun=jsepRunAsync(i._OrtRun),i._OrtRunWithBinding=jsepRunAsync(i._OrtRunWithBinding)),w=void 0};i.asyncInit=()=>{w?.()};var v,C,_=(e,t)=>{throw t},O=self.location.href,R="";if(p||c){try{R=new URL(".",O).href}catch{}c&&(C=e=>{var t=new XMLHttpRequest;return t.open("GET",e,!1),t.responseType="arraybuffer",t.send(null),new Uint8Array(t.response)}),v=async e=>{if(K(e))return new Promise((r,o)=>{var s=new XMLHttpRequest;s.open("GET",e,!0),s.responseType="arraybuffer",s.onload=()=>{s.status==200||s.status==0&&s.response?r(s.response):o(s.status)},s.onerror=o,s.send(null)});var t=await fetch(e,{credentials:"same-origin"});if(t.ok)return t.arrayBuffer();throw Error(t.status+" : "+t.url)}}var j,L,U,B,D,P,F,ie,se,ee,te,ae,X,we,_t,$=console.log.bind(console),be=console.error.bind(console),ut=$,N=be,oe=!1,K=e=>e.startsWith("file://");function re(){return L.buffer!=D.buffer&&W(),D}function Y(){return L.buffer!=D.buffer&&W(),P}function xe(){return L.buffer!=D.buffer&&W(),F}function ft(){return L.buffer!=D.buffer&&W(),ie}function I(){return L.buffer!=D.buffer&&W(),se}function A(){return L.buffer!=D.buffer&&W(),ee}function ve(){return L.buffer!=D.buffer&&W(),te}function ye(){return L.buffer!=D.buffer&&W(),we}if(d){let e=function(t){try{var r=t.data,o=r.dc;if(o==="load"){let s=[];self.onmessage=f=>s.push(f),self.startWorker=()=>{postMessage({dc:"loaded"});for(let f of s)e(f);self.onmessage=e};for(let f of r.Uc)i[f]&&!i[f].proxy||(i[f]=(...h)=>{postMessage({dc:"callHandler",Tc:f,args:h})},f=="print"&&(ut=i[f]),f=="printErr"&&(N=i[f]));L=r.bd,W(),_t(r.cd)}else if(o==="run"){Vo(r.ac),gn(r.ac,0,0,1,0,0),Hi(),tn(r.ac),J||(Da(),J=!0);try{zo(r.Zc,r.jc)}catch(s){if(s!="unwind")throw s}}else r.target!=="setimmediate"&&(o==="checkMailbox"?J&&zt():o&&(N(`worker: received unknown command ${o}`),N(r)))}catch(s){throw eo(),s}};var J=!1;self.onunhandledrejection=t=>{throw t.reason||t},self.onmessage=e}function W(){var e=L.buffer;i.HEAP8=D=new Int8Array(e),F=new Int16Array(e),i.HEAPU8=P=new Uint8Array(e),ie=new Uint16Array(e),i.HEAP32=se=new Int32Array(e),i.HEAPU32=ee=new Uint32Array(e),te=new Float32Array(e),we=new Float64Array(e),ae=new BigInt64Array(e),X=new BigUint64Array(e)}function Ce(){d?startWorker(i):g.nb()}var nt,Re=0,Et=null;function Ni(){if(--Re==0&&Et){var e=Et;Et=null,e()}}function Ue(e){throw N(e="Aborted("+e+")"),oe=!0,e=new WebAssembly.RuntimeError(e+". Build with -sASSERTIONS for more info."),l(e),e}function Di(){return{a:{R:Ql,b:qo,ba:Yi,I:Ki,ra:ea,jb:ta,lb:ra,sa:na,pa:ia,ia:aa,oa,P:sa,kb:la,hb:ua,qa:fa,ib:da,xa:Zo,Z:Xo,cb:Yo,ab:Qo,Y:es,w:ts,t:rs,bb:ns,L:fs,db:ds,la:cs,fb:ps,ca:hs,_a:ys,$:ms,ka:tn,ua:gs,s:ws,Na:bs,A:Ts,o:_s,m:As,c:Qr,Ma:xs,n:Os,i:Bs,v:Ms,p:Rs,f:Us,u:Ps,k:Ls,e:js,j:$s,h:ks,g:Ns,d:Ds,fa:Ws,ga:Gs,ha:Fs,da:Ea,ea:Aa,$a:xa,za:zs,wa:qs,E:Zs,La:Xs,M:Ys,va:Hs,C:Js,ta:Qs,gb:Ks,r:Vs,Ia:el,F:tl,Q:rl,eb:nl,Ba:il,Aa:al,Ha:cl,q:pl,U:hl,T:yl,Ka:ml,D:gl,l:wl,Ga:bl,Fa:vl,Ja:Cl,Ea:Tl,Da:_l,Ca:El,ma:Ra,na:Ua,aa:Zr,J:Pa,O:La,ja,N:$a,a:L,ya:qr,Xa:xl,K:Ol,x:Il,S:Sl,Ya:Bl,y:Ml,Ta:Rl,Va:Ul,V:Pl,z:Ll,_:jl,W:$l,G:kl,Ra:Nl,mb:Dl,B:Wl,Ua:Gl,Wa:Fl,Oa:Vl,Pa:zl,Qa:Hl,H:ql,X:Zl,Sa:Xl,Za:Yl}}}class zr{name="ExitStatus";constructor(t){this.message=`Program terminated with exit(${t})`,this.status=t}}var Wi=e=>{e.terminate(),e.onmessage=()=>{}},Hr=[],Gi=e=>{ze.length==0&&(Zi(),qi(ze[0]));var t=ze.pop();if(!t)return 6;At.push(t),it[e.ac]=t,t.ac=e.ac;var r={dc:"run",Zc:e.Yc,jc:e.jc,ac:e.ac};return t.postMessage(r,e.Oc),0},Q=0,q=(e,t,...r)=>{for(var o=2*r.length,s=Ee(),f=tr(8*o),h=f>>>3,m=0;m<r.length;m++){var b=r[m];typeof b=="bigint"?(ae[h+2*m]=1n,ae[h+2*m+1]=b):(ae[h+2*m]=0n,ye()[h+2*m+1>>>0]=b)}return e=to(e,0,o,f,t),_e(s),e};function qr(e){if(d)return q(0,1,e);if(B=e,!(0<Q)){for(var t of At)Wi(t);for(t of ze)Wi(t);ze=[],At=[],it={},oe=!0}_(0,new zr(e))}function Fi(e){if(d)return q(1,0,e);Zr(e)}var Zr=e=>{if(B=e,d)throw Fi(e),"unwind";qr(e)},ze=[],At=[],Vi=[],it={},zi=e=>{var t=e.ac;delete it[t],ze.push(e),At.splice(At.indexOf(e),1),e.ac=0,ro(t)};function Hi(){Vi.forEach(e=>e())}var qi=e=>new Promise(t=>{e.onmessage=s=>{var f=(s=s.data).dc;if(s.hc&&s.hc!=cn()){var h=it[s.hc];h?h.postMessage(s,s.Oc):N(`Internal error! Worker sent a message "${f}" to target pthread ${s.hc}, but that thread no longer exists!`)}else f==="checkMailbox"?zt():f==="spawnThread"?Gi(s):f==="cleanupThread"?zi(it[s.$c]):f==="loaded"?(e.loaded=!0,t(e)):s.target==="setimmediate"?e.postMessage(s):f==="callHandler"?i[s.Tc](...s.args):f&&N(`worker sent an unknown command ${f}`)},e.onerror=s=>{throw N(`worker sent an error! ${s.filename}:${s.lineno}: ${s.message}`),s};var r,o=[];for(r of[])i.propertyIsEnumerable(r)&&o.push(r);e.postMessage({dc:"load",Uc:o,bd:L,cd:U})});function Zi(){var e=new Worker((()=>{let t=URL;return self.location.href>"file:"&&self.location.href<"file;"?new t("ort.webgpu.bundle.min.mjs",self.location.href):new URL(self.location.href)})(),{type:"module",workerData:"em-pthread",name:"em-pthread"});ze.push(e)}var Vo=e=>{W();var t=A()[e+52>>>2>>>0];e=A()[e+56>>>2>>>0],ao(t,t-e),_e(t)},zo=(e,t)=>{Q=0,e=oo(e,t),0<Q?B=e:wn(e)};class Ho{constructor(t){this.ic=t-24}}var me=e=>-9007199254740992>e||9007199254740992<e?NaN:Number(e);function qo(e,t,r){var o=new Ho(e>>>=0);throw t>>>=0,r>>>=0,A()[o.ic+16>>>2>>>0]=0,A()[o.ic+4>>>2>>>0]=t,A()[o.ic+8>>>2>>>0]=r,e}function Xi(e,t,r,o){return d?q(2,1,e,t,r,o):Yi(e,t,r,o)}function Yi(e,t,r,o){if(e>>>=0,r>>>=0,o>>>=0,y===void 0)return 6;var s=[];return d&&s.length===0?Xi(e,t>>>=0,r,o):(e={Yc:r,ac:e,jc:o,Oc:s},d?(e.dc="spawnThread",postMessage(e,s),0):Gi(e))}var Ji=typeof TextDecoder<"u"?new TextDecoder:void 0,Qi=(e,t=0,r=NaN)=>{var o=(t>>>=0)+r;for(r=t;e[r]&&!(r>=o);)++r;if(16<r-t&&e.buffer&&Ji)return Ji.decode(e.buffer instanceof ArrayBuffer?e.subarray(t,r):e.slice(t,r));for(o="";t<r;){var s=e[t++];if(128&s){var f=63&e[t++];if((224&s)==192)o+=String.fromCharCode((31&s)<<6|f);else{var h=63&e[t++];65536>(s=(240&s)==224?(15&s)<<12|f<<6|h:(7&s)<<18|f<<12|h<<6|63&e[t++])?o+=String.fromCharCode(s):(s-=65536,o+=String.fromCharCode(55296|s>>10,56320|1023&s))}}else o+=String.fromCharCode(s)}return o},dt=(e,t)=>(e>>>=0)?Qi(Y(),e,t):"";function Ki(e,t,r){return d?q(3,1,e,t,r):0}function ea(e,t){if(d)return q(4,1,e,t)}function ta(e,t){if(d)return q(5,1,e,t)}function ra(e,t,r){if(d)return q(6,1,e,t,r)}function na(e,t,r){return d?q(7,1,e,t,r):0}function ia(e,t){if(d)return q(8,1,e,t)}function aa(e,t,r){if(d)return q(9,1,e,t,r)}function oa(e,t,r,o){if(d)return q(10,1,e,t,r,o)}function sa(e,t,r,o){if(d)return q(11,1,e,t,r,o)}function la(e,t,r,o){if(d)return q(12,1,e,t,r,o)}function ua(e){if(d)return q(13,1,e)}function fa(e,t){if(d)return q(14,1,e,t)}function da(e,t,r){if(d)return q(15,1,e,t,r)}var ca,Zo=()=>Ue(""),Se=e=>{for(var t="";Y()[e>>>0];)t+=ca[Y()[e++>>>0]];return t},Xr={},Yr={},ct=i.BindingError=class extends Error{constructor(e){super(e),this.name="BindingError"}};function Pe(e,t,r={}){return(function(o,s,f={}){var h=s.name;if(!o)throw new ct(`type "${h}" must have a positive integer typeid pointer`);if(Yr.hasOwnProperty(o)){if(f.Vc)return;throw new ct(`Cannot register type '${h}' twice`)}Yr[o]=s,Xr.hasOwnProperty(o)&&(s=Xr[o],delete Xr[o],s.forEach(m=>m()))})(e,t,r)}var pa=(e,t,r)=>{switch(t){case 1:return r?o=>re()[o>>>0]:o=>Y()[o>>>0];case 2:return r?o=>xe()[o>>>1>>>0]:o=>ft()[o>>>1>>>0];case 4:return r?o=>I()[o>>>2>>>0]:o=>A()[o>>>2>>>0];case 8:return r?o=>ae[o>>>3]:o=>X[o>>>3];default:throw new TypeError(`invalid integer width (${t}): ${e}`)}};function Xo(e,t,r){r>>>=0,Pe(e>>>=0,{name:t=Se(t>>>0),fromWireType:o=>o,toWireType:function(o,s){if(typeof s!="bigint"&&typeof s!="number")throw s=s===null?"null":(o=typeof s)=="object"||o==="array"||o==="function"?s.toString():""+s,new TypeError(`Cannot convert "${s}" to ${this.name}`);return typeof s=="number"&&(s=BigInt(s)),s},cc:He,readValueFromPointer:pa(t,r,t.indexOf("u")==-1),ec:null})}var He=8;function Yo(e,t,r,o){Pe(e>>>=0,{name:t=Se(t>>>0),fromWireType:function(s){return!!s},toWireType:function(s,f){return f?r:o},cc:He,readValueFromPointer:function(s){return this.fromWireType(Y()[s>>>0])},ec:null})}var Jr=[],Le=[];function Qr(e){9<(e>>>=0)&&--Le[e+1]==0&&(Le[e]=void 0,Jr.push(e))}var ue=e=>{if(!e)throw new ct(`Cannot use deleted val. handle = ${e}`);return Le[e]},Te=e=>{switch(e){case void 0:return 2;case null:return 4;case!0:return 6;case!1:return 8;default:let t=Jr.pop()||Le.length;return Le[t]=e,Le[t+1]=1,t}};function Kr(e){return this.fromWireType(A()[e>>>2>>>0])}var Jo={name:"emscripten::val",fromWireType:e=>{var t=ue(e);return Qr(e),t},toWireType:(e,t)=>Te(t),cc:He,readValueFromPointer:Kr,ec:null};function Qo(e){return Pe(e>>>0,Jo)}var Ko=(e,t)=>{switch(t){case 4:return function(r){return this.fromWireType(ve()[r>>>2>>>0])};case 8:return function(r){return this.fromWireType(ye()[r>>>3>>>0])};default:throw new TypeError(`invalid float width (${t}): ${e}`)}};function es(e,t,r){r>>>=0,Pe(e>>>=0,{name:t=Se(t>>>0),fromWireType:o=>o,toWireType:(o,s)=>s,cc:He,readValueFromPointer:Ko(t,r),ec:null})}function ts(e,t,r,o,s){if(e>>>=0,r>>>=0,t=Se(t>>>0),s===-1&&(s=4294967295),s=m=>m,o===0){var f=32-8*r;s=m=>m<<f>>>f}var h=t.includes("unsigned")?function(m,b){return b>>>0}:function(m,b){return b};Pe(e,{name:t,fromWireType:s,toWireType:h,cc:He,readValueFromPointer:pa(t,r,o!==0),ec:null})}function rs(e,t,r){function o(f){var h=A()[f>>>2>>>0];return f=A()[f+4>>>2>>>0],new s(re().buffer,f,h)}var s=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array,BigInt64Array,BigUint64Array][t];Pe(e>>>=0,{name:r=Se(r>>>0),fromWireType:o,cc:He,readValueFromPointer:o},{Vc:!0})}var je=(e,t,r)=>{var o=Y();if(t>>>=0,0<r){var s=t;r=t+r-1;for(var f=0;f<e.length;++f){var h=e.charCodeAt(f);if(55296<=h&&57343>=h&&(h=65536+((1023&h)<<10)|1023&e.charCodeAt(++f)),127>=h){if(t>=r)break;o[t++>>>0]=h}else{if(2047>=h){if(t+1>=r)break;o[t++>>>0]=192|h>>6}else{if(65535>=h){if(t+2>=r)break;o[t++>>>0]=224|h>>12}else{if(t+3>=r)break;o[t++>>>0]=240|h>>18,o[t++>>>0]=128|h>>12&63}o[t++>>>0]=128|h>>6&63}o[t++>>>0]=128|63&h}}o[t>>>0]=0,e=t-s}else e=0;return e},$e=e=>{for(var t=0,r=0;r<e.length;++r){var o=e.charCodeAt(r);127>=o?t++:2047>=o?t+=2:55296<=o&&57343>=o?(t+=4,++r):t+=3}return t};function ns(e,t){Pe(e>>>=0,{name:t=Se(t>>>0),fromWireType:function(r){for(var o,s=A()[r>>>2>>>0],f=r+4,h=f,m=0;m<=s;++m){var b=f+m;m!=s&&Y()[b>>>0]!=0||(h=dt(h,b-h),o===void 0?o=h:(o+="\0",o+=h),h=b+1)}return Oe(r),o},toWireType:function(r,o){o instanceof ArrayBuffer&&(o=new Uint8Array(o));var s=typeof o=="string";if(!(s||ArrayBuffer.isView(o)&&o.BYTES_PER_ELEMENT==1))throw new ct("Cannot pass non-string to std::string");var f=s?$e(o):o.length,h=ht(4+f+1),m=h+4;return A()[h>>>2>>>0]=f,s?je(o,m,f+1):Y().set(o,m>>>0),r!==null&&r.push(Oe,h),h},cc:He,readValueFromPointer:Kr,ec(r){Oe(r)}})}var ha=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0,is=(e,t)=>{for(var r=e>>1,o=r+t/2;!(r>=o)&&ft()[r>>>0];)++r;if(32<(r<<=1)-e&&ha)return ha.decode(Y().slice(e,r));for(r="",o=0;!(o>=t/2);++o){var s=xe()[e+2*o>>>1>>>0];if(s==0)break;r+=String.fromCharCode(s)}return r},as=(e,t,r)=>{if(r??=2147483647,2>r)return 0;var o=t;r=(r-=2)<2*e.length?r/2:e.length;for(var s=0;s<r;++s){var f=e.charCodeAt(s);xe()[t>>>1>>>0]=f,t+=2}return xe()[t>>>1>>>0]=0,t-o},os=e=>2*e.length,ss=(e,t)=>{for(var r=0,o="";!(r>=t/4);){var s=I()[e+4*r>>>2>>>0];if(s==0)break;++r,65536<=s?(s-=65536,o+=String.fromCharCode(55296|s>>10,56320|1023&s)):o+=String.fromCharCode(s)}return o},ls=(e,t,r)=>{if(t>>>=0,r??=2147483647,4>r)return 0;var o=t;r=o+r-4;for(var s=0;s<e.length;++s){var f=e.charCodeAt(s);if(55296<=f&&57343>=f&&(f=65536+((1023&f)<<10)|1023&e.charCodeAt(++s)),I()[t>>>2>>>0]=f,(t+=4)+4>r)break}return I()[t>>>2>>>0]=0,t-o},us=e=>{for(var t=0,r=0;r<e.length;++r){var o=e.charCodeAt(r);55296<=o&&57343>=o&&++r,t+=4}return t};function fs(e,t,r){if(e>>>=0,t>>>=0,r=Se(r>>>=0),t===2)var o=is,s=as,f=os,h=m=>ft()[m>>>1>>>0];else t===4&&(o=ss,s=ls,f=us,h=m=>A()[m>>>2>>>0]);Pe(e,{name:r,fromWireType:m=>{for(var b,T=A()[m>>>2>>>0],x=m+4,E=0;E<=T;++E){var M=m+4+E*t;E!=T&&h(M)!=0||(x=o(x,M-x),b===void 0?b=x:(b+="\0",b+=x),x=M+t)}return Oe(m),b},toWireType:(m,b)=>{if(typeof b!="string")throw new ct(`Cannot pass non-string to C++ string type ${r}`);var T=f(b),x=ht(4+T+t);return A()[x>>>2>>>0]=T/t,s(b,x+4,T+t),m!==null&&m.push(Oe,x),x},cc:He,readValueFromPointer:Kr,ec(m){Oe(m)}})}function ds(e,t){Pe(e>>>=0,{Wc:!0,name:t=Se(t>>>0),cc:0,fromWireType:()=>{},toWireType:()=>{}})}function cs(e){gn(e>>>0,!c,1,!p,131072,!1),Hi()}var en=e=>{if(!oe)try{if(e(),!(0<Q))try{d?wn(B):Zr(B)}catch(t){t instanceof zr||t=="unwind"||_(0,t)}}catch(t){t instanceof zr||t=="unwind"||_(0,t)}};function tn(e){e>>>=0,typeof Atomics.ad=="function"&&(Atomics.ad(I(),e>>>2,e).value.then(zt),e+=128,Atomics.store(I(),e>>>2,1))}var zt=()=>{var e=cn();e&&(tn(e),en(io))};function ps(e,t){(e>>>=0)==t>>>0?setTimeout(zt):d?postMessage({hc:e,dc:"checkMailbox"}):(e=it[e])&&e.postMessage({dc:"checkMailbox"})}var rn=[];function hs(e,t,r,o,s){for(t>>>=0,o/=2,rn.length=o,r=s>>>0>>>3,s=0;s<o;s++)rn[s]=ae[r+2*s]?ae[r+2*s+1]:ye()[r+2*s+1>>>0];return(t?fn[t]:Jl[e])(...rn)}var ys=()=>{Q=0};function ms(e){e>>>=0,d?postMessage({dc:"cleanupThread",$c:e}):zi(it[e])}function gs(e){}var Ht=(e,t)=>{var r=Yr[e];if(r===void 0)throw e=Na(e),r=Se(e),Oe(e),new ct(`${t} has unknown type ${r}`);return r},ya=(e,t,r)=>{var o=[];return e=e.toWireType(o,r),o.length&&(A()[t>>>2>>>0]=Te(o)),e};function ws(e,t,r){return t>>>=0,r>>>=0,e=ue(e>>>0),t=Ht(t,"emval::as"),ya(t,r,e)}function bs(e,t){return t>>>=0,e=ue(e>>>0),(t=Ht(t,"emval::as")).toWireType(null,e)}var qt=e=>{try{e()}catch(t){Ue(t)}},qe=0,Be=null,ma=0,Zt=[],ga={},wa={},vs=0,nn=null,Cs=[];function ba(e){return(function(t){if(!oe){if(qe===0){var r=!1,o=!1;t((s=0)=>{if(!oe&&(ma=s,r=!0,o)){qe=2,qt(()=>uo(Be)),typeof MainLoop<"u"&&MainLoop.Sc&&MainLoop.resume(),s=!1;try{var f=(function(){var b=I()[Be+8>>>2>>>0];return b=g[wa[b]],--Q,b()})()}catch(b){f=b,s=!0}var h=!1;if(!Be){var m=nn;m&&(nn=null,(s?m.reject:m.resolve)(f),h=!0)}if(s&&!h)throw f}}),o=!0,r||(qe=1,Be=(function(){var s=ht(65548),f=s+12;A()[s>>>2>>>0]=f,A()[s+4>>>2>>>0]=f+65536,f=Zt[0];var h=ga[f];return h===void 0&&(h=vs++,ga[f]=h,wa[h]=f),f=h,I()[s+8>>>2>>>0]=f,s})(),typeof MainLoop<"u"&&MainLoop.Sc&&MainLoop.pause(),qt(()=>so(Be)))}else qe===2?(qe=0,qt(fo),Oe(Be),Be=null,Cs.forEach(en)):Ue(`invalid state: ${qe}`);return ma}})(t=>{e().then(t)})}function Ts(e){return e>>>=0,ba(async()=>{var t=await ue(e);return Te(t)})}var Xt=[];function _s(e,t,r,o){return r>>>=0,o>>>=0,(e=Xt[e>>>0])(null,t=ue(t>>>0),r,o)}var Es={},Yt=e=>{var t=Es[e];return t===void 0?Se(e):t};function As(e,t,r,o,s){return r>>>=0,o>>>=0,s>>>=0,(e=Xt[e>>>0])(t=ue(t>>>0),t[r=Yt(r)],o,s)}function xs(e,t){return t>>>=0,(e=ue(e>>>0))==ue(t)}var va=()=>typeof globalThis=="object"?globalThis:Function("return this")();function Os(e){return(e>>>=0)==0?Te(va()):(e=Yt(e),Te(va()[e]))}var Is=e=>{var t=Xt.length;return Xt.push(e),t},Ss=(e,t)=>{for(var r=Array(e),o=0;o<e;++o)r[o]=Ht(A()[t+4*o>>>2>>>0],`parameter ${o}`);return r};function Bs(e,t,r){var o=(t=Ss(e,t>>>0)).shift();e--;var s=`return function (obj, func, destructorsRef, args) {
`,f=0,h=[];r===0&&h.push("obj");for(var m=["retType"],b=[o],T=0;T<e;++T)h.push(`arg${T}`),m.push(`argType${T}`),b.push(t[T]),s+=`  var arg${T} = argType${T}.readValueFromPointer(args${f?"+"+f:""});
`,f+=t[T].cc;return s+=`  var rv = ${r===1?"new func":"func.call"}(${h.join(", ")});
`,o.Wc||(m.push("emval_returnValue"),b.push(ya),s+=`  return emval_returnValue(retType, destructorsRef, rv);
`),e=new Function(...m,s+`};
`)(...b),r=`methodCaller<(${t.map(x=>x.name).join(", ")}) => ${o.name}>`,Is(Object.defineProperty(e,"name",{value:r}))}function Ms(e){return e=Yt(e>>>0),Te(i[e])}function Rs(e,t){return t>>>=0,e=ue(e>>>0),t=ue(t),Te(e[t])}function Us(e){9<(e>>>=0)&&(Le[e+1]+=1)}function Ps(){return Te([])}function Ls(e){e=ue(e>>>0);for(var t=Array(e.length),r=0;r<e.length;r++)t[r]=e[r];return Te(t)}function js(e){return Te(Yt(e>>>0))}function $s(){return Te({})}function ks(e){for(var t=ue(e>>>=0);t.length;){var r=t.pop();t.pop()(r)}Qr(e)}function Ns(e,t,r){t>>>=0,r>>>=0,e=ue(e>>>0),t=ue(t),r=ue(r),e[t]=r}function Ds(e,t){return t>>>=0,e=(e=Ht(e>>>0,"_emval_take_value")).readValueFromPointer(t),Te(e)}function Ws(e,t){e=me(e),t>>>=0,e=new Date(1e3*e),I()[t>>>2>>>0]=e.getUTCSeconds(),I()[t+4>>>2>>>0]=e.getUTCMinutes(),I()[t+8>>>2>>>0]=e.getUTCHours(),I()[t+12>>>2>>>0]=e.getUTCDate(),I()[t+16>>>2>>>0]=e.getUTCMonth(),I()[t+20>>>2>>>0]=e.getUTCFullYear()-1900,I()[t+24>>>2>>>0]=e.getUTCDay(),e=(e.getTime()-Date.UTC(e.getUTCFullYear(),0,1,0,0,0,0))/864e5|0,I()[t+28>>>2>>>0]=e}var Ca=e=>e%4==0&&(e%100!=0||e%400==0),Ta=[0,31,60,91,121,152,182,213,244,274,305,335],_a=[0,31,59,90,120,151,181,212,243,273,304,334];function Gs(e,t){e=me(e),t>>>=0,e=new Date(1e3*e),I()[t>>>2>>>0]=e.getSeconds(),I()[t+4>>>2>>>0]=e.getMinutes(),I()[t+8>>>2>>>0]=e.getHours(),I()[t+12>>>2>>>0]=e.getDate(),I()[t+16>>>2>>>0]=e.getMonth(),I()[t+20>>>2>>>0]=e.getFullYear()-1900,I()[t+24>>>2>>>0]=e.getDay();var r=(Ca(e.getFullYear())?Ta:_a)[e.getMonth()]+e.getDate()-1|0;I()[t+28>>>2>>>0]=r,I()[t+36>>>2>>>0]=-60*e.getTimezoneOffset(),r=new Date(e.getFullYear(),6,1).getTimezoneOffset();var o=new Date(e.getFullYear(),0,1).getTimezoneOffset();e=0|(r!=o&&e.getTimezoneOffset()==Math.min(o,r)),I()[t+32>>>2>>>0]=e}function Fs(e){e>>>=0;var t=new Date(I()[e+20>>>2>>>0]+1900,I()[e+16>>>2>>>0],I()[e+12>>>2>>>0],I()[e+8>>>2>>>0],I()[e+4>>>2>>>0],I()[e>>>2>>>0],0),r=I()[e+32>>>2>>>0],o=t.getTimezoneOffset(),s=new Date(t.getFullYear(),6,1).getTimezoneOffset(),f=new Date(t.getFullYear(),0,1).getTimezoneOffset(),h=Math.min(f,s);return 0>r?I()[e+32>>>2>>>0]=+(s!=f&&h==o):0<r!=(h==o)&&(s=Math.max(f,s),t.setTime(t.getTime()+6e4*((0<r?h:s)-o))),I()[e+24>>>2>>>0]=t.getDay(),r=(Ca(t.getFullYear())?Ta:_a)[t.getMonth()]+t.getDate()-1|0,I()[e+28>>>2>>>0]=r,I()[e>>>2>>>0]=t.getSeconds(),I()[e+4>>>2>>>0]=t.getMinutes(),I()[e+8>>>2>>>0]=t.getHours(),I()[e+12>>>2>>>0]=t.getDate(),I()[e+16>>>2>>>0]=t.getMonth(),I()[e+20>>>2>>>0]=t.getYear(),e=t.getTime(),BigInt(isNaN(e)?-1:e/1e3)}function Ea(e,t,r,o,s,f,h){return d?q(16,1,e,t,r,o,s,f,h):-52}function Aa(e,t,r,o,s,f){if(d)return q(17,1,e,t,r,o,s,f)}var xt={},Vs=()=>performance.timeOrigin+performance.now();function xa(e,t){if(d)return q(18,1,e,t);if(xt[e]&&(clearTimeout(xt[e].id),delete xt[e]),!t)return 0;var r=setTimeout(()=>{delete xt[e],en(()=>no(e,performance.timeOrigin+performance.now()))},t);return xt[e]={id:r,nd:t},0}function zs(e,t,r,o){e>>>=0,t>>>=0,r>>>=0,o>>>=0;var s=new Date().getFullYear(),f=new Date(s,0,1).getTimezoneOffset();s=new Date(s,6,1).getTimezoneOffset();var h=Math.max(f,s);A()[e>>>2>>>0]=60*h,I()[t>>>2>>>0]=+(f!=s),e=(t=m=>{var b=Math.abs(m);return`UTC${0<=m?"-":"+"}${String(Math.floor(b/60)).padStart(2,"0")}${String(b%60).padStart(2,"0")}`})(f),t=t(s),s<f?(je(e,r,17),je(t,o,17)):(je(e,o,17),je(t,r,17))}var Hs=()=>Date.now();function qs(e,t,r){return 0<=e&&3>=e?(e===0?e=Date.now():e=performance.timeOrigin+performance.now(),ae[r>>>0>>>3]=BigInt(Math.round(1e6*e)),0):28}var an=[],Oa=(e,t)=>{an.length=0;for(var r;r=Y()[e++>>>0];){var o=r!=105;t+=(o&=r!=112)&&t%8?4:0,an.push(r==112?A()[t>>>2>>>0]:r==106?ae[t>>>3]:r==105?I()[t>>>2>>>0]:ye()[t>>>3>>>0]),t+=o?8:4}return an};function Zs(e,t,r){return e>>>=0,t=Oa(t>>>0,r>>>0),fn[e](...t)}function Xs(e,t,r){return e>>>=0,t=Oa(t>>>0,r>>>0),fn[e](...t)}var Ys=()=>{};function Js(e,t){return N(dt(e>>>0,t>>>0))}var Qs=()=>{throw Q+=1,"unwind"};function Ks(){return 4294901760}var el=()=>1,tl=()=>navigator.hardwareConcurrency;function rl(){return Ue("Cannot use emscripten_pc_get_function without -sUSE_OFFSET_CONVERTER"),0}function nl(e){e>>>=0;var t=Y().length;if(e<=t||4294901760<e)return!1;for(var r=1;4>=r;r*=2){var o=t*(1+.2/r);o=Math.min(o,e+100663296);e:{o=(Math.min(4294901760,65536*Math.ceil(Math.max(e,o)/65536))-L.buffer.byteLength+65535)/65536|0;try{L.grow(o),W();var s=1;break e}catch{}s=void 0}if(s)return!0}return!1}var Jt=()=>(Ue("Cannot use convertFrameToPC (needed by __builtin_return_address) without -sUSE_OFFSET_CONVERTER"),0),Ot={},Ia=e=>{e.forEach(t=>{Jt()})};function il(){var e=Error().stack.toString().split(`
`);return e[0]=="Error"&&e.shift(),Ia(e),Ot.oc=Jt(),Ot.Xc=e,Ot.oc}function al(e,t,r){if(e>>>=0,t>>>=0,Ot.oc==e)var o=Ot.Xc;else(o=Error().stack.toString().split(`
`))[0]=="Error"&&o.shift(),Ia(o);for(var s=3;o[s]&&Jt()!=e;)++s;for(e=0;e<r&&o[e+s];++e)I()[t+4*e>>>2>>>0]=Jt();return e}var ke=e=>{var t=$e(e)+1,r=tr(t);return je(e,r,t),r},on=[],fe=(e,t)=>{on[e>>>=0]=t},Me=[],Qt=[],It=(e,t)=>{Qt[e]=new Promise(r=>t.finally(()=>r(e)))},S=e=>{if(e)return on[e>>>0]},Kt=(e,t,r)=>{A()[e>>>2>>>0]=t,A()[e+4>>>2>>>0]=r},Sa=e=>{var t=A()[e>>>2>>>0];return e=A()[e+4>>>2>>>0],dt(t,e)},Ne=e=>{var t=A()[e>>>2>>>0];return e=A()[e+4>>>2>>>0],t?dt(t,e):e===0?"":void 0},Ba=(e,t)=>{function r(s,f){s=e[s],I()[t+f>>>2>>>0]=s}function o(s,f){ae[t+f>>>3]=BigInt(e[s])}r("maxTextureDimension1D",4),r("maxTextureDimension2D",8),r("maxTextureDimension3D",12),r("maxTextureArrayLayers",16),r("maxBindGroups",20),r("maxBindGroupsPlusVertexBuffers",24),r("maxBindingsPerBindGroup",28),r("maxDynamicUniformBuffersPerPipelineLayout",32),r("maxDynamicStorageBuffersPerPipelineLayout",36),r("maxSampledTexturesPerShaderStage",40),r("maxSamplersPerShaderStage",44),r("maxStorageBuffersPerShaderStage",48),r("maxStorageTexturesPerShaderStage",52),r("maxUniformBuffersPerShaderStage",56),r("minUniformBufferOffsetAlignment",80),r("minStorageBufferOffsetAlignment",84),o("maxUniformBufferBindingSize",64),o("maxStorageBufferBindingSize",72),r("maxVertexBuffers",88),o("maxBufferSize",96),r("maxVertexAttributes",104),r("maxVertexBufferArrayStride",108),r("maxInterStageShaderVariables",112),r("maxColorAttachments",116),r("maxColorAttachmentBytesPerSample",120),r("maxComputeWorkgroupStorageSize",124),r("maxComputeInvocationsPerWorkgroup",128),r("maxComputeWorkgroupSizeX",132),r("maxComputeWorkgroupSizeY",136),r("maxComputeWorkgroupSizeZ",140),r("maxComputeWorkgroupsPerDimension",144),e.kd!==void 0&&r("maxImmediateSize",148)},ol={undefined:1,pd:1,gd:2},sl={1:"validation",2:"out-of-memory",3:"internal"},ll=[,"compatibility","core"],sn={1:"depth-clip-control",2:"depth32float-stencil8",3:"timestamp-query",4:"texture-compression-bc",5:"texture-compression-bc-sliced-3d",6:"texture-compression-etc2",7:"texture-compression-astc",8:"texture-compression-astc-sliced-3d",9:"indirect-first-instance",10:"shader-f16",11:"rg11b10ufloat-renderable",12:"bgra8unorm-storage",13:"float32-filterable",14:"float32-blendable",15:"clip-distances",16:"dual-source-blending",17:"subgroups",18:"core-features-and-limits",327692:"chromium-experimental-unorm16-texture-formats",327693:"chromium-experimental-snorm16-texture-formats",327732:"chromium-experimental-multi-draw-indirect"},ul=[,"low-power","high-performance"],fl={1:"occlusion",2:"timestamp"},dl={"depth-clip-control":"1","depth32float-stencil8":"2","timestamp-query":"3","texture-compression-bc":"4","texture-compression-bc-sliced-3d":"5","texture-compression-etc2":"6","texture-compression-astc":"7","texture-compression-astc-sliced-3d":"8","indirect-first-instance":"9","shader-f16":"10","rg11b10ufloat-renderable":"11","bgra8unorm-storage":"12","float32-filterable":"13","float32-blendable":"14","clip-distances":"15","dual-source-blending":"16",md:"17","core-features-and-limits":"18","chromium-experimental-unorm16-texture-formats":"327692","chromium-experimental-snorm16-texture-formats":"327693","chromium-experimental-multi-draw-indirect":"327732"};function cl(e,t,r,o,s,f){t=me(t),r=me(r),o>>>=0,s>>>=0,f>>>=0,e=S(e>>>0);var h={};if(f){var m=A()[f+12>>>2>>>0];if(m){var b=A()[f+16>>>2>>>0];h.requiredFeatures=Array.from(A().subarray(b>>>2>>>0,b+4*m>>>2>>>0),E=>sn[E])}var T=A()[f+20>>>2>>>0];if(T){let E=function(G,z,de=!1){z=T+z,(z=A()[z>>>2>>>0])==4294967295||de&&z==0||(x[G]=z)},M=function(G,z){z=T+z;var de=A()[z>>>2>>>0],Ie=A()[z+4>>>2>>>0];de==4294967295&&Ie==4294967295||(x[G]=4294967296*A()[z+4>>>2>>>0]+A()[z>>>2>>>0])};var x={};E("maxTextureDimension1D",4),E("maxTextureDimension2D",8),E("maxTextureDimension3D",12),E("maxTextureArrayLayers",16),E("maxBindGroups",20),E("maxBindGroupsPlusVertexBuffers",24),E("maxDynamicUniformBuffersPerPipelineLayout",32),E("maxDynamicStorageBuffersPerPipelineLayout",36),E("maxSampledTexturesPerShaderStage",40),E("maxSamplersPerShaderStage",44),E("maxStorageBuffersPerShaderStage",48),E("maxStorageTexturesPerShaderStage",52),E("maxUniformBuffersPerShaderStage",56),E("minUniformBufferOffsetAlignment",80),E("minStorageBufferOffsetAlignment",84),M("maxUniformBufferBindingSize",64),M("maxStorageBufferBindingSize",72),E("maxVertexBuffers",88),M("maxBufferSize",96),E("maxVertexAttributes",104),E("maxVertexBufferArrayStride",108),E("maxInterStageShaderVariables",112),E("maxColorAttachments",116),E("maxColorAttachmentBytesPerSample",120),E("maxComputeWorkgroupStorageSize",124),E("maxComputeInvocationsPerWorkgroup",128),E("maxComputeWorkgroupSizeX",132),E("maxComputeWorkgroupSizeY",136),E("maxComputeWorkgroupSizeZ",140),E("maxComputeWorkgroupsPerDimension",144),E("maxImmediateSize",148,!0),h.requiredLimits=x}(m=A()[f+24>>>2>>>0])&&(m={label:Ne(m+4)},h.defaultQueue=m),h.label=Ne(f+4)}Q+=1,It(t,e.requestDevice(h).then(E=>{--Q,fe(s,E.queue),fe(o,E),r&&(Q+=1,It(r,E.lost.then(M=>{--Q,E.onuncapturederror=()=>{};var G=Ee(),z=ke(M.message);pn(r,ol[M.reason],z),_e(G)}))),E.onuncapturederror=M=>{var G=5;M.error instanceof GPUValidationError?G=2:M.error instanceof GPUOutOfMemoryError?G=3:M.error instanceof GPUInternalError&&(G=4);var z=Ee();M=ke(M.error.message),Ka(o,G,M),_e(z)},mn(t,1,o,0)},E=>{--Q;var M=Ee();E=ke(E.message),mn(t,3,o,E),r&&pn(r,4,E),_e(M)}))}function pl(e){var t=S(e>>>=0),r=Me[e];if(r){for(var o=0;o<r.length;++o)r[o]();delete Me[e]}t.destroy()}var pt=()=>{var e="getMappedRange size=0 no longer means WGPU_WHOLE_MAP_SIZE";pt.kc||(pt.kc={}),pt.kc[e]||(pt.kc[e]=1,N(e))};function hl(e,t,r){t>>>=0,r>>>=0;var o=S(e>>>=0);r===0&&pt(),r==4294967295&&(r=void 0);try{var s=o.getMappedRange(t,r)}catch{return 0}var f=bn(16,s.byteLength);return Y().set(new Uint8Array(s),f>>>0),Me[e].push(()=>Oe(f)),f}function yl(e,t,r){t>>>=0,r>>>=0;var o=S(e>>>=0);r===0&&pt(),r==4294967295&&(r=void 0);try{var s=o.getMappedRange(t,r)}catch{return 0}var f=bn(16,s.byteLength);return Y().fill(0,f,s.byteLength),Me[e].push(()=>{new Uint8Array(s).set(Y().subarray(f>>>0,f+s.byteLength>>>0)),Oe(f)}),f}function ml(e,t,r,o,s){e>>>=0,t=me(t),r=me(r),s>>>=0;var f=S(e);Me[e]=[],s==4294967295&&(s=void 0),Q+=1,It(t,f.mapAsync(r,o>>>0,s).then(()=>{--Q,hn(t,1,0)},h=>{--Q,Ee();var m=ke(h.message);hn(t,h.name==="AbortError"?4:h.name==="OperationError"?3:0,m),delete Me[e]}))}function gl(e){var t=S(e>>>=0),r=Me[e];if(r){for(var o=0;o<r.length;++o)r[o]();delete Me[e],t.unmap()}}function wl(e){delete on[e>>>0]}function bl(e,t,r){e>>>=0,t>>>=0,r>>>=0;var o=!!A()[t+32>>>2>>>0];t={label:Ne(t+4),usage:A()[t+16>>>2>>>0],size:4294967296*A()[t+28>>>2>>>0]+A()[t+24>>>2>>>0],mappedAtCreation:o},e=S(e);try{var s=e.createBuffer(t)}catch{return!1}return fe(r,s),o&&(Me[r]=[]),!0}function vl(e,t,r){e>>>=0,t>>>=0,r>>>=0;var o=A()[t>>>2>>>0],s=A()[o+4>>>2>>>0];t={label:Ne(t+4),code:""},s===2&&(t.code=Sa(o+8)),fe(r,S(e).createShaderModule(t))}var Cl=e=>{S(e).destroy()};function Tl(e,t){t=me(t),e=S(e>>>0),Q+=1,It(t,e.popErrorScope().then(r=>{--Q;var o=5;r?r instanceof GPUValidationError?o=2:r instanceof GPUOutOfMemoryError?o=3:r instanceof GPUInternalError&&(o=4):o=1;var s=Ee();r=r?ke(r.message):0,yn(t,1,o,r),_e(s)},r=>{--Q;var o=Ee();r=ke(r.message),yn(t,1,5,r),_e(o)}))}function _l(e,t,r,o){if(t=me(t),o>>>=0,r>>>=0){var s=A()[r+4>>>2>>>0];s={featureLevel:ll[s],powerPreference:ul[A()[r+8>>>2>>>0]],forceFallbackAdapter:!!A()[r+12>>>2>>>0]},(r=A()[r>>>2>>>0])!==0&&(A(),s.rd=!!A()[r+8>>>2>>>0])}"gpu"in navigator?(Q+=1,It(t,navigator.gpu.requestAdapter(s).then(f=>{if(--Q,f)fe(o,f),St(t,1,o,0);else{f=Ee();var h=ke("WebGPU not available on this browser (requestAdapter returned null)");St(t,3,o,h),_e(f)}},f=>{--Q;var h=Ee();f=ke(f.message),St(t,4,o,f),_e(h)}))):(r=Ee(),s=ke("WebGPU not available on this browser (navigator.gpu is not available)"),St(t,3,o,s),_e(r))}function El(e,t,r){return e>>>=0,t>>>=0,r>>>=0,ba(async()=>{var o=[];if(r){var s=I()[r>>>2>>>0];o.length=t+1,o[t]=new Promise(m=>setTimeout(m,s,0))}else o.length=t;for(var f=0;f<t;++f){var h=4294967296*A()[e+8*f+4>>>2>>>0]+A()[e+8*f>>>2>>>0];if(!(h in Qt))return h;o[f]=Qt[h]}return o=await Promise.race(o),delete Qt[o],o})}var ln,un={},Ma=()=>{if(!ln){var e,t={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:"./this.program"};for(e in un)un[e]===void 0?delete t[e]:t[e]=un[e];var r=[];for(e in t)r.push(`${e}=${t[e]}`);ln=r}return ln};function Ra(e,t){if(d)return q(19,1,e,t);e>>>=0,t>>>=0;var r,o=0,s=0;for(r of Ma()){var f=t+o;A()[e+s>>>2>>>0]=f,o+=je(r,f,1/0)+1,s+=4}return 0}function Ua(e,t){if(d)return q(20,1,e,t);e>>>=0,t>>>=0;var r=Ma();for(var o of(A()[e>>>2>>>0]=r.length,e=0,r))e+=$e(o)+1;return A()[t>>>2>>>0]=e,0}function Pa(e){return d?q(21,1,e):52}function La(e,t,r,o){return d?q(22,1,e,t,r,o):52}function ja(e,t,r,o){return d?q(23,1,e,t,r,o):70}var Al=[null,[],[]];function $a(e,t,r,o){if(d)return q(24,1,e,t,r,o);t>>>=0,r>>>=0,o>>>=0;for(var s=0,f=0;f<r;f++){var h=A()[t>>>2>>>0],m=A()[t+4>>>2>>>0];t+=8;for(var b=0;b<m;b++){var T=e,x=Y()[h+b>>>0],E=Al[T];x===0||x===10?((T===1?ut:N)(Qi(E)),E.length=0):E.push(x)}s+=m}return A()[o>>>2>>>0]=s,0}function xl(e,t){return Ba(S(e>>>0).limits,t>>>0),1}function Ol(e,t){return S(e>>>0).features.has(sn[t])}function Il(e){return BigInt(S(e>>>0).size)}function Sl(e){return BigInt(S(e>>>0).usage)}function Bl(e,t){if(e>>>=0,t>>>=0){var r=Ne(t+4);r={label:r,timestampWrites:t=(t=A()[t+12>>>2>>>0])!==0?{querySet:S(A()[t+4>>>2>>>0]),beginningOfPassWriteIndex:A()[t+8>>>2>>>0],endOfPassWriteIndex:A()[t+12>>>2>>>0]}:void 0}}return e=S(e),t=qa(0),fe(t,e.beginComputePass(r)),t}function Ml(e,t,r,o,s,f){r=me(r),s=me(s),f=me(f),S(e>>>0).copyBufferToBuffer(S(t>>>0),r,S(o>>>0),s,f)}function Rl(e){e=S(e>>>0);var t=za(0);return fe(t,e.finish()),t}function Ul(e,t,r,o,s,f){f=me(f),S(e>>>0).resolveQuerySet(S(t>>>0),r,o,S(s>>>0),f)}function Pl(e,t,r,o){S(e>>>0).dispatchWorkgroups(t,r,o)}function Ll(e){S(e>>>0).end()}function jl(e,t,r,o,s){o>>>=0,s>>>=0,e=S(e>>>0),r=S(r>>>0),o==0?e.setBindGroup(t,r):e.setBindGroup(t,r,A(),s>>>2,o)}function $l(e,t){S(e>>>0).setPipeline(S(t>>>0))}function kl(e,t,r){S(e>>>0).qd(S(t>>>0),r)}function Nl(e,t){e=S(e>>>0);var r=Va(0);return fe(r,e.getBindGroupLayout(t)),r}function Dl(e,t){e>>>=0;var r=Ne(4+(t>>>=0)),o=S(A()[t+12>>>2>>>0]),s=A()[t+16>>>2>>>0];t=A()[t+20>>>2>>>0];for(var f=[],h=0;h<s;++h){var m=f,b=m.push,T=t+40*h,x=A()[T+8>>>2>>>0],E=A()[T+32>>>2>>>0],M=A()[T+36>>>2>>>0],G=A()[T+4>>>2>>>0];x?(E=T+24,(E=A()[E>>>2>>>0]+4294967296*I()[E+4>>>2>>>0])==-1&&(E=void 0),T={binding:G,resource:{buffer:S(x),offset:4294967296*A()[T+4+16>>>2>>>0]+A()[T+16>>>2>>>0],size:E}}):T=E?{binding:G,resource:S(E)}:{binding:G,resource:S(M)},b.call(m,T)}return r={label:r,layout:o,entries:f},e=S(e),o=Fa(0),fe(o,e.createBindGroup(r)),o}function Wl(e,t){var r;return e>>>=0,(t>>>=0)&&(r={label:Ne(t+4)}),e=S(e),t=Ha(0),fe(t,e.createCommandEncoder(r)),t}function Gl(e,t){e>>>=0;var r=t>>>0;t=Ne(r+4);var o=(o=A()[r+12>>>2>>>0])?S(o):"auto";if(r+=16){var s=S(A()[r+4>>>2>>>0]),f=A()[r+16>>>2>>>0],h=A()[r+20>>>2>>>0];if(f){for(var m={},b=0;b<f;++b){var T=h+24*b;m[Sa(T+4)]=ye()[T+16>>>3>>>0]}f=m}else f=void 0;r={module:s,constants:f,entryPoint:Ne(r+8)}}else r=void 0;return t={label:t,layout:o,compute:r},e=S(e),o=Za(0),fe(o,e.createComputePipeline(t)),o}function Fl(e,t){e>>>=0,t>>>=0,t={type:fl[A()[t+12>>>2>>>0]],count:A()[t+16>>>2>>>0]},e=S(e);var r=Xa(0);return fe(r,e.createQuerySet(t)),r}function Vl(e,t){e=S(e>>>0).adapterInfo,t>>>=0,I()[t+52>>>2>>>0]=e.subgroupMinSize,I()[t+56>>>2>>>0]=e.subgroupMaxSize;var r=e.vendor+e.architecture+e.device+e.description,o=$e(r)+1,s=ht(o);return s&&je(r,s,o),r=s,o=$e(e.vendor),Kt(t+4,r,o),r+=o,o=$e(e.architecture),Kt(t+12,r,o),r+=o,o=$e(e.device),Kt(t+20,r,o),Kt(t+28,r+o,$e(e.description)),I()[t+36>>>2>>>0]=2,e=e.isFallbackAdapter?3:4,I()[t+40>>>2>>>0]=e,I()[t+44>>>2>>>0]=0,I()[t+48>>>2>>>0]=0,1}function zl(e,t){t>>>=0,e=S(e>>>0);var r=ht(4*e.features.size),o=0,s=0;e.features.forEach(f=>{(f=dl[f])!==void 0&&(I()[r+o>>>2>>>0]=f,o+=4,s++)}),A()[t+4>>>2>>>0]=r,A()[t>>>2>>>0]=s}function Hl(e,t){return Ba(S(e>>>0).limits,t>>>0),1}function ql(e,t){return S(e>>>0).features.has(sn[t])}function Zl(e,t){S(e>>>0).pushErrorScope(sl[t])}function Xl(e,t,r){t>>>=0,r>>>=0,e=S(e>>>0),t=Array.from(I().subarray(r>>>2>>>0,r+4*t>>>2>>>0),o=>S(o)),e.submit(t)}function Yl(e,t,r,o,s){r=me(r),o>>>=0,s>>>=0,e=S(e>>>0),t=S(t>>>0),o=Y().subarray(o>>>0,o+s>>>0),e.writeBuffer(t,r,o,0,s)}d||(function(){for(var e=i.numThreads-1;e--;)Zi();Hr.push(()=>{Re++,(function(t){d?t():Promise.all(ze.map(qi)).then(t)})(()=>Ni())})})();for(var ka=Array(256),er=0;256>er;++er)ka[er]=String.fromCharCode(er);ca=ka,Le.push(0,1,void 0,1,null,1,!0,1,!1,1),i.count_emval_handles=()=>Le.length/2-5-Jr.length,d||(L=new WebAssembly.Memory({initial:256,maximum:65536,shared:!0}),W()),i.wasmBinary&&(j=i.wasmBinary),i.stackSave=()=>Ee(),i.stackRestore=e=>_e(e),i.stackAlloc=e=>tr(e),i.setValue=function(e,t,r="i8"){switch(r.endsWith("*")&&(r="*"),r){case"i1":case"i8":re()[e>>>0]=t;break;case"i16":xe()[e>>>1>>>0]=t;break;case"i32":I()[e>>>2>>>0]=t;break;case"i64":ae[e>>>3]=BigInt(t);break;case"float":ve()[e>>>2>>>0]=t;break;case"double":ye()[e>>>3>>>0]=t;break;case"*":A()[e>>>2>>>0]=t;break;default:Ue(`invalid type for setValue: ${r}`)}},i.getValue=function(e,t="i8"){switch(t.endsWith("*")&&(t="*"),t){case"i1":case"i8":return re()[e>>>0];case"i16":return xe()[e>>>1>>>0];case"i32":return I()[e>>>2>>>0];case"i64":return ae[e>>>3];case"float":return ve()[e>>>2>>>0];case"double":return ye()[e>>>3>>>0];case"*":return A()[e>>>2>>>0];default:Ue(`invalid type for getValue: ${t}`)}},i.UTF8ToString=dt,i.stringToUTF8=je,i.lengthBytesUTF8=$e;var Jl=[qr,Fi,Xi,Ki,ea,ta,ra,na,ia,aa,oa,sa,la,ua,fa,da,Ea,Aa,xa,Ra,Ua,Pa,La,ja,$a],fn={1048636:(e,t,r,o,s)=>{if(i===void 0||!i.fc)return 1;if((e=dt(Number(e>>>0))).startsWith("./")&&(e=e.substring(2)),!(e=i.fc.get(e)))return 2;if(t=Number(t>>>0),r=Number(r>>>0),o=Number(o>>>0),t+r>e.byteLength)return 3;try{let f=e.subarray(t,t+r);switch(s){case 0:Y().set(f,o>>>0);break;case 1:i.Pc?i.Pc(o,f):i.jd(o,f);break;default:return 4}return 0}catch{return 4}},1049460:(e,t,r)=>{i.Rc(e,Y().subarray(t>>>0,t+r>>>0))},1049524:()=>i.ed(),1049566:e=>{i.Qc(e)},1049603:()=>typeof wasmOffsetConverter<"u"};function Ql(){return typeof wasmOffsetConverter<"u"}var g=await(async function(){function e(o,s){return g=o.exports,g=(function(){var f=g,h={};for(let[m,b]of Object.entries(f))h[m]=typeof b=="function"?(...T)=>{Zt.push(m);try{return b(...T)}finally{oe||(Zt.pop(),Be&&qe===1&&Zt.length===0&&(qe=0,Q+=1,qt(lo),typeof Fibers<"u"&&Fibers.od()))}}:b;return h})(),g=(function(){var f=g,h=b=>T=>b(T)>>>0,m=b=>()=>b()>>>0;return(f=Object.assign({},f)).ob=h(f.ob),f.Rb=m(f.Rb),f.Tb=h(f.Tb),f.Dc=(b=>(T,x)=>b(T,x)>>>0)(f.Dc),f.Gc=h(f.Gc),f.Hc=m(f.Hc),f.__cxa_get_exception_ptr=h(f.__cxa_get_exception_ptr),f})(),Vi.push(g.vc),U=s,Ni(),g}Re++;var t=Di();if(i.instantiateWasm)return new Promise(o=>{i.instantiateWasm(t,(s,f)=>{o(e(s,f))})});if(d)return new Promise(o=>{_t=s=>{var f=new WebAssembly.Instance(s,Di());o(e(f,s))}});nt??=i.locateFile?i.locateFile?i.locateFile("ort-wasm-simd-threaded.asyncify.wasm",R):R+"ort-wasm-simd-threaded.asyncify.wasm":new URL("/assets/ort-wasm-simd-threaded.asyncify-BJtBjfiH.wasm",self.location.href).href;try{var r=await(async function(o){var s=nt;if(!j&&typeof WebAssembly.instantiateStreaming=="function"&&!K(s))try{var f=fetch(s,{credentials:"same-origin"});return await WebAssembly.instantiateStreaming(f,o)}catch(h){N(`wasm streaming compile failed: ${h}`),N("falling back to ArrayBuffer instantiation")}return(async function(h,m){try{var b=await(async function(T){if(!j)try{var x=await v(T);return new Uint8Array(x)}catch{}if(T==nt&&j)T=new Uint8Array(j);else{if(!C)throw"both async and sync fetching of the wasm failed";T=C(T)}return T})(h);return await WebAssembly.instantiate(b,m)}catch(T){N(`failed to asynchronously prepare wasm: ${T}`),Ue(T)}})(s,o)})(t);return e(r.instance,r.module)}catch(o){return l(o),Promise.reject(o)}})(),Na=e=>(Na=g.ob)(e),Da=()=>(Da=g.pb)();i._OrtInit=(e,t)=>(i._OrtInit=g.qb)(e,t),i._OrtGetLastError=(e,t)=>(i._OrtGetLastError=g.rb)(e,t),i._OrtCreateSessionOptions=(e,t,r,o,s,f,h,m,b,T)=>(i._OrtCreateSessionOptions=g.sb)(e,t,r,o,s,f,h,m,b,T),i._OrtAppendExecutionProvider=(e,t,r,o,s)=>(i._OrtAppendExecutionProvider=g.tb)(e,t,r,o,s),i._OrtAddFreeDimensionOverride=(e,t,r)=>(i._OrtAddFreeDimensionOverride=g.ub)(e,t,r),i._OrtAddSessionConfigEntry=(e,t,r)=>(i._OrtAddSessionConfigEntry=g.vb)(e,t,r),i._OrtReleaseSessionOptions=e=>(i._OrtReleaseSessionOptions=g.wb)(e),i._OrtCreateSession=(e,t,r)=>(i._OrtCreateSession=g.xb)(e,t,r),i._OrtReleaseSession=e=>(i._OrtReleaseSession=g.yb)(e),i._OrtGetInputOutputCount=(e,t,r)=>(i._OrtGetInputOutputCount=g.zb)(e,t,r),i._OrtGetInputOutputMetadata=(e,t,r,o)=>(i._OrtGetInputOutputMetadata=g.Ab)(e,t,r,o),i._OrtFree=e=>(i._OrtFree=g.Bb)(e),i._OrtCreateTensor=(e,t,r,o,s,f)=>(i._OrtCreateTensor=g.Cb)(e,t,r,o,s,f),i._OrtGetTensorData=(e,t,r,o,s)=>(i._OrtGetTensorData=g.Db)(e,t,r,o,s),i._OrtReleaseTensor=e=>(i._OrtReleaseTensor=g.Eb)(e),i._OrtCreateRunOptions=(e,t,r,o)=>(i._OrtCreateRunOptions=g.Fb)(e,t,r,o),i._OrtAddRunConfigEntry=(e,t,r)=>(i._OrtAddRunConfigEntry=g.Gb)(e,t,r),i._OrtReleaseRunOptions=e=>(i._OrtReleaseRunOptions=g.Hb)(e),i._OrtCreateBinding=e=>(i._OrtCreateBinding=g.Ib)(e),i._OrtBindInput=(e,t,r)=>(i._OrtBindInput=g.Jb)(e,t,r),i._OrtBindOutput=(e,t,r,o)=>(i._OrtBindOutput=g.Kb)(e,t,r,o),i._OrtClearBoundOutputs=e=>(i._OrtClearBoundOutputs=g.Lb)(e),i._OrtReleaseBinding=e=>(i._OrtReleaseBinding=g.Mb)(e),i._OrtRunWithBinding=(e,t,r,o,s)=>(i._OrtRunWithBinding=g.Nb)(e,t,r,o,s),i._OrtRun=(e,t,r,o,s,f,h,m)=>(i._OrtRun=g.Ob)(e,t,r,o,s,f,h,m),i._OrtEndProfiling=e=>(i._OrtEndProfiling=g.Pb)(e);var dn=i._OrtGetWebGpuDevice=e=>(dn=i._OrtGetWebGpuDevice=g.Qb)(e),cn=()=>(cn=g.Rb)(),Oe=i._free=e=>(Oe=i._free=g.Sb)(e),ht=i._malloc=e=>(ht=i._malloc=g.Tb)(e),Wa=i._wgpuBufferRelease=e=>(Wa=i._wgpuBufferRelease=g.Ub)(e),Ga=i._wgpuCreateInstance=e=>(Ga=i._wgpuCreateInstance=g.Vb)(e),Fa=e=>(Fa=g.Wb)(e),Va=e=>(Va=g.Xb)(e),za=e=>(za=g.Yb)(e),Ha=e=>(Ha=g.Zb)(e),qa=e=>(qa=g._b)(e),Za=e=>(Za=g.$b)(e),Xa=e=>(Xa=g.bc)(e),Ya=(e,t)=>(Ya=g.lc)(e,t),Ja=(e,t)=>(Ja=g.mc)(e,t),Qa=e=>(Qa=g.nc)(e),pn=(e,t,r)=>(pn=g.pc)(e,t,r),hn=(e,t,r)=>(hn=g.qc)(e,t,r),yn=(e,t,r,o)=>(yn=g.rc)(e,t,r,o),St=(e,t,r,o)=>(St=g.sc)(e,t,r,o),mn=(e,t,r,o)=>(mn=g.tc)(e,t,r,o),Ka=(e,t,r)=>(Ka=g.uc)(e,t,r),gn=(e,t,r,o,s,f)=>(gn=g.wc)(e,t,r,o,s,f),eo=()=>(eo=g.xc)(),to=(e,t,r,o,s)=>(to=g.yc)(e,t,r,o,s),ro=e=>(ro=g.zc)(e),wn=e=>(wn=g.Ac)(e),no=(e,t)=>(no=g.Bc)(e,t),io=()=>(io=g.Cc)(),bn=(e,t)=>(bn=g.Dc)(e,t),ao=(e,t)=>(ao=g.Ec)(e,t),_e=e=>(_e=g.Fc)(e),tr=e=>(tr=g.Gc)(e),Ee=()=>(Ee=g.Hc)(),oo=i.dynCall_ii=(e,t)=>(oo=i.dynCall_ii=g.Ic)(e,t);i.dynCall_viiii=(e,t,r,o,s)=>(i.dynCall_viiii=g.dynCall_viiii)(e,t,r,o,s),i.dynCall_viiiii=(e,t,r,o,s,f)=>(i.dynCall_viiiii=g.dynCall_viiiii)(e,t,r,o,s,f),i.dynCall_viii=(e,t,r,o)=>(i.dynCall_viii=g.Jc)(e,t,r,o),i.dynCall_vi=(e,t)=>(i.dynCall_vi=g.dynCall_vi)(e,t),i.dynCall_viijj=(e,t,r,o,s)=>(i.dynCall_viijj=g.dynCall_viijj)(e,t,r,o,s),i.dynCall_viiiiii=(e,t,r,o,s,f,h)=>(i.dynCall_viiiiii=g.dynCall_viiiiii)(e,t,r,o,s,f,h),i.dynCall_viiiiiiii=(e,t,r,o,s,f,h,m,b)=>(i.dynCall_viiiiiiii=g.dynCall_viiiiiiii)(e,t,r,o,s,f,h,m,b),i.dynCall_i=e=>(i.dynCall_i=g.dynCall_i)(e),i.dynCall_vii=(e,t,r)=>(i.dynCall_vii=g.dynCall_vii)(e,t,r),i.dynCall_fffffff=(e,t,r,o,s,f,h)=>(i.dynCall_fffffff=g.dynCall_fffffff)(e,t,r,o,s,f,h),i.dynCall_iiiii=(e,t,r,o,s)=>(i.dynCall_iiiii=g.dynCall_iiiii)(e,t,r,o,s),i.dynCall_iii=(e,t,r)=>(i.dynCall_iii=g.dynCall_iii)(e,t,r),i.dynCall_iiiiii=(e,t,r,o,s,f)=>(i.dynCall_iiiiii=g.dynCall_iiiiii)(e,t,r,o,s,f),i.dynCall_iiiiiiii=(e,t,r,o,s,f,h,m)=>(i.dynCall_iiiiiiii=g.dynCall_iiiiiiii)(e,t,r,o,s,f,h,m),i.dynCall_iiiiiii=(e,t,r,o,s,f,h)=>(i.dynCall_iiiiiii=g.dynCall_iiiiiii)(e,t,r,o,s,f,h),i.dynCall_iiii=(e,t,r,o)=>(i.dynCall_iiii=g.dynCall_iiii)(e,t,r,o),i.dynCall_vfiii=(e,t,r,o,s)=>(i.dynCall_vfiii=g.dynCall_vfiii)(e,t,r,o,s),i.dynCall_viiiiff=(e,t,r,o,s,f,h)=>(i.dynCall_viiiiff=g.dynCall_viiiiff)(e,t,r,o,s,f,h),i.dynCall_viiiiiff=(e,t,r,o,s,f,h,m)=>(i.dynCall_viiiiiff=g.dynCall_viiiiiff)(e,t,r,o,s,f,h,m),i.dynCall_ffff=(e,t,r,o)=>(i.dynCall_ffff=g.dynCall_ffff)(e,t,r,o),i.dynCall_viiff=(e,t,r,o,s)=>(i.dynCall_viiff=g.dynCall_viiff)(e,t,r,o,s),i.dynCall_jjjjjjj=(e,t,r,o,s,f,h)=>(i.dynCall_jjjjjjj=g.dynCall_jjjjjjj)(e,t,r,o,s,f,h),i.dynCall_jjjjjj=(e,t,r,o,s,f)=>(i.dynCall_jjjjjj=g.dynCall_jjjjjj)(e,t,r,o,s,f),i.dynCall_iijjii=(e,t,r,o,s,f)=>(i.dynCall_iijjii=g.dynCall_iijjii)(e,t,r,o,s,f),i.dynCall_viiiiiiiiiiiii=(e,t,r,o,s,f,h,m,b,T,x,E,M,G)=>(i.dynCall_viiiiiiiiiiiii=g.dynCall_viiiiiiiiiiiii)(e,t,r,o,s,f,h,m,b,T,x,E,M,G),i.dynCall_viiiiiiiiii=(e,t,r,o,s,f,h,m,b,T,x)=>(i.dynCall_viiiiiiiiii=g.dynCall_viiiiiiiiii)(e,t,r,o,s,f,h,m,b,T,x),i.dynCall_viiiiiiiiiii=(e,t,r,o,s,f,h,m,b,T,x,E)=>(i.dynCall_viiiiiiiiiii=g.dynCall_viiiiiiiiiii)(e,t,r,o,s,f,h,m,b,T,x,E),i.dynCall_viiiiiiiiiiii=(e,t,r,o,s,f,h,m,b,T,x,E,M)=>(i.dynCall_viiiiiiiiiiii=g.dynCall_viiiiiiiiiiii)(e,t,r,o,s,f,h,m,b,T,x,E,M),i.dynCall_viiiiiiiiiiiiiiiiii=(e,t,r,o,s,f,h,m,b,T,x,E,M,G,z,de,Ie,at,Bt)=>(i.dynCall_viiiiiiiiiiiiiiiiii=g.dynCall_viiiiiiiiiiiiiiiiii)(e,t,r,o,s,f,h,m,b,T,x,E,M,G,z,de,Ie,at,Bt),i.dynCall_viiiiiiiii=(e,t,r,o,s,f,h,m,b,T)=>(i.dynCall_viiiiiiiii=g.dynCall_viiiiiiiii)(e,t,r,o,s,f,h,m,b,T),i.dynCall_viiiiiiiiiiiiiiiiiii=(e,t,r,o,s,f,h,m,b,T,x,E,M,G,z,de,Ie,at,Bt,vn)=>(i.dynCall_viiiiiiiiiiiiiiiiiii=g.dynCall_viiiiiiiiiiiiiiiiiii)(e,t,r,o,s,f,h,m,b,T,x,E,M,G,z,de,Ie,at,Bt,vn),i.dynCall_viiiiiii=(e,t,r,o,s,f,h,m)=>(i.dynCall_viiiiiii=g.dynCall_viiiiiii)(e,t,r,o,s,f,h,m),i.dynCall_viiiiiiiiiiiiiii=(e,t,r,o,s,f,h,m,b,T,x,E,M,G,z,de)=>(i.dynCall_viiiiiiiiiiiiiii=g.dynCall_viiiiiiiiiiiiiii)(e,t,r,o,s,f,h,m,b,T,x,E,M,G,z,de),i.dynCall_jiji=(e,t,r,o)=>(i.dynCall_jiji=g.dynCall_jiji)(e,t,r,o),i.dynCall_v=e=>(i.dynCall_v=g.dynCall_v)(e),i.dynCall_iidiiii=(e,t,r,o,s,f,h)=>(i.dynCall_iidiiii=g.dynCall_iidiiii)(e,t,r,o,s,f,h),i.dynCall_ji=(e,t)=>(i.dynCall_ji=g.dynCall_ji)(e,t),i.dynCall_vij=(e,t,r)=>(i.dynCall_vij=g.dynCall_vij)(e,t,r),i.dynCall_viiijii=(e,t,r,o,s,f,h)=>(i.dynCall_viiijii=g.dynCall_viiijii)(e,t,r,o,s,f,h),i.dynCall_viijiiiiiiiiiiiiii=(e,t,r,o,s,f,h,m,b,T,x,E,M,G,z,de,Ie,at)=>(i.dynCall_viijiiiiiiiiiiiiii=g.dynCall_viijiiiiiiiiiiiiii)(e,t,r,o,s,f,h,m,b,T,x,E,M,G,z,de,Ie,at),i.dynCall_viiiji=(e,t,r,o,s,f)=>(i.dynCall_viiiji=g.dynCall_viiiji)(e,t,r,o,s,f),i.dynCall_jfi=(e,t,r)=>(i.dynCall_jfi=g.dynCall_jfi)(e,t,r),i.dynCall_fif=(e,t,r)=>(i.dynCall_fif=g.dynCall_fif)(e,t,r),i.dynCall_jii=(e,t,r)=>(i.dynCall_jii=g.dynCall_jii)(e,t,r),i.dynCall_viiiijii=(e,t,r,o,s,f,h,m)=>(i.dynCall_viiiijii=g.dynCall_viiiijii)(e,t,r,o,s,f,h,m),i.dynCall_iij=(e,t,r)=>(i.dynCall_iij=g.dynCall_iij)(e,t,r),i.dynCall_viji=(e,t,r,o)=>(i.dynCall_viji=g.dynCall_viji)(e,t,r,o),i.dynCall_iiiiiiiii=(e,t,r,o,s,f,h,m,b)=>(i.dynCall_iiiiiiiii=g.dynCall_iiiiiiiii)(e,t,r,o,s,f,h,m,b),i.dynCall_iiij=(e,t,r,o)=>(i.dynCall_iiij=g.dynCall_iiij)(e,t,r,o),i.dynCall_iiiiiiiiii=(e,t,r,o,s,f,h,m,b,T)=>(i.dynCall_iiiiiiiiii=g.dynCall_iiiiiiiiii)(e,t,r,o,s,f,h,m,b,T),i.dynCall_iiiiiiiiiiiii=(e,t,r,o,s,f,h,m,b,T,x,E,M)=>(i.dynCall_iiiiiiiiiiiii=g.dynCall_iiiiiiiiiiiii)(e,t,r,o,s,f,h,m,b,T,x,E,M),i.dynCall_iiiiiiiiiii=(e,t,r,o,s,f,h,m,b,T,x)=>(i.dynCall_iiiiiiiiiii=g.dynCall_iiiiiiiiiii)(e,t,r,o,s,f,h,m,b,T,x),i.dynCall_iijii=(e,t,r,o,s)=>(i.dynCall_iijii=g.dynCall_iijii)(e,t,r,o,s),i.dynCall_fiii=(e,t,r,o)=>(i.dynCall_fiii=g.dynCall_fiii)(e,t,r,o),i.dynCall_viijii=(e,t,r,o,s,f)=>(i.dynCall_viijii=g.dynCall_viijii)(e,t,r,o,s,f),i.dynCall_viij=(e,t,r,o)=>(i.dynCall_viij=g.dynCall_viij)(e,t,r,o),i.dynCall_jiij=(e,t,r,o)=>(i.dynCall_jiij=g.dynCall_jiij)(e,t,r,o),i.dynCall_fi=(e,t)=>(i.dynCall_fi=g.dynCall_fi)(e,t),i.dynCall_fii=(e,t,r)=>(i.dynCall_fii=g.dynCall_fii)(e,t,r),i.dynCall_dii=(e,t,r)=>(i.dynCall_dii=g.dynCall_dii)(e,t,r),i.dynCall_fiiii=(e,t,r,o,s)=>(i.dynCall_fiiii=g.dynCall_fiiii)(e,t,r,o,s),i.dynCall_viiiiiiiiiiiiii=(e,t,r,o,s,f,h,m,b,T,x,E,M,G,z)=>(i.dynCall_viiiiiiiiiiiiii=g.dynCall_viiiiiiiiiiiiii)(e,t,r,o,s,f,h,m,b,T,x,E,M,G,z),i.dynCall_viiiiiiiiiiiiiiiiiiii=(e,t,r,o,s,f,h,m,b,T,x,E,M,G,z,de,Ie,at,Bt,vn,Kl)=>(i.dynCall_viiiiiiiiiiiiiiiiiiii=g.dynCall_viiiiiiiiiiiiiiiiiiii)(e,t,r,o,s,f,h,m,b,T,x,E,M,G,z,de,Ie,at,Bt,vn,Kl),i.dynCall_viiiiiiiiiiiiiiii=(e,t,r,o,s,f,h,m,b,T,x,E,M,G,z,de,Ie)=>(i.dynCall_viiiiiiiiiiiiiiii=g.dynCall_viiiiiiiiiiiiiiii)(e,t,r,o,s,f,h,m,b,T,x,E,M,G,z,de,Ie),i.dynCall_iif=(e,t,r)=>(i.dynCall_iif=g.dynCall_iif)(e,t,r),i.dynCall_jiiii=(e,t,r,o,s)=>(i.dynCall_jiiii=g.dynCall_jiiii)(e,t,r,o,s),i.dynCall_jiii=(e,t,r,o)=>(i.dynCall_jiii=g.dynCall_jiii)(e,t,r,o),i.dynCall_viif=(e,t,r,o)=>(i.dynCall_viif=g.dynCall_viif)(e,t,r,o),i.dynCall_viiij=(e,t,r,o,s)=>(i.dynCall_viiij=g.dynCall_viiij)(e,t,r,o,s),i.dynCall_iiiiij=(e,t,r,o,s,f)=>(i.dynCall_iiiiij=g.dynCall_iiiiij)(e,t,r,o,s,f),i.dynCall_iiiiid=(e,t,r,o,s,f)=>(i.dynCall_iiiiid=g.dynCall_iiiiid)(e,t,r,o,s,f),i.dynCall_iiiiijj=(e,t,r,o,s,f,h)=>(i.dynCall_iiiiijj=g.dynCall_iiiiijj)(e,t,r,o,s,f,h),i.dynCall_iiiiiijj=(e,t,r,o,s,f,h,m)=>(i.dynCall_iiiiiijj=g.dynCall_iiiiiijj)(e,t,r,o,s,f,h,m);var so=e=>(so=g.Kc)(e),lo=()=>(lo=g.Lc)(),uo=e=>(uo=g.Mc)(e),fo=()=>(fo=g.Nc)();return(function e(){if(0<Re)Et=e;else if(d)a(i),Ce();else{for(;0<Hr.length;)Hr.shift()(i);0<Re?Et=e:(i.calledRun=!0,oe||(Ce(),a(i)))}})(),i.PTR_SIZE=4,i.webgpuInit=e=>{let t=new WeakMap,r,o,s=1;i.webgpuRegisterDevice=m=>{if(o!==void 0)throw Error("another WebGPU EP inference session is being created.");if(m){var b=t.get(m);if(!b){let T=((x,E=0)=>{var M=Qa(E);return E=Ja(E,M),fe(M,x.queue),fe(E,x),E})(m,b=Ga(0));b=[s++,b,T],t.set(m,b)}return r=m,o=b[0],b}r=void 0,o=0};let f=new Map;i.webgpuOnCreateSession=m=>{if(o!==void 0){var b=o;if(o=void 0,m){let T=dn(b);f.set(m,T),b===0&&e(r??S(T))}r=void 0}},i.webgpuOnReleaseSession=m=>{f.delete(m)};let h=Symbol("gpuBufferMetadata");i.webgpuRegisterBuffer=(m,b,T)=>{if(T)return m[h]=[T,NaN],T;if(T=m[h])return T[1]++,T[0];if((b=f.get(b))===void 0)throw Error("Invalid session handle passed to webgpuRegisterBuffer");return b=((x,E=0)=>(x.mapState!="pending"||Ue(),E=Ya(E,x.mapState=="mapped"?3:1),fe(E,x),x.mapState=="mapped"&&(Me[E]=[]),E))(m,b),m[h]=[b,1],b},i.webgpuUnregisterBuffer=m=>{let b=m[h];if(!b)throw Error("Buffer is not registered");b[1]--,b[1]===0&&(Wa(b[0]),delete m[h])},i.webgpuGetBuffer=m=>S(m),i.webgpuCreateDownloader=(m,b,T)=>{if((T=f.get(T))===void 0)throw Error("Invalid session handle passed to webgpuRegisterBuffer");let x=S(T),E=16*Math.ceil(Number(b)/16);return async()=>{let M=x.createBuffer({size:E,usage:9});try{let G=x.createCommandEncoder();return G.copyBufferToBuffer(m,0,M,0,E),x.queue.submit([G.finish()]),await M.mapAsync(GPUMapMode.READ),M.getMappedRange().slice(0,b)}finally{M.destroy()}}},i.Pc=(m,b)=>{var T=b.buffer;let x=b.byteOffset,E=b.byteLength;if(b=16*Math.ceil(Number(E)/16),m=S(m),!r){var M=dn(o);r=S(M)}let G=(M=r.createBuffer({mappedAtCreation:!0,size:b,usage:6})).getMappedRange();new Uint8Array(G).set(new Uint8Array(T,x,E)),M.unmap(),(T=r.createCommandEncoder()).copyBufferToBuffer(M,0,m,0,b),r.queue.submit([T.finish()]),M.destroy()}},i.webnnInit=e=>{let t=e[0];[i.ed,i.Qc,i.webnnEnsureTensor,i.Rc,i.webnnDownloadTensor,i.dd,i.webnnEnableTraceEvent]=e.slice(1),i.webnnReleaseTensorId=i.Qc,i.webnnUploadTensor=i.Rc,i.webnnRegisterMLContext=i.dd,i.webnnOnRunStart=r=>t.onRunStart(r),i.webnnOnRunEnd=t.onRunEnd.bind(t),i.webnnOnReleaseSession=r=>{t.onReleaseSession(r)},i.webnnCreateMLTensorDownloader=(r,o)=>t.createMLTensorDownloader(r,o),i.webnnRegisterMLTensor=(r,o,s,f)=>t.registerMLTensor(r,o,s,f),i.webnnCreateMLContext=r=>t.createMLContext(r),i.webnnRegisterMLConstant=(r,o,s,f,h,m)=>t.registerMLConstant(r,o,s,f,h,i.fc,m),i.webnnRegisterGraphInput=t.registerGraphInput.bind(t),i.webnnIsGraphInput=t.isGraphInput.bind(t),i.webnnRegisterGraphOutput=t.registerGraphOutput.bind(t),i.webnnIsGraphOutput=t.isGraphOutput.bind(t),i.webnnCreateTemporaryTensor=t.createTemporaryTensor.bind(t),i.webnnIsGraphInputOutputTypeSupported=t.isGraphInputOutputTypeSupported.bind(t)},u},Fn=fr,Vn=globalThis.self?.name?.startsWith("em-pthread"),Vn&&fr()}),dr,cr,zn,pe,Hn,Lt,qn,Zn,pr,Xn,hr,Yn,yr,Jn,mr=k(()=>{sr(),dr=typeof location>"u"?void 0:location.origin,cr=self.location.href>"file:"&&self.location.href<"file;",zn=()=>{{if(cr){let n=URL;return new URL(new n("ort.webgpu.bundle.min.mjs",self.location.href).href,dr).href}return self.location.href}},pe=zn(),Hn=()=>{if(pe&&!pe.startsWith("blob:"))return pe.substring(0,pe.lastIndexOf("/")+1)},Lt=(n,a)=>{try{let l=a??pe;return(l?new URL(n,l):new URL(n)).origin===dr}catch{return!1}},qn=(n,a)=>{let l=a??pe;try{return(l?new URL(n,l):new URL(n)).href}catch{return}},Zn=(n,a)=>`${a??"./"}${n}`,pr=async n=>{let a=await(await fetch(n,{credentials:"same-origin"})).blob();return URL.createObjectURL(a)},Xn=async n=>(await import(n)).default,hr=(Mo(),Mt(Dn)).default,Yn=async()=>{if(!pe)throw new Error("Failed to load proxy worker: cannot determine the script source URL.");if(Lt(pe))return[void 0,hr()];let n=await pr(pe);return[n,hr(n)]},yr=(Ro(),Mt(Gn)).default,Jn=async(n,a,l,i)=>{let u=yr&&!(n||a);if(u)if(pe)u=Lt(pe);else if(i&&!l)u=!0;else throw new Error("cannot determine the script source URL.");if(u)return[void 0,yr];{let p="ort-wasm-simd-threaded.asyncify.mjs",c=n??qn(p,a),d=l&&c&&!Lt(c,a),y=d?await pr(c):c??Zn(p,a);return[d?y:void 0,await Xn(y)]}}}),gr,jt,wt,wr,Qn,Kn,ei,br,H,Ke=k(()=>{mr(),jt=!1,wt=!1,wr=!1,Qn=()=>{if(typeof SharedArrayBuffer>"u")return!1;try{return typeof MessageChannel<"u"&&new MessageChannel().port1.postMessage(new SharedArrayBuffer(1)),WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,5,4,1,3,1,1,10,11,1,9,0,65,0,254,16,2,0,26,11]))}catch{return!1}},Kn=()=>{try{return WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,30,1,28,0,65,0,253,15,253,12,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,253,186,1,26,11]))}catch{return!1}},ei=()=>{try{return WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,19,1,17,0,65,1,253,15,65,2,253,15,65,3,253,15,253,147,2,11]))}catch{return!1}},br=async n=>{if(jt)return Promise.resolve();if(wt)throw new Error("multiple calls to 'initializeWebAssembly()' detected.");if(wr)throw new Error("previous call to 'initializeWebAssembly()' failed.");wt=!0;let a=n.initTimeout,l=n.numThreads;if(n.simd!==!1){if(n.simd==="relaxed"){if(!ei())throw new Error("Relaxed WebAssembly SIMD is not supported in the current environment.")}else if(!Kn())throw new Error("WebAssembly SIMD is not supported in the current environment.")}let i=Qn();l>1&&!i&&(typeof self<"u"&&!self.crossOriginIsolated&&console.warn("env.wasm.numThreads is set to "+l+", but this will not work unless you enable crossOriginIsolated mode. See https://web.dev/cross-origin-isolation-guide/ for more info."),console.warn("WebAssembly multi-threading is not supported in the current environment. Falling back to single-threading."),n.numThreads=l=1);let u=n.wasmPaths,p=typeof u=="string"?u:void 0,c=u?.mjs,d=c?.href??c,y=u?.wasm,w=y?.href??y,v=n.wasmBinary,[C,_]=await Jn(d,p,l>1,!!v||!!w),O=!1,R=[];if(a>0&&R.push(new Promise(j=>{setTimeout(()=>{O=!0,j()},a)})),R.push(new Promise((j,L)=>{let U={numThreads:l};if(v)U.wasmBinary=v;else if(w||p)U.locateFile=B=>w??p+B;else if(d&&d.indexOf("blob:")!==0)U.locateFile=B=>new URL(B,d).href;else if(C){let B=Hn();B&&(U.locateFile=D=>B+D)}_(U).then(B=>{wt=!1,jt=!0,gr=B,j(),C&&URL.revokeObjectURL(C)},B=>{wt=!1,wr=!0,L(B)})})),await Promise.race(R),O)throw new Error(`WebAssembly backend initializing failed due to timeout: ${a}ms`)},H=()=>{if(jt&&gr)return gr;throw new Error("WebAssembly is not initialized yet.")}}),he,$t,V,vr=k(()=>{Ke(),he=(n,a)=>{let l=H(),i=l.lengthBytesUTF8(n)+1,u=l._malloc(i);return l.stringToUTF8(n,u,i),a.push(u),u},$t=(n,a,l,i)=>{if(typeof n=="object"&&n!==null){if(l.has(n))throw new Error("Circular reference in options");l.add(n)}Object.entries(n).forEach(([u,p])=>{let c=a?a+u:u;if(typeof p=="object")$t(p,c+".",l,i);else if(typeof p=="string"||typeof p=="number")i(c,p.toString());else if(typeof p=="boolean")i(c,p?"1":"0");else throw new Error(`Can't handle extra config type: ${typeof p}`)})},V=n=>{let a=H(),l=a.stackSave();try{let i=a.PTR_SIZE,u=a.stackAlloc(2*i);a._OrtGetLastError(u,u+i);let p=Number(a.getValue(u,i===4?"i32":"i64")),c=a.getValue(u+i,"*"),d=c?a.UTF8ToString(c):"";throw new Error(`${n} ERROR_CODE: ${p}, ERROR_MESSAGE: ${d}`)}finally{a.stackRestore(l)}}}),ti,Uo=k(()=>{Ke(),vr(),ti=n=>{let a=H(),l=0,i=[],u=n||{};try{if(n?.logSeverityLevel===void 0)u.logSeverityLevel=2;else if(typeof n.logSeverityLevel!="number"||!Number.isInteger(n.logSeverityLevel)||n.logSeverityLevel<0||n.logSeverityLevel>4)throw new Error(`log severity level is not valid: ${n.logSeverityLevel}`);if(n?.logVerbosityLevel===void 0)u.logVerbosityLevel=0;else if(typeof n.logVerbosityLevel!="number"||!Number.isInteger(n.logVerbosityLevel))throw new Error(`log verbosity level is not valid: ${n.logVerbosityLevel}`);n?.terminate===void 0&&(u.terminate=!1);let p=0;return n?.tag!==void 0&&(p=he(n.tag,i)),l=a._OrtCreateRunOptions(u.logSeverityLevel,u.logVerbosityLevel,!!u.terminate,p),l===0&&V("Can't create run options."),n?.extra!==void 0&&$t(n.extra,"",new WeakSet,(c,d)=>{let y=he(c,i),w=he(d,i);a._OrtAddRunConfigEntry(l,y,w)!==0&&V(`Can't set a run config entry: ${c} - ${d}.`)}),[l,i]}catch(p){throw l!==0&&a._OrtReleaseRunOptions(l),i.forEach(c=>a._free(c)),p}}}),ri,ni,ii,kt,Nt,ai,oi,Po=k(()=>{Ke(),vr(),ri=n=>{switch(n){case"disabled":return 0;case"basic":return 1;case"extended":return 2;case"layout":return 3;case"all":return 99;default:throw new Error(`unsupported graph optimization level: ${n}`)}},ni=n=>{switch(n){case"sequential":return 0;case"parallel":return 1;default:throw new Error(`unsupported execution mode: ${n}`)}},ii=n=>{n.extra||(n.extra={}),n.extra.session||(n.extra.session={});let a=n.extra.session;a.use_ort_model_bytes_directly||(a.use_ort_model_bytes_directly="1"),n.executionProviders&&n.executionProviders.some(l=>(typeof l=="string"?l:l.name)==="webgpu")&&(n.enableMemPattern=!1)},kt=(n,a,l,i)=>{let u=he(a,i),p=he(l,i);H()._OrtAddSessionConfigEntry(n,u,p)!==0&&V(`Can't set a session config entry: ${a} - ${l}.`)},Nt=(n,a,l,i)=>{let u=he(a,i),p=he(l,i);n.push([u,p])},ai=async(n,a,l)=>{for(let i of a){let u=typeof i=="string"?i:i.name,p=[];switch(u){case"webnn":if(u="WEBNN",typeof i!="string"){let v=i?.deviceType;v&&kt(n,"deviceType",v,l)}break;case"webgpu":{u="WebGPU";let v;if(typeof i!="string"){let _=i;if(_.device)if(typeof GPUDevice<"u"&&_.device instanceof GPUDevice)v=_.device;else throw new Error("Invalid GPU device set in WebGPU EP options.")}let C=H().webgpuRegisterDevice(v);if(C){let[_,O,R]=C;Nt(p,"deviceId",_.toString(),l),Nt(p,"webgpuInstance",O.toString(),l),Nt(p,"webgpuDevice",R.toString(),l)}}break;case"wasm":case"cpu":continue;default:throw new Error(`not supported execution provider: ${u}`)}let c=he(u,l),d=p.length,y=0,w=0;if(d>0){y=H()._malloc(d*H().PTR_SIZE),l.push(y),w=H()._malloc(d*H().PTR_SIZE),l.push(w);for(let v=0;v<d;v++)H().setValue(y+v*H().PTR_SIZE,p[v][0],"*"),H().setValue(w+v*H().PTR_SIZE,p[v][1],"*")}await H()._OrtAppendExecutionProvider(n,c,y,w,d)!==0&&V(`Can't append execution provider: ${u}.`)}},oi=async n=>{let a=H(),l=0,i=[],u=n||{};ii(u);try{let p=ri(u.graphOptimizationLevel??"all"),c=ni(u.executionMode??"sequential"),d=typeof u.logId=="string"?he(u.logId,i):0,y=u.logSeverityLevel??2;if(!Number.isInteger(y)||y<0||y>4)throw new Error(`log severity level is not valid: ${y}`);let w=u.logVerbosityLevel??0;if(!Number.isInteger(w)||w<0||w>4)throw new Error(`log verbosity level is not valid: ${w}`);let v=typeof u.optimizedModelFilePath=="string"?he(u.optimizedModelFilePath,i):0;if(l=a._OrtCreateSessionOptions(p,!!u.enableCpuMemArena,!!u.enableMemPattern,c,!!u.enableProfiling,0,d,y,w,v),l===0&&V("Can't create session options."),u.executionProviders&&await ai(l,u.executionProviders,i),u.enableGraphCapture!==void 0){if(typeof u.enableGraphCapture!="boolean")throw new Error(`enableGraphCapture must be a boolean value: ${u.enableGraphCapture}`);kt(l,"enableGraphCapture",u.enableGraphCapture.toString(),i)}if(u.freeDimensionOverrides)for(let[C,_]of Object.entries(u.freeDimensionOverrides)){if(typeof C!="string")throw new Error(`free dimension override name must be a string: ${C}`);if(typeof _!="number"||!Number.isInteger(_)||_<0)throw new Error(`free dimension override value must be a non-negative integer: ${_}`);let O=he(C,i);a._OrtAddFreeDimensionOverride(l,O,_)!==0&&V(`Can't set a free dimension override: ${C} - ${_}.`)}return u.extra!==void 0&&$t(u.extra,"",new WeakSet,(C,_)=>{kt(l,C,_,i)}),[l,i]}catch(p){throw l!==0&&a._OrtReleaseSessionOptions(l)!==0&&V("Can't release session options."),i.forEach(c=>a._free(c)),p}}}),et,Dt,ot,bt,Wt,Cr,Tr,_r,st=k(()=>{et=n=>{switch(n){case"int8":return 3;case"uint8":return 2;case"bool":return 9;case"int16":return 5;case"uint16":return 4;case"int32":return 6;case"uint32":return 12;case"float16":return 10;case"float32":return 1;case"float64":return 11;case"string":return 8;case"int64":return 7;case"uint64":return 13;case"int4":return 22;case"uint4":return 21;default:throw new Error(`unsupported data type: ${n}`)}},Dt=n=>{switch(n){case 3:return"int8";case 2:return"uint8";case 9:return"bool";case 5:return"int16";case 4:return"uint16";case 6:return"int32";case 12:return"uint32";case 10:return"float16";case 1:return"float32";case 11:return"float64";case 8:return"string";case 7:return"int64";case 13:return"uint64";case 22:return"int4";case 21:return"uint4";default:throw new Error(`unsupported data type: ${n}`)}},ot=(n,a)=>{let l=[-1,4,1,1,2,2,4,8,-1,1,2,8,4,8,-1,-1,-1,-1,-1,-1,-1,.5,.5][n],i=typeof a=="number"?a:a.reduce((u,p)=>u*p,1);return l>0?Math.ceil(i*l):void 0},bt=n=>{switch(n){case"float16":return typeof Float16Array<"u"&&Float16Array.from?Float16Array:Uint16Array;case"float32":return Float32Array;case"uint8":return Uint8Array;case"int8":return Int8Array;case"uint16":return Uint16Array;case"int16":return Int16Array;case"int32":return Int32Array;case"bool":return Uint8Array;case"float64":return Float64Array;case"uint32":return Uint32Array;case"int64":return BigInt64Array;case"uint64":return BigUint64Array;default:throw new Error(`unsupported type: ${n}`)}},Wt=n=>{switch(n){case"verbose":return 0;case"info":return 1;case"warning":return 2;case"error":return 3;case"fatal":return 4;default:throw new Error(`unsupported logging level: ${n}`)}},Cr=n=>n==="float32"||n==="float16"||n==="int32"||n==="int64"||n==="uint32"||n==="uint8"||n==="bool"||n==="uint4"||n==="int4",Tr=n=>n==="float32"||n==="float16"||n==="int32"||n==="int64"||n==="uint32"||n==="uint64"||n==="int8"||n==="uint8"||n==="bool"||n==="uint4"||n==="int4",_r=n=>{switch(n){case"none":return 0;case"cpu":return 1;case"cpu-pinned":return 2;case"texture":return 3;case"gpu-buffer":return 4;case"ml-tensor":return 5;default:throw new Error(`unsupported data location: ${n}`)}}}),Er,si=k(()=>{sr(),Er=async n=>{if(typeof n=="string"){let a=await fetch(n);if(!a.ok)throw new Error(`failed to load external data file: ${n}`);let l=a.headers.get("Content-Length"),i=l?parseInt(l,10):0;if(i<1073741824)return new Uint8Array(await a.arrayBuffer());{if(!a.body)throw new Error(`failed to load external data file: ${n}, no response body.`);let u=a.body.getReader(),p;try{p=new ArrayBuffer(i)}catch(d){if(d instanceof RangeError){let y=Math.ceil(i/65536);p=new WebAssembly.Memory({initial:y,maximum:y}).buffer}else throw d}let c=0;for(;;){let{done:d,value:y}=await u.read();if(d)break;let w=y.byteLength;new Uint8Array(p,c,w).set(y),c+=w}return new Uint8Array(p,0,i)}}else return n instanceof Blob?new Uint8Array(await n.arrayBuffer()):n instanceof Uint8Array?n:new Uint8Array(n)}}),li,Lo=k(()=>{st(),li=(n,a)=>new(bt(a))(n)}),ui,fi,di,ci,pi,hi,le,yi=k(()=>{st(),ui=["V","I","W","E","F"],fi=(n,a)=>{console.log(`[${ui[n]},${new Date().toISOString()}]${a}`)},pi=(n,a)=>{di=n,ci=a},hi=(n,a)=>{let l=Wt(n),i=Wt(di);l>=i&&fi(l,typeof a=="function"?a():a)},le=(...n)=>{ci&&hi(...n)}}),Ar,xr,Or,mi,Ir,gi,Sr,Br,Mr,wi,bi,jo=k(()=>{st(),yi(),Ar=new Map([["float32",32],["float16",16],["int32",32],["uint32",32],["int64",64],["uint64",64],["int8",8],["uint8",8],["int4",4],["uint4",4]]),xr=(n,a)=>{if(a==="int32")return n;let l=Ar.get(a);if(!l)throw new Error(`WebNN backend does not support data type: ${a}`);let i=l/8;if(n.byteLength%i!==0)throw new Error(`Invalid Uint8Array length - must be a multiple of ${i}.`);let u=n.byteLength/i,p=new(bt(a))(n.buffer,n.byteOffset,u);switch(a){case"int64":case"uint64":{let c=new Int32Array(u);for(let d=0;d<u;d++){let y=p[d];if(y>2147483647n||y<-2147483648n)throw new Error("Can not convert int64 data to int32 - value out of range.");c[d]=Number(y)}return new Uint8Array(c.buffer)}case"int8":case"uint8":case"uint32":{if(a==="uint32"&&p.some(d=>d>2147483647))throw new Error("Can not convert uint32 data to int32 - value out of range.");let c=Int32Array.from(p,Number);return new Uint8Array(c.buffer)}default:throw new Error(`Unsupported data conversion from ${a} to 'int32'`)}},Or=(n,a)=>{if(a==="int32")return n;if(n.byteLength%4!==0)throw new Error("Invalid Uint8Array length - must be a multiple of 4 (int32).");let l=n.byteLength/4,i=new Int32Array(n.buffer,n.byteOffset,l);switch(a){case"int64":{let u=BigInt64Array.from(i,BigInt);return new Uint8Array(u.buffer)}case"uint64":{if(i.some(p=>p<0))throw new Error("Can not convert int32 data to uin64 - negative value found.");let u=BigUint64Array.from(i,BigInt);return new Uint8Array(u.buffer)}case"int8":{if(i.some(p=>p<-128||p>127))throw new Error("Can not convert int32 data to int8 - value out of range.");let u=Int8Array.from(i,Number);return new Uint8Array(u.buffer)}case"uint8":{if(i.some(u=>u<0||u>255))throw new Error("Can not convert int32 data to uint8 - value out of range.");return Uint8Array.from(i,Number)}case"uint32":{if(i.some(p=>p<0))throw new Error("Can not convert int32 data to uint32 - negative value found.");let u=Uint32Array.from(i,Number);return new Uint8Array(u.buffer)}default:throw new Error(`Unsupported data conversion from 'int32' to ${a}`)}},mi=1,Ir=()=>mi++,gi=new Map([["int8","int32"],["uint8","int32"],["uint32","int32"],["int64","int32"]]),Sr=(n,a)=>{let l=Ar.get(n);if(!l)throw new Error(`WebNN backend does not support data type: ${n}`);return a.length>0?Math.ceil(a.reduce((i,u)=>i*u)*l/8):0},Br=class{constructor(n){this.isDataConverted=!1;let{sessionId:a,context:l,tensor:i,dataType:u,shape:p,fallbackDataType:c}=n;this.sessionId=a,this.mlContext=l,this.mlTensor=i,this.dataType=u,this.tensorShape=p,this.fallbackDataType=c}get tensor(){return this.mlTensor}get type(){return this.dataType}get fallbackType(){return this.fallbackDataType}get shape(){return this.tensorShape}get byteLength(){return Sr(this.dataType,this.tensorShape)}destroy(){le("verbose",()=>"[WebNN] TensorWrapper.destroy"),this.mlTensor.destroy()}write(n){this.mlContext.writeTensor(this.mlTensor,n)}async read(n){if(this.fallbackDataType){let a=await this.mlContext.readTensor(this.mlTensor),l=Or(new Uint8Array(a),this.dataType);if(n){(n instanceof ArrayBuffer?new Uint8Array(n):new Uint8Array(n.buffer,n.byteOffset,n.byteLength)).set(l);return}else return l.buffer}else return n?this.mlContext.readTensor(this.mlTensor,n):this.mlContext.readTensor(this.mlTensor)}canReuseTensor(n,a,l){return this.mlContext===n&&this.dataType===a&&this.tensorShape.length===l.length&&this.tensorShape.every((i,u)=>i===l[u])}setIsDataConverted(n){this.isDataConverted=n}},Mr=class{constructor(n,a){this.tensorManager=n,this.wrapper=a}get tensorWrapper(){return this.wrapper}releaseTensor(){this.tensorWrapper&&(this.tensorManager.releaseTensor(this.tensorWrapper),this.wrapper=void 0)}async ensureTensor(n,a,l,i){let u=this.tensorManager.getMLContext(n),p;if(!u.opSupportLimits().input.dataTypes.includes(a)){if(p=gi.get(a),!p||!u.opSupportLimits().input.dataTypes.includes(p))throw new Error(`WebNN backend does not support data type: ${a}`);le("verbose",()=>`[WebNN] TensorIdTracker.ensureTensor: fallback dataType from ${a} to ${p}`)}if(this.wrapper){if(this.wrapper.canReuseTensor(u,a,l))return this.wrapper.tensor;if(i){if(this.wrapper.byteLength!==Sr(a,l))throw new Error("Unable to copy data to tensor with different size.");this.activeUpload=new Uint8Array(await this.wrapper.read())}this.tensorManager.releaseTensor(this.wrapper)}let c=typeof MLTensorUsage>"u"?void 0:MLTensorUsage.READ|MLTensorUsage.WRITE;return this.wrapper=await this.tensorManager.getCachedTensor(n,a,l,c,!0,!0,p),i&&this.activeUpload&&(this.wrapper.write(this.activeUpload),this.activeUpload=void 0),this.wrapper.tensor}upload(n){let a=n;if(this.wrapper){if(this.wrapper.fallbackType)if(this.wrapper.fallbackType==="int32")a=xr(n,this.wrapper.type),this.wrapper.setIsDataConverted(!0);else throw new Error(`Unsupported fallback data type: ${this.wrapper.fallbackType}`);if(n.byteLength===this.wrapper.byteLength){this.wrapper.write(a);return}else le("verbose",()=>"Data size does not match tensor size. Releasing tensor."),this.releaseTensor()}this.activeUpload?this.activeUpload.set(a):this.activeUpload=new Uint8Array(a)}async download(n){if(this.activeUpload){let a=this.wrapper?.isDataConverted?Or(this.activeUpload,this.wrapper?.type):this.activeUpload;if(n){n instanceof ArrayBuffer?new Uint8Array(n).set(a):new Uint8Array(n.buffer,n.byteOffset,n.byteLength).set(a);return}else return a.buffer}if(!this.wrapper)throw new Error("Tensor has not been created.");return n?this.wrapper.read(n):this.wrapper.read()}},wi=class{constructor(n){this.backend=n,this.tensorTrackersById=new Map,this.freeTensors=[],this.externalTensors=new Set}getMLContext(n){let a=this.backend.getMLContext(n);if(!a)throw new Error("MLContext not found for session.");return a}reserveTensorId(){let n=Ir();return this.tensorTrackersById.set(n,new Mr(this)),n}releaseTensorId(n){let a=this.tensorTrackersById.get(n);a&&(this.tensorTrackersById.delete(n),a.tensorWrapper&&this.releaseTensor(a.tensorWrapper))}async ensureTensor(n,a,l,i,u){le("verbose",()=>`[WebNN] TensorManager.ensureTensor {tensorId: ${a}, dataType: ${l}, shape: ${i}, copyOld: ${u}}`);let p=this.tensorTrackersById.get(a);if(!p)throw new Error("Tensor not found.");return p.ensureTensor(n,l,i,u)}upload(n,a){let l=this.tensorTrackersById.get(n);if(!l)throw new Error("Tensor not found.");l.upload(a)}async download(n,a){le("verbose",()=>`[WebNN] TensorManager.download {tensorId: ${n}, dstBuffer: ${a?.byteLength}}`);let l=this.tensorTrackersById.get(n);if(!l)throw new Error("Tensor not found.");return l.download(a)}releaseTensorsForSession(n){for(let a of this.freeTensors)a.sessionId===n&&a.destroy();this.freeTensors=this.freeTensors.filter(a=>a.sessionId!==n)}registerTensor(n,a,l,i){let u=this.getMLContext(n),p=Ir(),c=new Br({sessionId:n,context:u,tensor:a,dataType:l,shape:i});return this.tensorTrackersById.set(p,new Mr(this,c)),this.externalTensors.add(c),p}async getCachedTensor(n,a,l,i,u,p,c){let d=this.getMLContext(n);for(let[w,v]of this.freeTensors.entries())if(v.canReuseTensor(d,a,l)){le("verbose",()=>`[WebNN] Reusing tensor {dataType: ${a}, ${c?`fallbackDataType: ${c},`:""} shape: ${l}`);let C=this.freeTensors.splice(w,1)[0];return C.sessionId=n,C}le("verbose",()=>`[WebNN] MLContext.createTensor {dataType: ${a}, ${c?`fallbackDataType: ${c},`:""} shape: ${l}}`);let y=await d.createTensor({dataType:c??a,shape:l,dimensions:l,usage:i,writable:u,readable:p});return new Br({sessionId:n,context:d,tensor:y,dataType:a,shape:l,fallbackDataType:c})}releaseTensor(n){this.externalTensors.has(n)&&this.externalTensors.delete(n),this.freeTensors.push(n)}},bi=(...n)=>new wi(...n)}),vi={};yt(vi,{WebNNBackend:()=>Ti});var vt,Ci,Ti,$o=k(()=>{st(),Ke(),Lo(),jo(),yi(),vt=new Map([[1,"float32"],[10,"float16"],[6,"int32"],[12,"uint32"],[7,"int64"],[13,"uint64"],[22,"int4"],[21,"uint4"],[3,"int8"],[2,"uint8"],[9,"uint8"]]),Ci=(n,a)=>{if(n===a)return!0;if(n===void 0||a===void 0)return!1;let l=Object.keys(n).sort(),i=Object.keys(a).sort();return l.length===i.length&&l.every((u,p)=>u===i[p]&&n[u]===a[u])},Ti=class{constructor(n){this.tensorManager=bi(this),this.mlContextBySessionId=new Map,this.sessionIdsByMLContext=new Map,this.mlContextCache=[],this.sessionGraphInputs=new Map,this.sessionGraphOutputs=new Map,this.temporaryGraphInputs=[],this.temporaryGraphOutputs=[],this.temporarySessionTensorIds=new Map,pi(n.logLevel,!!n.debug)}get currentSessionId(){if(this.activeSessionId===void 0)throw new Error("No active session");return this.activeSessionId}onRunStart(n){le("verbose",()=>`[WebNN] onRunStart {sessionId: ${n}}`),this.activeSessionId=n}onRunEnd(n){le("verbose",()=>`[WebNN] onRunEnd {sessionId: ${n}}`);let a=this.temporarySessionTensorIds.get(n);if(a){for(let l of a)le("verbose",()=>`[WebNN] releasing temporary tensor {tensorId: ${l}}`),this.tensorManager.releaseTensorId(l);this.temporarySessionTensorIds.delete(n),this.activeSessionId=void 0}}async createMLContext(n){if(n instanceof GPUDevice){let l=this.mlContextCache.findIndex(i=>i.gpuDevice===n);if(l!==-1)return this.mlContextCache[l].mlContext;{let i=await navigator.ml.createContext(n);return this.mlContextCache.push({gpuDevice:n,mlContext:i}),i}}else if(n===void 0){let l=this.mlContextCache.findIndex(i=>i.options===void 0&&i.gpuDevice===void 0);if(l!==-1)return this.mlContextCache[l].mlContext;{let i=await navigator.ml.createContext();return this.mlContextCache.push({mlContext:i}),i}}let a=this.mlContextCache.findIndex(l=>Ci(l.options,n));if(a!==-1)return this.mlContextCache[a].mlContext;{let l=await navigator.ml.createContext(n);return this.mlContextCache.push({options:n,mlContext:l}),l}}registerMLContext(n,a){this.mlContextBySessionId.set(n,a);let l=this.sessionIdsByMLContext.get(a);l||(l=new Set,this.sessionIdsByMLContext.set(a,l)),l.add(n),this.temporaryGraphInputs.length>0&&(this.sessionGraphInputs.set(n,this.temporaryGraphInputs),this.temporaryGraphInputs=[]),this.temporaryGraphOutputs.length>0&&(this.sessionGraphOutputs.set(n,this.temporaryGraphOutputs),this.temporaryGraphOutputs=[])}onReleaseSession(n){this.sessionGraphInputs.delete(n),this.sessionGraphOutputs.delete(n);let a=this.mlContextBySessionId.get(n);if(!a)return;this.tensorManager.releaseTensorsForSession(n),this.mlContextBySessionId.delete(n);let l=this.sessionIdsByMLContext.get(a);if(l.delete(n),l.size===0){this.sessionIdsByMLContext.delete(a);let i=this.mlContextCache.findIndex(u=>u.mlContext===a);i!==-1&&this.mlContextCache.splice(i,1)}}getMLContext(n){return this.mlContextBySessionId.get(n)}reserveTensorId(){return this.tensorManager.reserveTensorId()}releaseTensorId(n){le("verbose",()=>`[WebNN] releaseTensorId {tensorId: ${n}}`),this.tensorManager.releaseTensorId(n)}async ensureTensor(n,a,l,i,u){let p=vt.get(l);if(!p)throw new Error(`Unsupported ONNX data type: ${l}`);return this.tensorManager.ensureTensor(n??this.currentSessionId,a,p,i,u)}async createTemporaryTensor(n,a,l){le("verbose",()=>`[WebNN] createTemporaryTensor {onnxDataType: ${a}, shape: ${l}}`);let i=vt.get(a);if(!i)throw new Error(`Unsupported ONNX data type: ${a}`);let u=this.tensorManager.reserveTensorId();await this.tensorManager.ensureTensor(n,u,i,l,!1);let p=this.temporarySessionTensorIds.get(n);return p?p.push(u):this.temporarySessionTensorIds.set(n,[u]),u}uploadTensor(n,a){if(!H().shouldTransferToMLTensor)throw new Error("Trying to upload to a MLTensor while shouldTransferToMLTensor is false");le("verbose",()=>`[WebNN] uploadTensor {tensorId: ${n}, data: ${a.byteLength}}`),this.tensorManager.upload(n,a)}async downloadTensor(n,a){return this.tensorManager.download(n,a)}createMLTensorDownloader(n,a){return async()=>{let l=await this.tensorManager.download(n);return li(l,a)}}registerMLTensor(n,a,l,i){let u=vt.get(l);if(!u)throw new Error(`Unsupported ONNX data type: ${l}`);let p=this.tensorManager.registerTensor(n,a,u,i);return le("verbose",()=>`[WebNN] registerMLTensor {tensor: ${a}, dataType: ${u}, dimensions: ${i}} -> {tensorId: ${p}}`),p}registerMLConstant(n,a,l,i,u,p,c=!1){if(!p)throw new Error("External mounted files are not available.");let d=n;n.startsWith("./")&&(d=n.substring(2));let y=p.get(d);if(!y)throw new Error(`File with name ${d} not found in preloaded files.`);if(a+l>y.byteLength)throw new Error("Out of bounds: data offset and length exceed the external file data size.");let w=y.slice(a,a+l).buffer,v;switch(u.dataType){case"float32":v=new Float32Array(w);break;case"float16":v=typeof Float16Array<"u"&&Float16Array.from?new Float16Array(w):new Uint16Array(w);break;case"int32":v=new Int32Array(w);break;case"uint32":v=new Uint32Array(w);break;case"int64":if(c){let C=xr(new Uint8Array(w),"int64");v=new Int32Array(C.buffer),u.dataType="int32"}else v=new BigInt64Array(w);break;case"uint64":v=new BigUint64Array(w);break;case"int8":v=new Int8Array(w);break;case"int4":case"uint4":case"uint8":v=new Uint8Array(w);break;default:throw new Error(`Unsupported data type: ${u.dataType} in creating WebNN Constant from external data.`)}return le("verbose",()=>`[WebNN] registerMLConstant {dataType: ${u.dataType}, shape: ${u.shape}}} ${c?"(Note: it was int64 data type and registered to int32 as workaround)":""}`),i.constant(u,v)}registerGraphInput(n){this.temporaryGraphInputs.push(n)}registerGraphOutput(n){this.temporaryGraphOutputs.push(n)}isGraphInput(n,a){let l=this.sessionGraphInputs.get(n);return l?l.includes(a):!1}isGraphOutput(n,a){let l=this.sessionGraphOutputs.get(n);return l?l.includes(a):!1}isGraphInputOutputTypeSupported(n,a,l=!0){let i=this.mlContextBySessionId.get(n),u=vt.get(et(a));return typeof u>"u"?!1:l?!!i?.opSupportLimits().input.dataTypes.includes(u):!!i?.opSupportLimits().output.dataTypes.includes(u)}flush(){}}}),_i,Rr,Ur,Fe,Ei,Pr,Gt,Lr,jr,$r,kr,Nr,Dr,Ai=k(()=>{Qe(),Uo(),Po(),st(),Ke(),vr(),si(),_i=(n,a)=>{H()._OrtInit(n,a)!==0&&V("Can't initialize onnxruntime.")},Rr=async n=>{_i(n.wasm.numThreads,Wt(n.logLevel))},Ur=async(n,a)=>{H().asyncInit?.();let l=n.webgpu.adapter;if(a==="webgpu"){if(typeof navigator>"u"||!navigator.gpu)throw new Error("WebGPU is not supported in current environment");if(l){if(typeof l.limits!="object"||typeof l.features!="object"||typeof l.requestDevice!="function")throw new Error("Invalid GPU adapter set in `env.webgpu.adapter`. It must be a GPUAdapter object.")}else{let i=n.webgpu.powerPreference;if(i!==void 0&&i!=="low-power"&&i!=="high-performance")throw new Error(`Invalid powerPreference setting: "${i}"`);let u=n.webgpu.forceFallbackAdapter;if(u!==void 0&&typeof u!="boolean")throw new Error(`Invalid forceFallbackAdapter setting: "${u}"`);if(l=await navigator.gpu.requestAdapter({powerPreference:i,forceFallbackAdapter:u}),!l)throw new Error('Failed to get GPU adapter. You may need to enable flag "--enable-unsafe-webgpu" if you are using Chrome.')}}if(a==="webnn"&&(typeof navigator>"u"||!navigator.ml))throw new Error("WebNN is not supported in current environment");if(a==="webgpu"&&H().webgpuInit(i=>{n.webgpu.device=i}),a==="webnn"){let i=new($o(),Mt(vi)).WebNNBackend(n);H().webnnInit([i,()=>i.reserveTensorId(),u=>i.releaseTensorId(u),async(u,p,c,d,y)=>i.ensureTensor(u,p,c,d,y),(u,p)=>{i.uploadTensor(u,p)},async(u,p)=>i.downloadTensor(u,p),(u,p)=>i.registerMLContext(u,p),!!n.trace])}},Fe=new Map,Ei=n=>{let a=H(),l=a.stackSave();try{let i=a.PTR_SIZE,u=a.stackAlloc(2*i);a._OrtGetInputOutputCount(n,u,u+i)!==0&&V("Can't get session input/output count.");let p=i===4?"i32":"i64";return[Number(a.getValue(u,p)),Number(a.getValue(u+i,p))]}finally{a.stackRestore(l)}},Pr=(n,a)=>{let l=H(),i=l.stackSave(),u=0;try{let p=l.PTR_SIZE,c=l.stackAlloc(2*p);l._OrtGetInputOutputMetadata(n,a,c,c+p)!==0&&V("Can't get session input/output metadata.");let d=Number(l.getValue(c,"*"));u=Number(l.getValue(c+p,"*"));let y=l.HEAP32[u/4];if(y===0)return[d,0];let w=l.HEAPU32[u/4+1],v=[];for(let C=0;C<w;C++){let _=Number(l.getValue(u+8+C*p,"*"));v.push(_!==0?l.UTF8ToString(_):Number(l.getValue(u+8+(C+w)*p,"*")))}return[d,y,v]}finally{l.stackRestore(i),u!==0&&l._OrtFree(u)}},Gt=n=>{let a=H(),l=a._malloc(n.byteLength);if(l===0)throw new Error(`Can't create a session. failed to allocate a buffer of size ${n.byteLength}.`);return a.HEAPU8.set(n,l),[l,n.byteLength]},Lr=async(n,a)=>{let l,i,u=H();Array.isArray(n)?[l,i]=n:n.buffer===u.HEAPU8.buffer?[l,i]=[n.byteOffset,n.byteLength]:[l,i]=Gt(n);let p=0,c=0,d=0,y=[],w=[],v=[];try{if([c,y]=await oi(a),a?.externalData&&u.mountExternalData){let P=[];for(let F of a.externalData){let ie=typeof F=="string"?F:F.path;P.push(Er(typeof F=="string"?F:F.data).then(se=>{u.mountExternalData(ie,se)}))}await Promise.all(P)}for(let P of a?.executionProviders??[])if((typeof P=="string"?P:P.name)==="webnn"){if(u.shouldTransferToMLTensor=!1,typeof P!="string"){let F=P,ie=F?.context,se=F?.gpuDevice,ee=F?.deviceType,te=F?.powerPreference;ie?u.currentContext=ie:se?u.currentContext=await u.webnnCreateMLContext(se):u.currentContext=await u.webnnCreateMLContext({deviceType:ee,powerPreference:te})}else u.currentContext=await u.webnnCreateMLContext();break}p=await u._OrtCreateSession(l,i,c),u.webgpuOnCreateSession?.(p),p===0&&V("Can't create a session."),u.jsepOnCreateSession?.(),u.currentContext&&(u.webnnRegisterMLContext(p,u.currentContext),u.currentContext=void 0,u.shouldTransferToMLTensor=!0);let[C,_]=Ei(p),O=!!a?.enableGraphCapture,R=[],j=[],L=[],U=[],B=[];for(let P=0;P<C;P++){let[F,ie,se]=Pr(p,P);F===0&&V("Can't get an input name."),w.push(F);let ee=u.UTF8ToString(F);R.push(ee),L.push(ie===0?{name:ee,isTensor:!1}:{name:ee,isTensor:!0,type:Dt(ie),shape:se})}for(let P=0;P<_;P++){let[F,ie,se]=Pr(p,P+C);F===0&&V("Can't get an output name."),v.push(F);let ee=u.UTF8ToString(F);j.push(ee),U.push(ie===0?{name:ee,isTensor:!1}:{name:ee,isTensor:!0,type:Dt(ie),shape:se});{if(O&&a?.preferredOutputLocation===void 0){B.push("gpu-buffer");continue}let te=typeof a?.preferredOutputLocation=="string"?a.preferredOutputLocation:a?.preferredOutputLocation?.[ee]??"cpu",ae=u.webnnIsGraphOutput;if(te==="cpu"&&ae&&ae(p,ee)){B.push("ml-tensor-cpu-output");continue}if(te!=="cpu"&&te!=="cpu-pinned"&&te!=="gpu-buffer"&&te!=="ml-tensor")throw new Error(`Not supported preferred output location: ${te}.`);if(O&&te!=="gpu-buffer")throw new Error(`Not supported preferred output location: ${te}. Only 'gpu-buffer' location is supported when enableGraphCapture is true.`);B.push(te)}}let D=null;return B.some(P=>P==="gpu-buffer"||P==="ml-tensor"||P==="ml-tensor-cpu-output")&&(d=u._OrtCreateBinding(p),d===0&&V("Can't create IO binding."),D={handle:d,outputPreferredLocations:B,outputPreferredLocationsEncoded:B.map(P=>P==="ml-tensor-cpu-output"?"ml-tensor":P).map(P=>_r(P))}),Fe.set(p,[p,w,v,D,O,!1]),[p,R,j,L,U]}catch(C){throw w.forEach(_=>u._OrtFree(_)),v.forEach(_=>u._OrtFree(_)),d!==0&&u._OrtReleaseBinding(d)!==0&&V("Can't release IO binding."),p!==0&&u._OrtReleaseSession(p)!==0&&V("Can't release session."),C}finally{u._free(l),c!==0&&u._OrtReleaseSessionOptions(c)!==0&&V("Can't release session options."),y.forEach(C=>u._free(C)),u.unmountExternalData?.()}},jr=n=>{let a=H(),l=Fe.get(n);if(!l)throw new Error(`cannot release session. invalid session id: ${n}`);let[i,u,p,c,d]=l;c&&(d&&a._OrtClearBoundOutputs(c.handle)!==0&&V("Can't clear bound outputs."),a._OrtReleaseBinding(c.handle)!==0&&V("Can't release IO binding.")),a.jsepOnReleaseSession?.(n),a.webnnOnReleaseSession?.(n),a.webgpuOnReleaseSession?.(n),u.forEach(y=>a._OrtFree(y)),p.forEach(y=>a._OrtFree(y)),a._OrtReleaseSession(i)!==0&&V("Can't release session."),Fe.delete(n)},$r=async(n,a,l,i,u,p,c=!1)=>{if(!n){a.push(0);return}let d=H(),y=d.PTR_SIZE,w=n[0],v=n[1],C=n[3],_=C,O,R;if(w==="string"&&(C==="gpu-buffer"||C==="ml-tensor"))throw new Error("String tensor is not supported on GPU.");if(c&&C!=="gpu-buffer")throw new Error(`External buffer must be provided for input/output index ${p} when enableGraphCapture is true.`);if(C==="gpu-buffer"){let U=n[2].gpuBuffer;R=ot(et(w),v);{let B=d.webgpuRegisterBuffer;if(!B)throw new Error('Tensor location "gpu-buffer" is not supported without using WebGPU.');O=B(U,i)}}else if(C==="ml-tensor"){let U=n[2].mlTensor;R=ot(et(w),v);let B=d.webnnRegisterMLTensor;if(!B)throw new Error('Tensor location "ml-tensor" is not supported without using WebNN.');O=B(i,U,et(w),v)}else{let U=n[2];if(Array.isArray(U)){R=y*U.length,O=d._malloc(R),l.push(O);for(let B=0;B<U.length;B++){if(typeof U[B]!="string")throw new TypeError(`tensor data at index ${B} is not a string`);d.setValue(O+B*y,he(U[B],l),"*")}}else{let B=d.webnnIsGraphInput,D=d.webnnIsGraphOutput;if(w!=="string"&&B&&D){let P=d.UTF8ToString(u);if(B(i,P)||D(i,P)){let F=et(w);R=ot(F,v),_="ml-tensor";let ie=d.webnnCreateTemporaryTensor,se=d.webnnUploadTensor;if(!ie||!se)throw new Error('Tensor location "ml-tensor" is not supported without using WebNN.');let ee=await ie(i,F,v);se(ee,new Uint8Array(U.buffer,U.byteOffset,U.byteLength)),O=ee}else R=U.byteLength,O=d._malloc(R),l.push(O),d.HEAPU8.set(new Uint8Array(U.buffer,U.byteOffset,R),O)}else R=U.byteLength,O=d._malloc(R),l.push(O),d.HEAPU8.set(new Uint8Array(U.buffer,U.byteOffset,R),O)}}let j=d.stackSave(),L=d.stackAlloc(4*v.length);try{v.forEach((B,D)=>d.setValue(L+D*y,B,y===4?"i32":"i64"));let U=d._OrtCreateTensor(et(w),O,R,L,v.length,_r(_));U===0&&V(`Can't create tensor for input/output. session=${i}, index=${p}.`),a.push(U)}finally{d.stackRestore(j)}},kr=async(n,a,l,i,u,p)=>{let c=H(),d=c.PTR_SIZE,y=Fe.get(n);if(!y)throw new Error(`cannot run inference. invalid session id: ${n}`);let w=y[0],v=y[1],C=y[2],_=y[3],O=y[4],R=y[5],j=a.length,L=i.length,U=0,B=[],D=[],P=[],F=[],ie=c.stackSave(),se=c.stackAlloc(j*d),ee=c.stackAlloc(j*d),te=c.stackAlloc(L*d),ae=c.stackAlloc(L*d);try{[U,B]=ti(p),We("wasm prepareInputOutputTensor");for(let $=0;$<j;$++)await $r(l[$],D,F,n,v[a[$]],a[$],O);for(let $=0;$<L;$++)await $r(u[$],P,F,n,C[i[$]],j+i[$],O);Ge("wasm prepareInputOutputTensor");for(let $=0;$<j;$++)c.setValue(se+$*d,D[$],"*"),c.setValue(ee+$*d,v[a[$]],"*");for(let $=0;$<L;$++)c.setValue(te+$*d,P[$],"*"),c.setValue(ae+$*d,C[i[$]],"*");if(_&&!R){let{handle:$,outputPreferredLocations:be,outputPreferredLocationsEncoded:ut}=_;if(v.length!==j)throw new Error(`input count from feeds (${j}) is expected to be always equal to model's input count (${v.length}).`);We("wasm bindInputsOutputs");for(let N=0;N<j;N++){let oe=a[N];await c._OrtBindInput($,v[oe],D[N])!==0&&V(`Can't bind input[${N}] for session=${n}.`)}for(let N=0;N<L;N++){let oe=i[N];u[N]?.[3]?c._OrtBindOutput($,C[oe],P[N],0)!==0&&V(`Can't bind pre-allocated output[${N}] for session=${n}.`):c._OrtBindOutput($,C[oe],0,ut[oe])!==0&&V(`Can't bind output[${N}] to ${be[N]} for session=${n}.`)}Ge("wasm bindInputsOutputs"),Fe.set(n,[w,v,C,_,O,!0])}c.jsepOnRunStart?.(w),c.webnnOnRunStart?.(w);let X;_?X=await c._OrtRunWithBinding(w,_.handle,L,te,U):X=await c._OrtRun(w,ee,se,j,ae,L,te,U),X!==0&&V("failed to call OrtRun().");let we=[],_t=[];We("wasm ProcessOutputTensor");for(let $=0;$<L;$++){let be=Number(c.getValue(te+$*d,"*"));if(be===P[$]){we.push(u[$]);continue}let ut=c.stackSave(),N=c.stackAlloc(4*d),oe=!1,K,re=0;try{c._OrtGetTensorData(be,N,N+d,N+2*d,N+3*d)!==0&&V(`Can't access output tensor data on index ${$}.`);let Y=d===4?"i32":"i64",xe=Number(c.getValue(N,Y));re=c.getValue(N+d,"*");let ft=c.getValue(N+d*2,"*"),I=Number(c.getValue(N+d*3,Y)),A=[];for(let J=0;J<I;J++)A.push(Number(c.getValue(ft+J*d,Y)));c._OrtFree(ft)!==0&&V("Can't free memory for tensor dims.");let ve=A.reduce((J,W)=>J*W,1);K=Dt(xe);let ye=_?.outputPreferredLocations[i[$]];if(K==="string"){if(ye==="gpu-buffer"||ye==="ml-tensor")throw new Error("String tensor is not supported on GPU.");let J=[];for(let W=0;W<ve;W++){let Ce=c.getValue(re+W*d,"*"),nt=c.getValue(re+(W+1)*d,"*"),Re=W===ve-1?void 0:nt-Ce;J.push(c.UTF8ToString(Ce,Re))}we.push([K,A,J,"cpu"])}else if(ye==="gpu-buffer"&&ve>0){let J=c.webgpuGetBuffer;if(!J)throw new Error('preferredLocation "gpu-buffer" is not supported without using WebGPU.');let W=J(re),Ce=ot(xe,ve);if(Ce===void 0||!Cr(K))throw new Error(`Unsupported data type: ${K}`);oe=!0;{c.webgpuRegisterBuffer(W,n,re);let nt=c.webgpuCreateDownloader(W,Ce,n);we.push([K,A,{gpuBuffer:W,download:async()=>{let Re=await nt();return new(bt(K))(Re)},dispose:()=>{c._OrtReleaseTensor(be)!==0&&V("Can't release tensor.")}},"gpu-buffer"])}}else if(ye==="ml-tensor"&&ve>0){let J=c.webnnEnsureTensor,W=c.webnnIsGraphInputOutputTypeSupported;if(!J||!W)throw new Error('preferredLocation "ml-tensor" is not supported without using WebNN.');if(ot(xe,ve)===void 0||!Tr(K))throw new Error(`Unsupported data type: ${K}`);if(!W(n,K,!1))throw new Error(`preferredLocation "ml-tensor" for ${K} output is not supported by current WebNN Context.`);let Ce=await J(n,re,xe,A,!1);oe=!0,we.push([K,A,{mlTensor:Ce,download:c.webnnCreateMLTensorDownloader(re,K),dispose:()=>{c.webnnReleaseTensorId(re),c._OrtReleaseTensor(be)}},"ml-tensor"])}else if(ye==="ml-tensor-cpu-output"&&ve>0){let J=c.webnnCreateMLTensorDownloader(re,K)(),W=we.length;oe=!0,_t.push((async()=>{let Ce=[W,await J];return c.webnnReleaseTensorId(re),c._OrtReleaseTensor(be),Ce})()),we.push([K,A,[],"cpu"])}else{let J=bt(K),W=new J(ve);new Uint8Array(W.buffer,W.byteOffset,W.byteLength).set(c.HEAPU8.subarray(re,re+W.byteLength)),we.push([K,A,W,"cpu"])}}finally{c.stackRestore(ut),K==="string"&&re&&c._free(re),oe||c._OrtReleaseTensor(be)}}_&&!O&&(c._OrtClearBoundOutputs(_.handle)!==0&&V("Can't clear bound outputs."),Fe.set(n,[w,v,C,_,O,!1]));for(let[$,be]of await Promise.all(_t))we[$][2]=be;return Ge("wasm ProcessOutputTensor"),we}finally{c.webnnOnRunEnd?.(w),c.stackRestore(ie),l.forEach(X=>{X&&X[3]==="gpu-buffer"&&c.webgpuUnregisterBuffer(X[2].gpuBuffer)}),u.forEach(X=>{X&&X[3]==="gpu-buffer"&&c.webgpuUnregisterBuffer(X[2].gpuBuffer)}),D.forEach(X=>c._OrtReleaseTensor(X)),P.forEach(X=>c._OrtReleaseTensor(X)),F.forEach(X=>c._free(X)),U!==0&&c._OrtReleaseRunOptions(U),B.forEach(X=>c._free(X))}},Nr=n=>{let a=H(),l=Fe.get(n);if(!l)throw new Error("invalid session id");let i=l[0],u=a._OrtEndProfiling(i);u===0&&V("Can't get an profile file name."),a._OrtFree(u)},Dr=n=>{let a=[];for(let l of n){let i=l[2];!Array.isArray(i)&&"buffer"in i&&a.push(i.buffer)}return a}}),Ve,ge,lt,Ct,Tt,Ft,Wr,Vt,tt,rt,xi,Oi,Ii,Si,Bi,Mi,Ri,Ui,Pi=k(()=>{Qe(),Ai(),Ke(),mr(),Ve=()=>!!Z.wasm.proxy&&typeof document<"u",lt=!1,Ct=!1,Tt=!1,Vt=new Map,tt=(n,a)=>{let l=Vt.get(n);l?l.push(a):Vt.set(n,[a])},rt=()=>{if(lt||!Ct||Tt||!ge)throw new Error("worker not ready")},xi=n=>{switch(n.data.type){case"init-wasm":lt=!1,n.data.err?(Tt=!0,Wr[1](n.data.err)):(Ct=!0,Wr[0]()),Ft&&(URL.revokeObjectURL(Ft),Ft=void 0);break;case"init-ep":case"copy-from":case"create":case"release":case"run":case"end-profiling":{let a=Vt.get(n.data.type);n.data.err?a.shift()[1](n.data.err):a.shift()[0](n.data.out);break}}},Oi=async()=>{if(!Ct){if(lt)throw new Error("multiple calls to 'initWasm()' detected.");if(Tt)throw new Error("previous call to 'initWasm()' failed.");if(lt=!0,Ve())return new Promise((n,a)=>{ge?.terminate(),Yn().then(([l,i])=>{try{ge=i,ge.onerror=p=>a(p),ge.onmessage=xi,Wr=[n,a];let u={type:"init-wasm",in:Z};!u.in.wasm.wasmPaths&&(l||cr)&&(u.in.wasm.wasmPaths={wasm:new URL("/assets/ort-wasm-simd-threaded.asyncify-BJtBjfiH.wasm",self.location.href).href}),ge.postMessage(u),Ft=l}catch(u){a(u)}},a)});try{await br(Z.wasm),await Rr(Z),Ct=!0}catch(n){throw Tt=!0,n}finally{lt=!1}}},Ii=async n=>{if(Ve())return rt(),new Promise((a,l)=>{tt("init-ep",[a,l]);let i={type:"init-ep",in:{epName:n,env:Z}};ge.postMessage(i)});await Ur(Z,n)},Si=async n=>Ve()?(rt(),new Promise((a,l)=>{tt("copy-from",[a,l]);let i={type:"copy-from",in:{buffer:n}};ge.postMessage(i,[n.buffer])})):Gt(n),Bi=async(n,a)=>{if(Ve()){if(a?.preferredOutputLocation)throw new Error('session option "preferredOutputLocation" is not supported for proxy.');return rt(),new Promise((l,i)=>{tt("create",[l,i]);let u={type:"create",in:{model:n,options:{...a}}},p=[];n instanceof Uint8Array&&p.push(n.buffer),ge.postMessage(u,p)})}else return Lr(n,a)},Mi=async n=>{if(Ve())return rt(),new Promise((a,l)=>{tt("release",[a,l]);let i={type:"release",in:n};ge.postMessage(i)});jr(n)},Ri=async(n,a,l,i,u,p)=>{if(Ve()){if(l.some(c=>c[3]!=="cpu"))throw new Error("input tensor on GPU is not supported for proxy.");if(u.some(c=>c))throw new Error("pre-allocated output tensor is not supported for proxy.");return rt(),new Promise((c,d)=>{tt("run",[c,d]);let y=l,w={type:"run",in:{sessionId:n,inputIndices:a,inputs:y,outputIndices:i,options:p}};ge.postMessage(w,Dr(y))})}else return kr(n,a,l,i,u,p)},Ui=async n=>{if(Ve())return rt(),new Promise((a,l)=>{tt("end-profiling",[a,l]);let i={type:"end-profiling",in:n};ge.postMessage(i)});Nr(n)}}),Gr,Li,ji,ko=k(()=>{Qe(),Pi(),st(),sr(),si(),Gr=(n,a)=>{switch(n.location){case"cpu":return[n.type,n.dims,n.data,"cpu"];case"gpu-buffer":return[n.type,n.dims,{gpuBuffer:n.gpuBuffer},"gpu-buffer"];case"ml-tensor":return[n.type,n.dims,{mlTensor:n.mlTensor},"ml-tensor"];default:throw new Error(`invalid data location: ${n.location} for ${a()}`)}},Li=n=>{switch(n[3]){case"cpu":return new Ae(n[0],n[2],n[1]);case"gpu-buffer":{let a=n[0];if(!Cr(a))throw new Error(`not supported data type: ${a} for deserializing GPU tensor`);let{gpuBuffer:l,download:i,dispose:u}=n[2];return Ae.fromGpuBuffer(l,{dataType:a,dims:n[1],download:i,dispose:u})}case"ml-tensor":{let a=n[0];if(!Tr(a))throw new Error(`not supported data type: ${a} for deserializing MLTensor tensor`);let{mlTensor:l,download:i,dispose:u}=n[2];return Ae.fromMLTensor(l,{dataType:a,dims:n[1],download:i,dispose:u})}default:throw new Error(`invalid data location: ${n[3]}`)}},ji=class{async fetchModelAndCopyToWasmMemory(n){return Si(await Er(n))}async loadModel(n,a){Ye();let l;typeof n=="string"?l=await this.fetchModelAndCopyToWasmMemory(n):l=n,[this.sessionId,this.inputNames,this.outputNames,this.inputMetadata,this.outputMetadata]=await Bi(l,a),Je()}async dispose(){return Mi(this.sessionId)}async run(n,a,l){Ye();let i=[],u=[];Object.entries(n).forEach(C=>{let _=C[0],O=C[1],R=this.inputNames.indexOf(_);if(R===-1)throw new Error(`invalid input '${_}'`);i.push(O),u.push(R)});let p=[],c=[];Object.entries(a).forEach(C=>{let _=C[0],O=C[1],R=this.outputNames.indexOf(_);if(R===-1)throw new Error(`invalid output '${_}'`);p.push(O),c.push(R)});let d=i.map((C,_)=>Gr(C,()=>`input "${this.inputNames[u[_]]}"`)),y=p.map((C,_)=>C?Gr(C,()=>`output "${this.outputNames[c[_]]}"`):null),w=await Ri(this.sessionId,u,d,c,y,l),v={};for(let C=0;C<w.length;C++)v[this.outputNames[c[C]]]=p[C]??Li(w[C]);return Je(),v}startProfiling(){}endProfiling(){Ui(this.sessionId)}}}),$i={};yt($i,{OnnxruntimeWebAssemblyBackend:()=>Vr,initializeFlags:()=>Fr,wasmBackend:()=>ki});var Fr,Vr,ki,No=k(()=>{Qe(),Pi(),ko(),Fr=()=>{(typeof Z.wasm.initTimeout!="number"||Z.wasm.initTimeout<0)&&(Z.wasm.initTimeout=0);let n=Z.wasm.simd;if(typeof n!="boolean"&&n!==void 0&&n!=="fixed"&&n!=="relaxed"&&(console.warn(`Property "env.wasm.simd" is set to unknown value "${n}". Reset it to \`false\` and ignore SIMD feature checking.`),Z.wasm.simd=!1),typeof Z.wasm.proxy!="boolean"&&(Z.wasm.proxy=!1),typeof Z.wasm.trace!="boolean"&&(Z.wasm.trace=!1),typeof Z.wasm.numThreads!="number"||!Number.isInteger(Z.wasm.numThreads)||Z.wasm.numThreads<=0)if(typeof self<"u"&&!self.crossOriginIsolated)Z.wasm.numThreads=1;else{let a=typeof navigator>"u"?mo("node:os").cpus().length:navigator.hardwareConcurrency;Z.wasm.numThreads=Math.min(4,Math.ceil((a||1)/2))}},Vr=class{async init(n){Fr(),await Oi(),await Ii(n)}async createInferenceSessionHandler(n,a){let l=new ji;return await l.loadModel(n,a),l}},ki=new Vr});Qe(),Qe(),Qe();var Do="1.23.2",Wo=Nn;{let n=(No(),Mt($i)).wasmBackend;Ze("webgpu",n,5),Ze("webnn",n,5),Ze("cpu",n,10),Ze("wasm",n,10)}Object.defineProperty(Z.versions,"web",{value:Do,enumerable:!0});var Go=Object.freeze({__proto__:null,get InferenceSession(){return Pt},get TRACE(){return Ut},get TRACE_EVENT_BEGIN(){return We},get TRACE_EVENT_END(){return Ge},get TRACE_FUNC_BEGIN(){return Ye},get TRACE_FUNC_END(){return Je},get Tensor(){return Ae},default:Wo,get env(){return Z},get registerBackend(){return Ze}});class Fo{static modelSessions={};static sessionPromises={};static creatingSession=!1;static async getSession(a){if(this.modelSessions[a])return this.modelSessions[a];if(this.sessionPromises[a])return this.sessionPromises[a];for(;this.creatingSession;)await new Promise(i=>setTimeout(i,10));if(this.modelSessions[a])return this.modelSessions[a];if(this.sessionPromises[a])return this.sessionPromises[a];this.creatingSession=!0;const l=Pt.create(a,{executionProviders:["webgpu"],logSeverityLevel:3,logVerbosityLevel:0}).then(i=>(this.modelSessions[a]={session:i,ort:Go},delete this.sessionPromises[a],this.creatingSession=!1,this.modelSessions[a])).catch(i=>{throw delete this.sessionPromises[a],this.creatingSession=!1,i});return this.sessionPromises[a]=l,l}static async predict({embedding:a,modelUrl:l,target:i}){return await this.predictEmbedding({embedding:a,modelUrl:l})}static async predictEmbedding({embedding:a,modelUrl:l,device:i="webgpu"}){const{session:u,ort:p}=await this.getSession(l);let c;if(a instanceof Float32Array)c=a;else if(Array.isArray(a))c=new Float32Array(a);else throw new Error("Invalid embedding format");let d=1,y=320;if(c.length%(d*y)!==0)throw new Error(` (${c.length})  320`);let w=c.length/(d*y);if(!Number.isInteger(w))throw new Error(`: ${c.length} / (${d}*${y})`);const v=new p.Tensor("float32",c,[d,w,y]),_={[u.inputNames[0]]:v},O=await u.run(_),R=u.outputNames[0],j=O[R];return{mic:Array.isArray(j.data)?j.data[0]:j.data,outputRaw:j.data}}}self.addEventListener("message",async n=>{try{const{embedding:a,modelUrl:l,device:i}=n.data||{};self.postMessage({status:"computing",message:"MIC..."});const u=await Fo.predictEmbedding({embedding:a,modelUrl:l,device:i});self.postMessage({status:"complete",mic:u.mic,outputRaw:u.outputRaw})}catch(a){self.postMessage({status:"error",error:a.message||String(a)})}})})();
